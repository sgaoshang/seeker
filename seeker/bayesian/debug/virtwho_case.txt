Virt-who Test Specification for RHEL (Base)
1   . Virt-who Configure cases
2   . Virt-who VM Manager cases
3   . Virt-who Subscription cases
4   . Virt-who Performance cases
5   . Other cases
1 . Virt-who Configure cases
RHEL7-64830 - 1001-Check virt-who package from os repo
Step
***For all hypervisor
Expected Result
Refer to bug: BZ 1373391
1. open the latest rhel build:
http://download.eng.pek2.redhat.com/rel-eng/ 
2. check virt-who package exist or not in different
arch, such as:
http://download-node-02.eng.bos.redhat.com/rel-
eng/RHEL-7.3-
Snapshot-2.0/compose/Server/x86_64/os/Packages/
 
Virt-who should be shipped with
Client,
Workstation,
Server-x86_64
Server-ppc64
Server-ppc64le    ----not for
rhel-6
Server-s390x
ComputerNode,
No virt-who package with:
Server-aarch64 
RHEL7-53802 - 1002-Install / uninstall virt-who package
Step
***For all hypervisor
Expected Result
Reuse and Branch test
1. prepare rhel host and make the yum
repo is available, make sure the host is not
registered to any servers
2. check virt-who is installed or not by
default
# rpm -qa virt-who
-for rhel6.8, virt-who should be installed if
choosing the "Virtualization Platform"
-for rhel6.9 and rhel7.4,  virt-who will not
be auto installed if system install in beaker.
3. Install virt-who package.
# yum install virt-who
virt-who package should be installed
normally.
4. Check virt-who package
# rpm -qa |grep virt-who
5. check virt-who service default status
# systemctl  status virt-who            ----rhel7
   Loaded: loaded
(/usr/lib/systemd/system/virt-who.service;
disabled; vendor preset: disabled)
   Active: inactive (dead)
# chkconfig --list |grep virt-who         ----
rhel6
virt-who  0:off  1:off  2:on  3:on 4:on 
5:on  6:off
6. restart virt-who service and check the
status
# /etc/init.d/virt-who restart
# /etc/init.d/virt-who status
7. uninstall virt-who
# rpm -e virt-who
8. check virtwho pachage
# rpm -qa |grep virt-who
9. install virt-who again
# yum install virt-who
virt-who package should be listed.
virt-who service should be restarted
normally and the status is running
virt-who should be uninstalled normally
no virt-who package
virt-who should be install normally
RHEL7-86175 - 1003-Check virt-who and virt-who-config man page
Step
***For all hypervisor
1. enter virt-who man page
# man virt-who
2. Check all virt-who options and
definition:
Expected Result
Refer to: BZ 1409987
should list all command line options for virt-
who, and the definition should be right.
Bug BZ 1409987 existing
3.  run virt-who with --help, 
# virt-who --help
should list virt-who command line options
as "man virt-who" defined
4. Check all virt-who-config options and
definition:
#man virt-who-config
should list configuration options for virt-
who under '/etc/virt-who.conf' and '/etc/virt-
who.d/*.conf', and the definition should be
right.
RHEL7-53803 - 1004-Check virt-who run normally with default configure
Step
***For all hypervisor
Expected Result
1. register your virt-who host to
Sam/Satellite/Stage and make sure virt-
who is installed
2. don't config anything and start virt-who
service
# systemctl restart virt-who
3. check virt-who status and process
# systemctl status virt-who
# ps -ef|grep virt-who
4. check rhsm.log
# tail -f /var/log/rhsm/rhsm.log
5. stop virt-who service and check virt-who
process
# systemctl stop virt-who
# ps -ef|grep virt-who
6. run virt-who by CLI
# virt-who
7. check virt-who status and rhsm.log
if your system is rhel6, please use
/etc/init.d/virt-who for restart
if your system is rhel7, please use
systemctl instead.
when don't configure anything, virt-who will
run as libvirt local mode by default, but
make sure libvirtd service is running in
your virt-who host.
virt-who should be started normally,
virt-who process exist.
should show default host/guests info for
local libvirt mode and the DEBUG function
is disabled
the virt-who process should be killed
virt-who should be run normally for local
libvirt mode, the output such as:
No configurations found (are there any
'.conf' files in /etc/virt-who.d?), using libvirt
as backend
Using configuration "env/cmdline" ("libvirt"
mode)
Using libvirt url: ""
Report for config "env/cmdline" gathered,
placing in datastore
Sending update in guests lists for config
"env/cmdline": 0 guests found
should show default host/guests info for
local libvirt mode
8. press Ctrl+C to kill virt-who and check
# ps -ef|grep virt-who
the virt-who process should be killed
normally
RHEL7-53804 - 1005-Check virt-who debug function by CLI
Step
Expected Result
***For all hypervisor
NOTE: disable the debug option in
/etc/virt-who.conf
1. stop virt-who service
# systemctl stop virt-who
Refer to BZ 1322160 Bug 1509606 Bug
1510712
2.Run virt-who with -d option for your
different modes, such as:
# virt-who --libvirt --libvirt-
owner=ACME_Corporation --libvirt-
env=Library --libvirt-server=[Host2_IP] --
libvirt-username=root --libvirt-
password=redhat -d
3.Run virt-who without -d option for your
different modes, such as:
# virt-who --libvirt --libvirt-
owner=ACME_Corporation --libvirt-
env=Library --libvirt-server=[Host2_IP] --
libvirt-username=root --libvirt-
password=redhat
DEBUG message will be found
And will give WARNING like:
The following cli options: --hyperv, --
hyperv-owner, --hyperv-env, --hyperv-
server, --hyperv-username, --hyperv-
password are deprecated and will be
removed in the next release. Please see
'man virt-who-config' for details on adding
a configuration section.
DEBUG message will not be found 
The WARNING info in anove step2 also
will be producted
***Bug 1510712  , still print one DEBUG
***Bug 1460885 for satellite5, error info but
can report normally
RHEL7-53805 - 1006-Check virt-who debug function by /etc/sysconfig/virt-who option
Step
Expected Result
Refer to BZ 1281715,  BZ 1294746,  BZ
1322160, BZ 1323020,
***For all hypervisor
NOTE: disable the debug option in
/etc/virt-who.conf
1. Enable debug
# vi /etc/sysconfig/virt-who
VIRTWHO_DEBUG=1
2. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
DEBUG message will be found
Host/guest mapping json info show in the
log
3. Disable debug
# vi /etc/sysconfig/virt-who
VIRTWHO_DEBUG=0
4. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
DEBUG message will not be found
Host/guest mapping json info is not
exit in the log, it will show as the
following:
KVM/VDSM: X guests found
RHEVM/HYPERV/ESX: X hypervisor
found, X guest found.
RHEL7-53806 - 1007-Check virt-who oneshot function by CLI
Step
Expected Result
***For all hypervisor
NOTE: disable the oneshot option in
/etc/virt-who.conf
Refer to BZ 1297623 BZ 1273270 BZ
1366999 
BZ 1448821
1.stop virt-who service
# systemctl stop virt-who
2.Run virt-who with -o option
-> if local libvirt mode, please run virt-who
default
-> if remote libvirt mode, please run with --
libvirt
-> if vdsm mode, please run with --vdsm
option
-> if esx mode, please run with --esx
option
-> if rhevm mode, please run with --rhevm
option
-> if hyper-v mode, please run with --
hyperv
-> if xen mode, please run with --xen
3. run virt-who with -o option many time
quickly
(> 5 times)
4. check virt-who process number no
changes
# ps -ef|grep virt-who
5.Run virt-who without -o option
Only send the mapping info one time and
exit immediately and no error info.
It shouldn't  show redundant DEBUG info
as the following:
[hyperv mode]:
"DEBUG: NTLM authentication successful
DEBUG: Using NTLM authentication
DEBUG: NTLM authentication successful
DEBUG: Using NTLM authentication"
[libvirt/vdsm/esx/rhevm/xen mode]:
"Report for config "test-xen" gathered,
putting to queue for sending"
- only send the mapping info one time and
exit immediately without error info.
- should print reminder info - "Thread
'env/cmdline' stopped after running once"
to rhsm log.
***Bug BZ 1448821 existing for hyperv and
rhevm, no the reminder info.
virt-who process number should always be
only one.
Always send the mapping as interval time
and don't exit 
RHEL7-53807 - 1008-Check virt-who oneshot function by /etc/sysconfig/virt-who option
Step
***For all hypervisor
NOTE: disable the oneshot  option in
/etc/virt-who.conf
1. Enable oneshot  and disable interval
time
# vi /etc/sysconfig/virt-who
VIRTWHO_ONE_SHOT=1
#VIRTWHO_INTERVAL
2. restart virt-who service
# systemctl restart virt-who
3. check rhsm.log
# tail -f /var/log/rhsm/rhsm.log
Expected Result
Refer to BZ 1300512
only send the mapping info one time
- should print reminder info - "Thread 'xxx'
stopped after running once" to rhsm log.
***Bug BZ 1448821 existing for hyperv and
rhevm, no the reminder info.
4. check virt-who process no changes
# ps -ef|grep virt-who
No virt-who process exists.
5. Disable oneshot
# vi /etc/sysconfig/virt-who
VIRTWHO_ONE_SHOT=0
4. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
always send the mapping info according to
interval time
RHEL7-53808 - 1009-Check the send function for different interval value by CLI
Step
Expected Result
***For all hypervisor
NOTE?
- The send function means how long will
virt-who check and send the host/guests
json to SAM/Satellite/Stage Candlepin
- Make sure the hypervirsior has no any
update event trigger for this cases.
- Disable the interval option in /etc/virt-
who.conf
Before the case, make sure the
host/hypervisor and guest have been
registered successfully, the
host/hypervisor is subscribed with
Datacenter physical pool and one guest is
registered with Datacenter bonus pool.
1.stop virt-who service
# systemctl stop virt-who
2.Run virt-who without -i option
# virt-who -d
[Note]: please define the hypervisor mode
by yourself, if no hypervisor mode defined,
virt-who will run for local libvirt mode
Refer to BZ 1220977 BZ 1230041 BZ
1294777 BZ 1314205 BZ 1271252 BZ
1366999, BZ 1314902, BZ 1320833 BZ
1392390, Bug 1509601
virt-who will wait for 3600 seconds to loop,
then give the "Duplicate report found,
ignoring"  and "No data to send, waiting for
next interval" info  feedback;
3. Check the consumed info on
host/hypervisor and guest.
should still be subscribed with Datacenter
pool successfully.
4.Run virt-who with -i option value (N < 60)
# virt-who -d -i 10
# tail -f /var/log/rhsm/rhsm.log
It will show warning info as the following:
"Interval value can't be lower than 60
seconds. Default value of 3600 seconds
will be used."
virt-who will wait for 3600 seconds  to loop
and give the "Duplicate report found,
ignoring"  and "No data to send, waiting for
next interval"
info feedback once;
***Bug 1519704, wrong reminder info
"Interval value can't be lower than 3600
seconds"
5. Check the consumed info on
host/hypervisor and guest.
should still be subscribed with Datacenter
pool successfully.
6.Run virt-who with -i option value (N > 60)
 # virt-who -d -i 120
# tail -f /var/log/rhsm/rhsm.log
7. Check the consumed info on
host/hypervisor and guest.
8. check virt-who thread number
# ps -ef|grep virt-who
virt-who will wait for 120 seconds to
loop and give the "Duplicate report found,
ignoring"  and "No data to send, waiting for
next interval" info  feedback once;  
should still be subscribed with Datacenter
pool successfully.
virt-who process should also be only one
RHEL7-53809 - 1010-Check the send function for different interval value by
/etc/sysconfig/virt-who option
Step
Expected Result
Refer to BZ 1220977  BZ 1207984 BZ
1224190 BZ 1314205  BZ 1406709
***For all hypervisor
NOTE: The send function means how long
will virt-who check and send the
host/guests json to SAM/Satellite/Stage
Candlepin
- Disable the interval option in /etc/virt-
who.conf
Before the case, make sure the
host/hypervisor and guest have been
registered successfully, the
host/hypervisor is subscribed with
Datacenter physical pool and one guest is
registered with Datacenter bonus pool.
1. disable interval time
# vi /etc/sysconfig/virt-who
#VIRTWHO_INTERVAL
[Note]: please define the hypervisor mode
by yourself under /etc/sysconfig/virt-who or
/etc/virt-who.d/*.conf, if no hypervisor
mode defined, virt-who will run for local
libvirt mode
2. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
virt-who will wait for 3600 seconds to loop,
then give the "Duplicate report found,
ignoring"  and "No data to send, waiting for
next interval" info  feedback;
3. Check the consumed info on
host/hypervisor and guest.
should still be subscribed with Datacenter
pool successfully.
4. set interval time N < 60
# vi /etc/sysconfig/virt-who
VIRTWHO_INTERVAL=10
5. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
It will show warning info as the
following:
"Interval value can't be lower than 60
seconds. Default value of 3600
seconds will be used."
virt-who will wait for 3600 seconds 
to loop and give the "Duplicate
report found, ignoring"  and "No data
to send, waiting for next interval"
info feedback once;
***Bug 1519704, wrong reminder info
"Interval value can't be lower than 3600
seconds"
6. Check the consumed info on
host/hypervisor and guest.
should still be subscribed with Datacenter
pool successfully.
7. set interval time N > 60
# vi /etc/sysconfig/virt-who
VIRTWHO_INTERVAL=120
8. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
virt-who will wait for 120 seconds to
loop and give the "Duplicate report found,
ignoring"  and "No data to send, waiting for
next interval" info  feedback once; 
9. Check the consumed info on
host/hypervisor and guest.
should still be subscribed with Datacenter
pool successfully.
7. check virt-who thread number
# ps -ef|grep virt-who
virt-who process should also be only one
with different interval time.
8. restart virt-who service 5 times
and check virt-who thread number
# ps -ef|grep virt-who
virt-who process should also be only
one after virt-who restart.
RHEL7-86136 - 1011-[WebUI - Satellite] Check the Hypervisors task with different interval
value
Step
***For all hypervisor
1. Configure virt-who with only one
hypervisor mode and
'VIRTWHO_INTERVAL=60'
2. restart virt-who service.
Expected Result
Rerfer Bug 1409811
virt-who can be restart and send
host/guest mapping to satellite server
3. Check the hypervisors task info on
Satellite WebUI -> 'Monitor' -> 'Tasks'.
4. Configure virt-who with only one
hypervisor mode and
'VIRTWHO_INTERVAL=120'.
5. restart virt-who service, then check
hypervisors task info.
6. Configure virt-who with two hypervisor
mode and 'VIRTWHO_INTERVAL=3600'.
7. restart virt-who service, then check
hypervisors task info.
successfully.
restarting virt-who service will make one
"Hypervisors" task.
1) then if no trigger to the guests, will no
new tasks appear
2) if make trigger option to guests in each
interval time, it will make new tasks each
60s, no flooding tasks queue.
restarting virt-who service will make one
"Hypervisors" task.
1) then if no trigger to the guests, will no
new tasks appear
2) if make trigger option to guests in each
interval time, it will make new tasks each
120s, no flooding tasks queue.
restarting virt-who service will make two
"Hypervisors" tasks.
1) then if no trigger to the guests, will no
new tasks appear.
2) if make trigger option to guests in each
interval time, it will make new tasks each
3600s, no flooding tasks queue.
RHEL7-53810 - 1012-Check the fetch function for different interval value by CLI
Step
***For all hypervisor
NOTE: The fetch function means how long
will virt-who check and fetch host/guests
json from hypervisors
Expected Result
Refer to Bug 1509606 
1.stop virt-who service
# systemctl stop virt-who 
2.run virt-who without -i option
# virt-who -d
[Note]: please define the hypervisor mode
by yourself, if no hypervisor mode defined,
virt-who will run for local libvirt mode
3.run virt-who with -i option value (N < 60)
# virt-who -d -i 10
# tail -f /var/log/rhsm/rhsm.log
will loop 3600 seconds by default and give
log:
Report for config "env/cmdline" gathered,
placing in datastore
will loop 36o0 seconds by setting and give
log:
Report for config "env/cmdline" gathered,
placing in datastore
4.run virt-who with -i option value (N > 60)
 # virt-who -d -i 120
# tail -f /var/log/rhsm/rhsm.log
will loop 120 seconds by setting and give
log:
Report for config "env/cmdline" gathered,
placing in datastore
RHEL7-53811 - 1013-Check the fetch function for different interval value by
/etc/sysconfig/virt-who
Expected Result
Refer to Bug 1509606
Step
***For all hypervisor
NOTE: The fetch function means how long
will virt-who check and fetch host/guests
json from hypervisors ?
1. disable interval time
# vi /etc/sysconfig/virt-who
#VIRTWHO_INTERVAL
[Note]: please define the hypervisor mode
by yourself, if no hypervisor mode defined,
virt-who will run for local libvirt mode
2. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
will loop 3600 seconds by default and give
log:
Report for config "env/cmdline" gathered,
placing in datastore
3. set interval time N < 60
# vi /etc/sysconfig/virt-who
VIRTWHO_INTERVAL=10
4. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
will loop 3600 seconds by default and give
log:
Report for config "env/cmdline" gathered,
placing in datastore.
5. set interval time N > 60
# vi /etc/sysconfig/virt-who
VIRTWHO_INTERVAL=120
6. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
will loop 120 seconds by default and give
log:
Report for config "env/cmdline" gathered,
placing in datastore.
RHEL7-53812 - 1014-Check virt-who trigger function by hypervisor event
Step
Expected Result
***For all hypervisor
NOTE: The trigger event means if the host
or guests have some changes, such as
add / delete / pause / resume / poweroff
Refer to BZ 1229211 BZ 1309165 BZ
1454541, Bug 1458674
/poweron, virt-who will be triggered by
these event.
1. set the interval value to 10 seconds
2. restart virt-who service
3. make sure host and guests have some
changes, such as add a guest, and then
check the rhsm.log
(other event: add
/delete/pause/resume/poweron/poweroff a
guest)
4. set the interval value to 120 seconds
5. restart virt-who service
6. make sure host and guests have some
changes, such as add a guest, and then
check the rhsm.log
7. set the interval value to 3600 seconds
8. restart virt-who service
9. make sure host and guests have some
changes, such as add a guest, and then
check the rhsm.log
1). if kvm, esx, xen, when trigger occurred,
it will show remind info immediately as
the following in the log. However, the
update info can't show until wait for
60s. 
"Report for config "env/cmdline" gathered,
placing in datastore"
2). if vdsm, rhevm, hyper-v, can't be
triggered by auto, will loop 60 seconds by
default to give new updated mapping, but
shouldn't skip one interval
***BZ 1454541 existing for rhevm and
hyper-v, skip one interval time.
***Bug 1415050 for xen/kvm, make
redundant log
1). if kvm, esx, xen, when trigger
occurred, it will show remind info
immediately. However, the update
info can't show until wait for 120s. 
2). if vdsm, rhevm, hyper-v, can't be
triggered by auto, will loop 120 seconds by
default to give new updated mapping, but
shouldn't skip one interval.
***BZ 1454541 existing for rhevm and
hyperv, skip one interval time.
***Bug 1415050 for xen/kvm, make
redundant log
1). if kvm, esx, xen, when trigger
occurred, it will show remind info
immediately. However, the update
info can't show until wait for 3600s. 
2). if vdsm, rhevm, hyper-v, can't be
triggered by auto, will loop 3600 seconds
by default to give new updated mapping,
but shouldn't skip one interval.
***BZ 1454541 existing for rhevm and
hyperv, skip one interval time.
***Bug 1415050 for xen/kvm, make
RHEL7-53813 - 1015-Check virt-who -p function by CLI
redundant log
Step
Expected Result
***For all hypervisor
Refer to BZ 1359640
1.stop virt-who service
# systemctl stop virt-who
2.Run virt-who with -p option
# virt-who -p
[Note]: please define the
hypervisor mode by yourself, if no
hypervisor mode defined, virt-who
will run for local libvirt mode
3. Run virt-who with -p -d option
# virt-who -p -d
virt-who should be run normally and the json info
should be output as the following:
{"hypervisors": [{"uuid": "c74a4d56-677e-
dd13-828f-617c5cdf0329", "guests": [{"guestId":
"4206ee69-f83e-c97f-521f-4af794d5cde9", "state":
5, "attributes": {"active": 0, "virtWhoType": "esx"}}],
"facts": {"hypervisor.type": "VMware ESXi",
"cpu.cpu_socket(s)": "4", "hypervisor.version":
"6.0.0"}, "name":
"bootp-73-5-222.rhts.eng.pek2.redhat.com"}]}
- It should show host's attributions as the
following:
"facts(cpu.cpu_socket(s),hypervisor.type,
hypervisor.version),
 guests
 name
 uuid"
- It should show all guest's attributions like
"attributes(active, virtWhoType)
 guestId
 state"
virt-who should be run normally and the
json info should be output as the following:
    "hypervisors": [
        {
            "facts": {
                "cpu.cpu_socket(s)": "4", 
                "hypervisor.type": "VMware
ESXi", 
                "hypervisor.version": "6.0.0"
            }, 
            "guests": [
                {
                    "attributes": {
                        "active": 0, 
                        "virtWhoType": "esx"
                    }, 
                    "guestId": "4206ee69-f83e-
c97f-521f-4af794d5cde9", 
                    "state": 5
                }
            ], 
            "name":
"bootp-73-5-222.rhts.eng.pek2.redhat.com",
 
            "uuid": "c74a4d56-677e-
dd13-828f-617c5cdf0329"
        }}]
4. export the json info to json.log
# virt-who -p -d > json.log
virt-who should be run normally and the json info
should be exported to json.log without any other
[DEBUG] message.
RHEL7-53814 - 1016-Check virt-who -c option by CLI
Step
***Not for Local_Libvirt
1.stop virt-who service
# systemctl stop virt-who
2. Prepare two config file such as
# vi /root/rhevm.conf
[test-rhevm]
type=rhevm
server=https://10.66.79.23:443
username=admin@internal
password=redhat
owner=7661967
env=7661967
# vi /root/esx.conf
[test-esx]
type=esx
server=10.73.3.222
username=administrator@vsphere.local
password=Welcome1!
owner=7661967
env=7661967
3.Run virt-who with -c option
# virt-who -c /root/rhevm.conf -o -d
# virt-who --config=/root/esx.conf  -o -d
4. move or copy the two config file to
/etc/virt-who.d/
#ls /etc/virt-who.d/
Expected Result
Refer to BZ 1391913 
- with -c or --config option, virt-who should
be run normally and the json info is OK.
- virt-who will only run the configuration
file, which the -c/--config option set.
rhevm.conf  esx.conf
5. Run virt-who with -c option
# virt-who -c /etc/virt-who.d/rhevm.conf -o -
d
# virt-who --config=/etc/virt-who.d/esx.conf 
-o -d
- with -c or --config option, virt-who should
be run normally and the json info is OK.
- virt-who will only run the configuration
file, which the -c/--config option set.
***BZ 1391913 existing, -c option issue
RHEL7-87426 - 1017-Check virt-who all the listed options, such as: -m , -l , -r
Step
***For all hypervisor
NOTE: Need to make sure: all the --help
options are defined by "man virt-who"
1. check all the available options by --help
and "man  virt-who"
2. check all the listed options, such as: -m,
-l, -r
3. run virt-who CLI with -m or --log-
per-config
# virt-who -d  -o  -m
# virt-who -d  -o  --log-per-config
4. run virt-who CLI with -l LOG_DIR
or --log-dir=LOG_DIR
# virt-who -d  -o -d -l
/var/log/rhsm/virtwho/
# virt-who -d  -o -d --log-
dir=/var/log/rhsm/virtwho/
5. run virt-who CLI with -r
REPORTER_ID, --reporter-
id=REPORTER_ID
# virt-who -d  -o -d  -r xxx_id_test
# virt-who -d  -o -d  --reporter-
id=xxx_id_test
Expected Result
Refer to BZ 1436581 
Write one log file per configured
virtualization
backend. Implies a log_dir of
/var/log/rhsm/virtwho (Default: all
messages are written to a single log
file)
***BZ 1436581 existing, -m -l -f
-l LOG_DIR, --log-dir=LOG_DIR
The absolute path of the directory to
log to. (Default '/var/log/rhsm')
***BZ 1436581 existing, -m -l -f
-r REPORTER_ID, --reporter-
id=REPORTER_ID
Label host/guest associations
obtained by this
instance of virt-who with the
provided id.
***BZ 1436581 existing, -m -l -f
RHEL7-53815 - 1018-Check virt-who --sam and --satellite6 option by CLI
Step
***For all hypervisor
1.stop virt-who service
Expected Result
Refer to Bug 1409055 Bug 1368341
# systemctl stop virt-who
2. Run virt-who with --sam
# virt-who -o -d --sam
[Note]: please define the hypervisor mode
by yourself, if no hypervisor mode defined,
virt-who will run for local libvirt mode
4. Run virt-who with --satellite6
# virt-who -o -d --satellite6
 --sam  Report host/guest associations to
the Subscription Asset Manager or
Satellite 6 [default]
virt-who should be run normally, the json
info is OK
- hypervisor can be registered to SAM
server.
- hypervisor can not be registered to
Satellite6
server and Stage Candlepin
***Bug 1368341 Bug 1409055
--satellite6 Report host/guest associations
to the Satellite 6 Server
virt-who should be run normally and the
json info is OK.
- hypervisor can be registered to Satellite6
server.
- hypervisor can not be registered to SAM
server and Stage Candlepin
***Bug 1368341 Bug 1409055
RHEL7-53816 - 1019-[Satellite5.X] Check virt-who --satellite5 option by CLI
Step
Expected Result
***Only for satellite5.X server
1.stop virt-who service
# systemctl stop virt-who
2. Run virt-who with --satellite5
# virt-who --satellite5 --satellite-
server=SAT_SERVER --satellite-
username=SAT_USERNAME --satellite-
password=SAT_PASSWORD
--satellite5 Report host/guest associations
to the Satellite 5 Server
virt-who should be run normally and the
json info is OK
RHEL7-53817 - 1020-[Satellite5.X] Check virt-who --satellite5 option by /etc/sysconfig/virt-
who
Step
Expected Result
***Only for satellite5.X server
1. config satellite5 option in
/etc/sysconfig/virt-who, such as:
VIRTWHO_SATELLITE5=1
VIRTWHO_SATELLITE_SERVER=xxxx
VIRTWHO_SATELLITE_USERNAME=xxxx
VIRTWHO_SATELLITE_PASSWORD=xxxx
2. restart virt-who service and check
--satellite5 Report host/guest
rhsm.log
associations to the Satellite 5 Server
virt-who should be run normally and the
json info is OK
RHEL7-53818 - 1021-Check virt-who --owner option by CLI
Step
Expected Result
Refer to: BZ 1295325, BZ 1211435, BZ
1372620 BZ 1457101, Bug 1458168
***Not for Local_Libvirt, VDSM
NOTE: need to track BZ 1458168 - - [RFE]
When run virt-who by CLI, it should only
run the CLI config mode, ignore other virt-
who config files.
1.stop virt-who service
# systemctl stop virt-who
2. run virt-who without owner option, such
as:
# virt-who --libvirt --libvirt-env=7661967 --
libvirt-server=10.66.129.224 --libvirt-
username=root --libvirt-password=redhat -
o -d
without owner, virt-who fail to start with
error:
" Required command line argument: --
hyperv-owner is not set."
Note: should no "Traceback" info in the
log.
3. run virt-who with owner value is null,
such as:
# virt-who --libvirt --libvirt-owner= --libvirt-
env=7661967 --libvirt-
server=10.66.129.224 --libvirt-
username=root --libvirt-password=redhat -
o -d
4. run virt-who with an wrong owner value
such as:
# virt-who --libvirt --libvirt-owner=xxxxxxx -
-libvirt-env=7661967 --libvirt-
server=10.66.129.224 --libvirt-
username=root --libvirt-password=redhat -
o -d
owner is null, virt-who should show error
info:
" virt-who can't be started: Option `owner`
needs to be set in config `env/cmdline`"
Note: should no "Traceback" info in the
log.
- For Satellite6.2/6.3:
with an wrong owner, virt-who should show
error info, like:
"ManagerError: Cannot send data to:
Default_Organization, because
owner from configuration: xxxxxx is
different”" 
NOTE: if virt-who host has been
registerted to "org2", the error info
should be "ManagerError: Cannot
send data to: org2, because owner
from configuration: xxxxxx is
different”
-For Stage Candlepin:
with an wrong owner, virt-who
should show error info, like:
"ManagerError: Communication with
subscription manager failed with
code 404: Organization with id
xxxxxx could not be found."
with a right owner, virt-who should be run
normally
5. run virt-who with a right owner value,
such as:
# virt-who --libvirt --libvirt-
owner=7661967 --libvirt-env=7661967 --
libvirt-server=10.66.129.224 --libvirt-
username=root --libvirt-password=redhat -
o -d
RHEL7-53819 - 1022-Check virt-who --owner option by /etc/sysconfig/virt-who
Step
Expected Result
***Not for Local_Libvirt, VDSM
Refer to: BZ 1295325, BZ 1211435, BZ
1372620
BZ 1457101 Bug 1510310
1. config /etc/sysconfig/virt-who with all
available options, such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=7661967
VIRTWHO_ESX_ENV=7661967
VIRTWHO_ESX_SERVER=10.66.129.60
VIRTWHO_ESX_USERNAME=root
VIRTWHO_ESX_PASSWORD=redhat
2. restart virt-who service
# systemctl restart virt-who
3. only config /etc/sysconfig/virt-who,
disable owner option, such as:
VIRTWHO_ESX=1
# VIRTWHO_ESX_OWNER=7661967
VIRTWHO_ESX_ENV=7661967
VIRTWHO_ESX_SERVER=10.66.129.60
VIRTWHO_ESX_USERNAME=root
VIRTWHO_ESX_PASSWORD=redhat
4. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# systemctl status virt-who
start virt-who and send mapping normally.
1. failed to start virt-who with reminder
info, such as:
"'VIRTWHO_ESX_OWNER is not set" and
"virt-who can't be started: no valid
configuration found"
***Bug 1516173 existing for remote libvirt,
virt-who still running.
***Bug 1530254 existing for
XEN/ESX/HYPER/RHEVM, wrong
reminder info show.
2. should not run default local libvirt mode.
5. create another valid configuration  by
/etc/virt-who.d/xxx.conf, then restart virt-
who service
start virt-who normally, succeed to report
the valid one, but fail to send the bad one
with reminder info, such as:
6. only config /etc/sysconfig/virt-who with
owner is null, such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=
VIRTWHO_ESX_ENV=7661967
VIRTWHO_ESX_SERVER=10.66.129.60
VIRTWHO_ESX_USERNAME=root
VIRTWHO_ESX_PASSWORD=redhat
7. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
8. create another valid configuration  by
/etc/virt-who.d/xxx.conf, then restart virt-
who service
9. only config /etc/sysconfig/virt-who with
an wrong owner value without non-ASCII,
such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=xxxx
VIRTWHO_ESX_ENV=7661967
VIRTWHO_ESX_SERVER=10.66.129.60
VIRTWHO_ESX_USERNAME=root
VIRTWHO_ESX_PASSWORD=redhat
10. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
"'VIRTWHO_ESX_OWNER is not set"
***Bug 1530254 existing for
XEN/ESX/HYPER/RHEVM, wrong
reminder info show.
start virt-who normally, but fail to send
mapping with reminder info, such as:
"ManagerError: Communication with
subscription manager failed with code
415:" 
***Bug 1516173 [Comment 7] existing,
failed to start virt-who, libvirt special.
start virt-who normally, succeed to report
the valid one, but failed to send the bad
one with reminder info -
"ManagerError: Communication with
subscription manager failed with code
415:"
***Bug 1530254 existing for
XEN/ESX/HYPER/RHEVM, wrong
reminder info show.
start virt-who normally, but failed to send
mapping with reminder info -
- For Satellite6:
"ManagerError: Cannot send data
to: Default_Organization, because
owner from configuration: xxxxxx is
different”" 
-For Stage Candlepin:
"ManagerError: Communication with
subscription manager failed with
code 404: Organization with id
11. create another valid configuration by
/etc/virt-who.d/xxx.conf, then restart virt-
who service
12. only config /etc/sysconfig/virt-who with
an wrong owner value, such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=??©¥®ðπ?
VIRTWHO_ESX_ENV=7661967
VIRTWHO_ESX_SERVER=10.66.129.60
VIRTWHO_ESX_USERNAME=root
VIRTWHO_ESX_PASSWORD=redhat
13. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
xxxxxx could not be found."
start virt-who normally, succeed to report
the valid one, but failed to send the bad
one with reminder info -
- For Satellite6:
"ManagerError: Cannot send data
to: Default_Organization, because
owner from configuration: xxxxxx is
different”" 
-For Stage Candlepin:
"ManagerError: Communication with
subscription manager failed with
code 404: Organization with id
xxxxxx could not be found."
start virt-who normally, but failed to send
mapping with reminder info -
- stage candlepin: "JSON parsing error: No
JSON object could be decoded" and
"Communication with subscription
manager failed with code 500"
- satellite6: "(owner_id,
config['owner'])" and
"UnicodeDecodeError: 'ascii' codec
can't decode byte 0xe7 in position 0:
ordinal not in range(128)"
NOTE:
- for stage, the owner/env is
stable, just with number.
- for satellite, when new create an
organization, cannot contain
characters other than ascii alpha
numerals
14. create another valid configuration by
/etc/virt-who.d/xxx.conf, then restart virt-
who service
start virt-who normally, succeed to report
the valid one, but failed to send the bad
one with reminder info like step13.
RHEL7-53820 - 1023-Check virt-who --owner option by /etc/virt-who.d config file
Step
Expected Result
***Not for Local_Libvirt, VDSM
Refer to: BZ 1295325, BZ 1211435, BZ
1372620, BZ 1401773, BZ 1363943  BZ
1457101
1. create a config file with all available
options in /etc/virt-who.d/, such as:
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=7661967
env=7661967
2. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
3. only create a config file without owner
option in /etc/virt-who.d/, such as:
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
# owner=7661967
env=7661967
4. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# systemctl status virt-who
5. create another valid configuration, then
restart virt-who service
6. only create a config file with owner is
null in /etc/virt-who.d/, such as:
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=
start virt-who and send mapping normally
failed to start virt-who with reminder info -
"KeyError: 'owner not in stage-xen'" in
rhsm log and "virt-who can't be started: no
valid configuration found" by command
"systemctl status virt-who.service"
***Bug 1516173 [comment 7] existing for
RHEVM/XEN/HYPERV/LIBVIRT, still can
start virt-who.
start virt-who normally, succeed to send
the valid one, but failed to send the bad
one with reminder info -
"KeyError: 'owner not in stage-xen'" in
rhsm log
***Bug 1516173 [step2] existing for ESX,
reminder info is not uniform with others.
start virt-who normally, but failed to send
the mapping with reminder info -
"ManagerError: Communication with
subscription manager failed with code
415:"
start virt-who normally, succeed to report
the valid one, but failed to send the bad
one with reminder info -
"ManagerError: Communication with
subscription manager failed with code
415:"
start virt-who normally, but failed to send
mapping with reminder info -
- For Satellite6:
"ManagerError: Cannot send data to:
Default_Organization, because
owner from configuration: xxxxxx is
different”" 
-For Stage Candlepin:
"ManagerError: Communication with
subscription manager failed with
code 404: Organization with id
xxxxxx could not be found."
start virt-who normally, succeed to report
the valid one, but failed to send the bad
one with reminder info like above step10
env=7661967
7. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
8. create another valid configuration, then
restart virt-who service
9. create a config file with an wrong owner
value without non-ASCII in /etc/virt-who.d/,
such as:
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=xxxxxx
env=7661967
10. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
11. create another valid configuration, then
restart virt-who service
12. create a config file with an wrong
owner value with non-ASCII in /etc/virt-
who.d/, such as:
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=??©¥®ðπ?
env=7661967
13. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
14. create another valid configuration, then
restart virt-who service
start virt-who normally, but failed to send
mapping with reminder info -
- stage candlepin: "JSON parsing error: No
JSON object could be decoded"  and
"Communication with subscription
manager failed with code 500"
- satellite6: "(owner_id,
config['owner'])" and
"UnicodeDecodeError: 'ascii' codec
can't decode byte 0xe7 in position 0:
ordinal not in range(128)"
- for stage, the owner/env is stable, just
with number.
- for satellite, when new create an
organization, cannot contain characters
other than ascii alpha numerals
start virt-who normally, succeed to report
the valid one, but failed to send the bad
one with reminder info like above step 13.
RHEL7-53821 - 1024-Check virt-who --env option by CLI
Step
Expected Result
***Not for Local_Libvirt, VDSM
Refer to: BZ 1372620, BZ 1409056 BZ
1457101, BZ 1211435
1.stop virt-who service
# systemctl stop virt-who
2. run virt-who without env, such as:
# virt-who --libvirt --libvirt-owner=7661967 -
-libvirt-server=10.66.129.224 --libvirt-
username=root --libvirt-password=redhat -
o -d
without env,
virt-who should show error info, like:
"virt-who can't be started: Option `env`
needs to be set in config `env/cmdline`"
Note: should no "Traceback" info in the log
***Bug 1530232 for libvirt, still report
mapping.
3. run virt-who with an wrong env value
such as:
# virt-who --libvirt --libvirt-owner=7661967 -
-libvirt-env=xxxxxx --libvirt-
server=10.66.129.224 --libvirt-
username=root --libvirt-password=redhat -
o -d
with an wrong env,
- for Satellite6: virt-who should start
normally with error info, like:
"ManagerError: Cannot send data to:
Default_Organization, because Satellite
env: Library differs from configuration:
xxxxx"
- for Stage Candlepin: virt-who should fail
to send mapping with reminder info -
"???".
***Bug 1530426  for stage, still report
normally
***Bug 1530232 for libvirt, still report
mapping.
with a right env, virt-who should be run
normally
4. run virt-who with a right env value, such
as:
# virt-who --libvirt --libvirt-owner=7661967 -
-libvirt-env=7661967 --libvirt-
server=10.66.129.224 --libvirt-
username=root --libvirt-password=redhat -
o -d
RHEL7-53822 - 1025-Check virt-who --env option by /etc/sysconfig/virt-who
Step
Expected Result
***Not for Local_Libvirt, VDSM
Refer to: BZ 1372620, BZ 1409056 BZ
1457101 Bug 1510310
1. config /etc/sysconfig/virt-who with all
available options, such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=7661967
VIRTWHO_ESX_ENV=7661967
VIRTWHO_ESX_SERVER=10.66.129.60
VIRTWHO_ESX_USERNAME=root
VIRTWHO_ESX_PASSWORD=redhat
2. restart virt-who service
# systemctl restart virt-who
3. only config /etc/sysconfig/virt-who,
disable env option, such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=7661967
#VIRTWHO_ESX_ENV=7661967
VIRTWHO_ESX_SERVER=10.66.129.60
VIRTWHO_ESX_USERNAME=root
VIRTWHO_ESX_PASSWORD=redhat
4. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
start virt-who and send mapping normally.
1. failed to start virt-who with reminder
info, such as:
"'VIRTWHO_ESX_ENV is not set" and
"virt-who can't be started: no valid
configuration found"
***Bug 1530290: existing for libvirt, virt-
who still running.
***Bug 1530232 for libvirt, also send
mapping out.
***Bug 1530254 existing for
XEN/ESX/HYPER/RHEVM, wrong
reminder info show.
-2. should not run default local libvirt
mode.
5. create another valid configuration  by
start virt-who normally, succeed to report
/etc/virt-who.d/xxx.conf, then restart virt-
who service
the valid one, but fail to send the bad one
with reminder info, such as:
"'VIRTWHO_ESX_OWNER is not set"
***Bug 1530254 existing for
XEN/ESX/HYPER/RHEVM, wrong
reminder info show.
***Bug 1530232 for libvirt, also send
mapping out.
6. only config /etc/sysconfig/virt-who
with env option is null, such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=7661967
VIRTWHO_ESX_ENV=
VIRTWHO_ESX_SERVER=10.66.129.60
VIRTWHO_ESX_USERNAME=root
VIRTWHO_ESX_PASSWORD=redhat
7. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
8. create another valid configuration  by
/etc/virt-who.d/xxx.conf, then restart virt-
who service
9. only config /etc/sysconfig/virt-who with
an wrong env value without non-ASCII,
such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=7661967
VIRTWHO_ESX_ENV=xxxx
VIRTWHO_ESX_SERVER=10.66.129.60
VIRTWHO_ESX_USERNAME=root
VIRTWHO_ESX_PASSWORD=redhat
10. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
start virt-who normally, but fail to send
mapping with reminder info, such as:
"ManagerError: Communication with
subscription manager failed with code
415:" 
***Bug 1530290 for
ESX/HYPERV/RHEVM/XEN, fail to start
virt-who
***Bug 1530232 for LIBVIRT, also send
mapping out.
start virt-who normally, succeed to report
the valid one, but failed to send the bad
one with reminder info -
"ManagerError: Communication with
subscription manager failed with code
415:"
***Bug 1530232 for LIBVIRT, also send
mapping out.
***Bug 1530254 existing for
XEN/ESX/HYPER/RHEVM, wrong
reminder info show.
start virt-who normally, but failed to send
mapping with reminder info -
for Satellite62: "ManagerError: Cannot
send data to: Default_Organization,
11. create another valid configuration  by
/etc/virt-who.d/xxx.conf, then restart virt-
who service
12. only config /etc/sysconfig/virt-who with
an wrong env value with non-ASCII, such
as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=7661967
VIRTWHO_ESX_ENV=??©¥®ðπ?
VIRTWHO_ESX_SERVER=10.66.129.60
VIRTWHO_ESX_USERNAME=root
VIRTWHO_ESX_PASSWORD=redhat
13. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
14. create another valid configuration  by
/etc/virt-who.d/xxx.conf, then restart virt-
who service
because Satellite env: Library differs from
configuration: xxxx"
***Bug 1530426 for stage, also send out
mapping
start virt-who normally, succeed to report
the valid one, but failed to send the bad
one with reminder info like above step10.
***Bug 1530426 for stage, also send out
mapping
start virt-who normally, but failed to send
mapping with reminder info -
- stage candlepin: "JSON parsing error: No
JSON object could be decoded"  
- satellite6: "(owner_id,
environment_name, config['env'])"
and "UnicodeDecodeError: 'ascii'
codec can't decode byte 0xe7 in
position 0: ordinal not in range(128)"
NOTE:
- for stage, the owner/env is
stable, just with number.
- for satellite, when new create an
organization, cannot contain
characters other than ascii alpha
numerals
***Bug 1530426 for stage, also send
out mapping
start virt-who normally, succeed to report
the valid one, but failed to send the bad
one with reminder info like above step13
***Bug 1530426 for stage, also send out
mapping
RHEL7-53823 - 1026-Check virt-who --env option by /etc/virt-who.d config file
Step
Expected Result
***Not for Local_Libvirt, VDSM
Refer to BZ 1318566 BZ 1363943, BZ
1409056 BZ 1457101
1. create a config file with all available
options in /etc/virt-who.d/, such as:
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=7661967
env=7661967
2. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
3. only create a config file without env
option in /etc/virt-who.d/, such as:
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=7661967
#env=7661967
4. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# systemctl status virt-who
5. create another valid configuration, then
restart virt-who service
6. only create a config file with env option
is null in /etc/virt-who.d/, such as:
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=7661967
env=
7. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
start virt-who and send mapping normally
failed to start virt-who with reminder info -
"[sat-esx]: Required option: "env" not set."
in rhsm log and "virt-who can't be started:
no valid configuration found" by command
"systemctl status virt-who.service"
***Bug 1530290 for
HEPERV/XEN/ESX/RHEVM/LIBVIRT, still
succeed to start and send mapping
start virt-who normally, succeed to send
the valid one, but failed to send the bad
one with reminder info like above step4.
**Bug 1530290 for
HEPERV/XEN/ESX/RHEVM/LIBVIRT, still
succeed to start and send mapping.
start virt-who normally, but failed to send
the mapping with reminder info -
"ManagerError: Communication with
subscription manager failed with code
415:"
8. create another valid configuration, then
restart virt-who service
9. only create a config file with an wrong
env value without non-ASCII in /etc/virt-
who.d/, such as:
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=7661967
env=xxxxxx
10. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
11. create another valid configuration, then
restart virt-who service
12. only create a config file with an wrong
env value with non-ASCII in /etc/virt-
who.d/, such as:
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=7661967
env=??©¥®ðπ?
13. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
***Bug 1530290 for all, still send mapping
out
start virt-who normally, succeed to report
the valid one, but failed to send the bad
one with reminder info -
"ManagerError: Communication with
subscription manager failed with code
415:"
***Bug 1530290 for all, still send mapping
out
start virt-who normally, but failed to send
mapping with reminder info -
for satellite62: "ManagerError: Cannot
send data to: Default_Organization,
because Satellite env: Library differs from
configuration: xxxx"
***Bug 1530426 for stage, also send out
mapping
start virt-who normally, succeed to report
the valid one, but failed to send the bad
one with reminder info like above step10
***Bug 1530426 for stage, also send out
mapping
start virt-who normally, but failed to send
mapping with reminder info -
- stage candlepin: "JSON parsing error: No
JSON object could be decoded"
- satellite6: "(owner_id,
environment_name, config['env'])"
14. create another valid configuration, then
restart virt-who service
and "UnicodeDecodeError: 'ascii'
codec can't decode byte 0xe7 in
position 0: ordinal not in range(128)"
***Bug 1530426 for stage, also send
out mapping
start virt-who normally, succeed to report
the valid one, but failed to send the bad
one with reminder info like above step13.
***Bug 1530426 for stage, also send out
mapping
RHEL7-79906 - 1027-Check --[virtwho_type]-username and --[virtwho_type]-password
option by CLI
Step
Expected Result
Refer to BZ 1337407 BZ 1458168, Bug 1506156, Bug
1510760 
without --virtwho_type-username, virt-who should
show error info as the following:
"Required parameter 'username' is not set, exiting"
with --virtwho_type-username value is null, virt-who
should show error info as the following:
"Required parameter 'username' is not set, exiting"
***Not for Local_Libvirt,
VDSM
NOTE: should track
Bug 1458168 - [RFE]
When run virt-who by CLI,
it should only run the CLI
config mode, ignore other
virt-who config files.
NOTE: Need to track Bug
1506156 - When
username/password
options are disabled or the
values are not right or even
no values, virt-who should
provide some uniform
message
1.stop virt-who service
# systemctl stop virt-who
2. run virt-who without "--
[virtwho_type]-username",
such as:
# virt-who --esx --esx-
owner=7661967 --esx-
env=7661967 --esx-
server=10.66.129.224 --
esx-password=redhat -o -d 
3. run virt-who with "--
[virtwho_type]-username"
value is null, such as:
# virt-who --esx --esx-
owner=7661967 --esx-
env=7661967 --esx-
server=10.66.129.224 --
esx-username= --esx-
password=redhat -o -d
4. run virt-who with
wrong"--[virtwho_type]-
username" , such as:
# virt-who --esx --esx-
owner=7661967 --esx-
env=7661967 --esx-
server=10.66.129.224 -
-esx-username=xxxxx -
-esx-password=redhat -
o -d
5. run virt-who without
"--[virtwho_type]-
password", such as:
# virt-who --esx --esx-
owner=7661967 --esx-
env=7661967 --esx-
server=10.66.129.224 -
-esx-username=root -o
-d 
with wrong value of --virtwho_type-username, virt-
who should start normally and show error info as
the following:
-for esx:  'Cannot complete login due to an
incorrect user name or password.'
- for rhevm: 'Unable to connect to RHEV-M
server: 401 Client Error: Unauthorized'
-
for xen:['SESSION_AUTHENTICATION_FAILED',
'xxxxxx', 'Authentication failure']
-for hyperv: 'Incorrect
domain/username/password'
-for libvirt: libvirtError: Cannot recv data: Host key
verification failed.: Connection reset by peer
without password, virt-who should start normally
and show error info as the following:
-for esx: 'Cannot complete login due to an
incorrect user name or password.'
- for rhevm: 'Unable to connect to RHEV-M
server: 401 Client Error: Unauthorized'
-for xen:
'SESSION_AUTHENTICATION_FAILED', 'root',
'Authentication failure'
-for hyperv: ''Incorrect
domain/username/password''
-for libvirt: no error, can send mapping
successfully.
6. run virt-who with "--
[virtwho_type]-
password" value is null,
such as:
# virt-who --esx --esx-
owner=7661967 --esx-
env=7661967 --esx-
server=10.66.129.224 -
-esx-username=root -o
-d --esx-password= -d -
with password value is null, virt-who should start normally
and show error info as the following:
-for esx: 'Cannot complete login due to an incorrect user
name or password.'
- for rhevm: 'Unable to connect to RHEV-M server: 401
Client Error: Unauthorized'
-for xen: 'SESSION_AUTHENTICATION_FAILED', 'root',
'Authentication failure'
-for hyperv: ''Incorrect domain/username/password''
-for libvirt: no error, can send mapping successfully.
with wrong password, virt-who should start normally and
show error info as the following:
-for esx: 'Cannot complete login due to an incorrect user
name or password.'
- for rhevm: 'Unable to connect to RHEV-M server: 401
Client Error: Unauthorized'
-for xen: ['SESSION_AUTHENTICATION_FAILED', 'root',
'Authentication failure']
-for hyperv: 'Incorrect domain/username/password'
-for libvirt: no error, can send mapping successfully.
with correct  --virtwho_type-username and  --
virtwho_type-password, virt-who can send
mapping to server successfully.
virt-who can send mapping to server successfully.
o
7. run virt-who with
wrong"--[virtwho_type]-
password" , such as:
# virt-who --esx --esx-
owner=7661967 --esx-
env=7661967 --esx-
server=10.66.129.224 -
-esx-username=root --
esx-password=xxxx -o -
d
8. run virt-who with
correct"--
[virtwho_type]-
username" and "--
[virtwho_type]-
password" , such as:
# virt-who --esx --esx-
owner=7661967 --esx-
env=7661967 --esx-
server=10.66.129.224 -
-esx-username=root --
esx-password=redhat -
o -d
9. run virt-who with
correct"--
[virtwho_type]-
username" and "--
[virtwho_type]-
password" and these
value with single
quotes or double
quotes, such as:
# virt-who --esx --esx-
owner=7661967 --esx-
env=7661967 --esx-
server=10.66.129.224 -
-esx-username="root" -
-esx-
password="redhat" -o -
d
RHEL7-79907 - 1028-Check VIRTWHO_[virtwho_type]_USERNAME and
VIRTWHO_[virtwho_type]_PASSWORD by /etc/sysconfig/virt-who
Step
***Not for Local_Libvirt, VDSM
Expected Result
Refer to BZ 1337407 BZ 1458184  Bug 1516645 Bug
1512778
1. config /etc/sysconfig/virt-who with all available options, such as:
VIRTWHO_=1
VIRTWHO_ESX_OWNER=7985933
VIRTWHO_ESX_ENV=7985933
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_SERVER=10.73.2.95
VIRTWHO_ESX_PASSWORD=Welcome1!
2. restart virt-who service
# systemctl restart virt-who
3. config /etc/sysconfig/virt-who, disable username option, such as:
VIRTWHO_=1
VIRTWHO_ESX_OWNER=7985933
VIRTWHO_ESX_ENV=7985933
#VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_SERVER=10.73.2.95
VIRTWHO_ESX_PASSWORD=Welcome1!
4. restart virt-who service and check rhsm.log
# systemctl restart virt-who
# systemctl status virt-who
# ps -ef |grep virt-who
5. create another valid configuration by /etc/virt-who.d/xxx.conf, then
restart virt-who service
6. only config /etc/sysconfig/virt-who with username option value is
null, such as:
VIRTWHO_=1
VIRTWHO_ESX_OWNER=7985933
VIRTWHO_ESX_ENV=7985933
VIRTWHO_ESX_USERNAME=
VIRTWHO_ESX_SERVER=10.73.2.95
start virt-who and send mapping normally.
failed to start virt-who with reminder info -
"'VIRTWHO_RHEVM_USERNAME' is not set." in rhsm
log, and "Status: "virt-who can't be started: no valid
configuration found"" when run "# systemctl status virt-
who"
- virt-who should not be runing and process doesn't exist.
***Bug 1426040 for libvirt, should support use username
and password.
***Bug 1530841 for xen/esx/hyperv/rhevm, wrong
reminder info
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with reminder info, such as:
"Error: reading environment variables for virt. type: rhevm:
Required env. variable:
'VIRTWHO_RHEVM_USERNAME' is not set."
***Bug 1426040 for libvirt, should support use username
and password.
***Bug 1530841 for xen/esx/hyperv/rhevm, wrong
reminder info
VIRTWHO_ESX_PASSWORD=Welcome1!
7. restart virt-who service and check rhsm.log
# systemctl restart virt-who
8. create another valid configuration by /etc/virt-who.d/xxx.conf, then
restart virt-who service
9. only config /etc/sysconfig/virt-who with an wrong username with
wrong value without non-ASCII, such as:
VIRTWHO_=1
VIRTWHO_ESX_OWNER=7985933
VIRTWHO_ESX_ENV=7985933
VIRTWHO_ESX_USERNAME=XXXXXX
VIRTWHO_ESX_SERVER=10.73.2.95
VIRTWHO_ESX_PASSWORD=Welcome1!
10. restart virt-who service and check rhsm.log
# systemctl restart virt-who
start virt-who normally, but failed to get mapping with
reminder info -
"'VIRTWHO_RHEVM_USERNAME' is not set."
***Bug 1516261, virt-who can not start
***Bug 1426040 for libvirt, should support use username
and password.
***Bug 1530841 for xen/esx/hyperv/rhevm, wrong
reminder info
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with reminder info, such as:
"'VIRTWHO_RHEVM_USERNAME' is not set."
***Bug 1426040 for libvirt, should support use username
and password.
***Bug 1530841 for xen/esx/hyperv/rhevm, wrong
reminder info
start virt-who normally, but failed to get mapping with
uniform reminder info -
"Cannot complete login due to an incorrect user name or
password"
***Bug 1506156 [comment2] existing, log is not uniform
for different hypervisors, such as:
-for esx:  'Cannot complete login due to an
incorrect user name or password.'
- for rhevm: 'Unable to connect to RHEV-M
server: 401 Client Error: Unauthorized'
-
for xen:['SESSION_AUTHENTICATION_FAILED',
'xxxxxx', 'Authentication failure']
-for hyperv: 'Incorrect
domain/username/password'
-for libvirt: Cannot recv data: Permission denied
(publickey,gssapi-keyex,gssapi-with-mic,
password).: Connection reset by peer
11. create another valid configuration by /etc/virt-who.d/xxx.conf, then
restart virt-who service
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with uniform reminder info,
such as:
"Cannot complete login due to an incorrect user name or
password"
***Bug 1506156 [comment2] existing, log is not uniform
for different hypervisors like above step10
start virt-who normally, but failed to get mapping with
uniform reminder info -
"Cannot complete login due to an incorrect username or
password.''
***Bug 1518112 existing, virt-who fail to start
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with uniform reminder info,
such as:
"Cannot complete login due to an incorrect user name or
password.''
***Bug 1518112 existing, virt-who fail to start
failed to start virt-who with reminder info -
"No valid configurations found"
- virt-who should not be running and process
doesn't exist.
***Bug 1426040 for libvirt, should support use
username and password.
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with uniform reminder info,
such as:
"[env/cmdline]: Required option: "password" not set"
12. only config /etc/sysconfig/virt-who with an wrong username with
wrong value with non-ASCII, such as:
VIRTWHO_=1
VIRTWHO_ESX_OWNER=7985933
VIRTWHO_ESX_ENV=7985933
VIRTWHO_ESX_USERNAME=??©¥®ðπ?
VIRTWHO_ESX_SERVER=10.73.2.95
VIRTWHO_ESX_PASSWORD=Welcome1!
13. restart virt-who service and check rhsm.log
# systemctl restart virt-who
14. create another valid configuration, then restart virt-who service
15. only config /etc/sysconfig/virt-who without password,
such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=7985933
VIRTWHO_ESX_ENV=7985933
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_SERVER=10.73.2.95
#VIRTWHO_ESX_PASSWORD=Welcome1!
16. restart virt-who service and check rhsm.log
# systemctl restart virt-who
# systemctl restart virt-who
# ps -ef |grep virt-who
17. create another valid configuration by /etc/virt-who.d/xxx.conf, then
restart virt-who service
18. only config /etc/sysconfig/virt-who with password is null,
such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=7985933
VIRTWHO_ESX_ENV=7985933
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_SERVER=10.73.2.95
VIRTWHO_ESX_PASSWORD=
19. restart virt-who service and check rhsm.log
# systemctl restart virt-who
20. create another valid configuration by /etc/virt-who.d/xxx.conf, then
restart virt-who service
21. only config /etc/sysconfig/virt-who with an wrong
password without non-ASCII, such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=7985933
VIRTWHO_ESX_ENV=7985933
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_SERVER=10.73.2.95
VIRTWHO_ESX_PASSWORD=XXXXX
22. restart virt-who service and check rhsm.log
# systemctl restart virt-who
start virt-who normally, but failed to get mapping with
uniform reminder info -
"Cannot complete login due to an incorrect user name or
password."
***Bug 1506156 existing, log is not uniform for different
hypervisors, such as:
-for esx: 'Cannot complete login due to an incorrect user
name or password.'
- for rhevm: 'Unable to connect to RHEV-M server: 401
Client Error: Unauthorized'
-for xen: ['SESSION_AUTHENTICATION_FAILED', 'root',
'Authentication failure'
-for hyperv: "Incorrect domain/username/password"
-for libvirt: no error, can send mapping successfully.
***Bug 1426040 for libvirt, should support use username
and password.
***Bug 1516645 [Comment 4], can not start virt-who
service.
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with uniform reminder info
like step19.
start virt-who normally, but failed to send mapping with
uniform reminder info -
"Cannot complete login due to an incorrect user name or
password."
***Bug 1506156 existing, log is not uniform for different
hypervisors, such as:
-for esx: 'Cannot complete login due to an incorrect user
name or password.'
- for rhevm: 'Unable to connect to RHEV-M server: 401
Client Error: Unauthorized'
23. create another valid configuration by /etc/virt-who.d/xxx.conf, then
restart virt-who service
24. only config /etc/sysconfig/virt-who with an wrong
password with non-ASCII, such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=7985933
VIRTWHO_ESX_ENV=7985933
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_SERVER=10.73.2.95
VIRTWHO_ESX_PASSWORD=??©¥®ðπ?
25. restart virt-who service and check rhsm.log
# systemctl restart virt-who
26. create another valid configuration, then restart virt-who service
-for xen: ['SESSION_AUTHENTICATION_FAILED', 'root',
'Authentication failure']
-for hyperv: 'Incorrect domain/username/password'
-for libvirt: no error, can send mapping successfully.
***Bug 1426040 for libvirt, should support use username
and password.
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with reminder info like
step22.
start virt-who normally, but failed to get mapping with
reminder info -
"'Cannot complete login due to an incorrect user name or
password."
***BZ 1357761 Bug 1503271 , problem with virt-who using
Unicode characters in a hypervisor's account password.
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with reminder info like
above step25.
RHEL7-79908 - 1029-Check virt-who --username and --password option by /etc/virt-who.d
config file
Step
Expected Result
Refer to BZ 1337407  BZ 1357761  BZ 1406694Bug
1512778 
***Not for Local_Libvirt, VDSM
NOTE: Need to track Bug
1506156 - When
username/password options
are disabled or the values are
not right or even no values, virt-
who should provide some
uniform message
1. config /etc/sysconfig/virt-who
with all available options, such
as:
[test-hyperv1]
type=hyperv
server=10.73.5.203
username=administrator
password=Welcome1
owner=ACME_Corporation
env=Library
2. restart virt-who service and
check rhsm.log
# systemctl restart virt-who
3. only create a config file
without username option in
/etc/virt-who.d/, such as:
[test-hyperv1]
type=hyperv
server=10.73.5.203
#username=administrator
password=Welcome1
owner=ACME_Corporation
env=Library 
4. restart virt-who service and
check rhsm.log
# systemctl restart virt-who
# systemctl status virt-who
# ps -ef |grep virt-who
5. create another valid
configuration, then restart virt-
who service
6. only create a config file with
username value is null in
/etc/virt-who.d/, such as:
[test-hyperv1]
type=hyperv
server=10.73.5.203
username=
password=Welcome1
owner=ACME_Corporation
env=Library
7. restart virt-who service and
check rhsm.log
# systemctl restart virt-who
start virt-who and send mapping normally.
failed to start virt-who with reminder info -
""username" is missing in: "stage-xen"" in rhsm
log, and "virt-who can't be started: no valid
configuration found" when run "# systemctl status
virt-who"
- virt-who should not be running and process
doesn't exist.
***Bug 1426040 for libvirt, should support use
username and password.
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with reminder info, such as:
"Required option: "username" is missing in:
"stage-xen"" in rhsm log.
start virt-who normally, but failed to get mapping with
reminder info -
"Cannot complete login due to an incorrect user name or
password."
***Bug 1506156 existing, log is not uniform for
different hypervisors, such as:
-for esx:  'Cannot complete login due to an
8. create another valid
configuration, then restart virt-
who service
9. only create a config file with
an wrong username value
without ASCii in /etc/virt-
who.d/, such as:
[test-hyperv1]
type=hyperv
server=10.73.5.203
username=XXXXXX
password=Welcome1
owner=ACME_Corporation
env=Library 
10. restart virt-who service and
check rhsm.log
# systemctl restart virt-who
incorrect user name or password.'
- for rhevm: 'Unable to connect to RHEV-M
server: 401 Client Error: Unauthorized'
-
for xen:['SESSION_AUTHENTICATION_FAILED',
' ', 'Authentication failure']
-for hyperv: 'Incorrect
domain/username/password'
-for libvirt: Cannot recv data: Permission denied
(publickey,gssapi-keyex,gssapi-with-mic,
password).: Connection reset by peer
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with reminder info like
above step7.
***Bug 1506156 existing, log is not uniform for different
hypervisors
start virt-who normally, but failed to get mapping with
reminder info -
"'Cannot complete login due to an incorrect user name or
password.'''
***Bug 1506156 existing, log is not uniform for different
hypervisors, such as:
-for esx:  'Cannot complete login due to an
incorrect user name or password.'
- for rhevm: 'Unable to connect to RHEV-M
server: 401 Client Error: Unauthorized'
-
for xen:['SESSION_AUTHENTICATION_FAILED',
'xxxxxx', 'Authentication failure']
-for hyperv: 'Incorrect
domain/username/password'
-for libvirt: Cannot recv data: Permission denied
(publickey,gssapi-keyex,gssapi-with-mic,
password).: Connection reset by peer
11. create another valid
configuration, then restart virt-
who service
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with reminder info like
above step10.
12. only create a config file with
an wrong username value with
ASCii in /etc/virt-who.d/, such
as:
[test-hyperv1]
type=hyperv
server=10.73.5.203
username=??©¥®ðπ?
password=Welcome1
owner=ACME_Corporation
env=Library
13. restart virt-who service and
check rhsm.log
# systemctl restart virt-who
14. create another valid
configuration, then restart virt-
who service
15. only config file with
password option disabled in
/etc/virt-who.d, such as:
[test-hyperv1]
type=hyperv
server=10.73.5.203
username=administrator
# password=
owner=ACME_Corporation
env=Library
16. restart virt-who service
and check rhsm.log
# systemctl restart virt-who
# systemctl status virt-who
# ps -ef |grep virt-who
start virt-who normally, but failed to get mapping with
reminder info -
"Cannot complete login due to an incorrect user name or
password.''
***Bug 1518112 existing, virt-who fail to start
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with uniform reminder info,
such as:
"Cannot complete login due to an incorrect user name or
password.''
***Bug 1518112 existing, virt-who fail to start
failed to start virt-who with reminder info -
"Required option: "password" not set." in rhsm log, and
"virt-who can't be started: no valid configuration found"
when run "# systemctl status virt-who"
- virt-who should not be running and process doesn't
exist.
***Bug 1426040 for libvirt, should support use username
and password.
17. create another valid
start virt-who normally, succeed to report the valid one,
configuration, then restart virt-
who service
but failed to send the bad one with uniform reminder info,
such as:
"Required option: "password" is missing in: "stage-
rhevm""
18. only config file with
password value is null in
/etc/virt-who.d, such as:
[test-hyperv1]
type=hyperv
server=10.73.5.203
username=administrator
password=
owner=ACME_Corporation
env=Library
19. restart virt-who service
and check rhsm.log
# systemctl restart virt-who
start virt-who normally, but failed to send mapping with
reminder info -
"'Cannot complete login due to an incorrect user name or
password."
***Bug 1506156 existing, log is not uniform for different
hypervisors, such as:
-for esx:  'Cannot complete login due to an
incorrect user name or password.'
- for rhevm: 'Unable to connect to RHEV-M
server: 401 Client Error: Unauthorized'
-
for xen:['SESSION_AUTHENTICATION_FAILED',
' ', 'Authentication failure']
-for hyperv: 'Incorrect
domain/username/password'
-for libvirt: still can report mappings with Bug
1426040
20. create another valid
configuration, then restart virt-
who service
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with uniform reminder info
like above step19.
21. only config file with
password value is wrong
without ASCii in /etc/virt-who.d,
such as:
[test-hyperv1]
type=hyperv
server=10.73.5.203
username=administrator
password=xxx
owner=ACME_Corporation
env=Library
22. restart virt-who service
and check rhsm.log
# systemctl restart virt-who
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with uniform reminder info,
such as:
"'Cannot complete login due to an incorrect user name or
password."
***Bug 1506156 existing, log is not uniform for different
hypervisors, such as:
-for esx:  'Cannot complete login due to an
incorrect user name or password.'
- for rhevm: 'Unable to connect to RHEV-M
server: 401 Client Error: Unauthorized'
-
for xen:['SESSION_AUTHENTICATION_FAILED',
' xxx', 'Authentication failure']
-for hyperv: 'Incorrect
domain/username/password'
-for libvirt: still can report mappings with Bug
1426040
23. create another valid
configuration, then restart virt-
who service
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with reminder info like
above step22.
24. only config file with
password value is wrong with
ASCii in /etc/virt-who.d, such
as:
[test-hyperv1]
type=hyperv
server=10.73.5.203
username=administrator
password=??©¥®ðπ?
owner=ACME_Corporation
env=Library
25. restart virt-who service
and check rhsm.log
# systemctl restart virt-who
start virt-who normally, but failed to get mapping with
reminder info -
"'Cannot complete login due to an incorrect user name or
password."
***BZ 1357761 Bug 1503271 , problem with virt-who using
Unicode characters in a hypervisor's account password.
26. create another valid
configuration, then restart virt-
who service
start virt-who normally, succeed to report the valid one,
but failed to send the bad one with reminder info like
above step25.
27. use a config file with
the correct username and
password value and these
value with single quotes or
double quotes in /etc/virt-
who.d/, such as:
[test-hyperv1]
type=hyperv
server=10.73.5.203
username="administrator"
password='Welcome1'
owner=ACME_Corporation
env=Library 
28. restart virt-who service
and check rhsm.log
# systemctl restart virt-who
start virt-who and send mapping normally.
RHEL7-87319 - 1030-Check virt-who config file extension by /etc/virt-who.d
Step
Expected Result
***Not for Local_Libvirt, VDSM
1. create a config file with .conf extension
in /etc/virt-who.d/, such as:
#vi /etc/virt-who.d/test-hyperv.conf
[test-hyperv]
type=hyperv
server=10.73.5.203
username=administrator
password=Welcome1
owner=ACME_Corporation
env=Library
2. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
3. modify the "test-hyperv.conf" filename
with different extension, such as: test-
hyperv.conf.bkp
#mv test-hyperv.conf test-hyperv.conf.bkp
4. restart virt-who and check rhsm.log
again
virt-who can be restarted and send
the "test-hyperv" host/guest mapping
info successfully. 
filename modify successfully.
virt-who can be restarted, but  cannot get
and send the "test-hyperv" host/guest
mapping info.
virt-who only run the .conf configure file
under /etc/virt-who.d, will ignore all other
extention.
RHEL7-79900 - 1031-Check virt-who can be killed normally in terminal side
Step
***For all hypervisor
Expected Result
Refer to BZ 1326588 BZ 1401760 BZ
1448343 
BZ 1445127
1. register your virt-who host to
Sam/Satellite/Stage and make sure virt-
who is installed
2. Run virt-who at CLI with "-i -d" options
as the following:
[root@dell-per720xd-01 virt-who.d]# virt-
who --esx --esx-
owner=ACME_Corporation --esx-
env=Library --esx-server=10.73.2.95 --esx-
username=Administrator@vsphere.local --
esx-password=Welcome1! -i 100 -d
3. Press "Ctrl+c" in terminal side to
end virt-who and check virt-who's
log.
virt-who run normally
virt-who can be killed normally
it shouldn't show any error info in the log
Bug BZ 1448343 existing for esx, "The
session is not authenticated" issue.
Bug BZ 1445127 existing for xen, No xen
mode thread terminated notice info
RHEL7-79901 - 1032-Check log info normally if run virt-who in CLI when it is running.
Step
***For all hypervisor
1. Restart virt-who service
# systemctl restart virt-who
2. Check virt-who's status
# systemctl status virt-who
3. Run virt-who with -o option and
check the log in terminal.
-> if local libvirt mode, please run
virt-who default
-> if remote libvirt mode, please run
with --libvirt
-> if vdsm mode, please run with --
vdsm option
-> if esx mode, please run with --esx
option
-> if rhevm mode, please run with --
rhevm option
-> if hyper-v mode, please run with -
-hyperv
Expected Result
Refer to BZ 1321250
Virt-who is running.
It shouldn't show info as the following:
"[virtwho.init INFO]
MainProcess(27574):MainThread
@virtwho.py:parseOptions:637 - Using
reporter_id='dell-
pesc440-01.rhts.eng.bos.redhat.com'""
It should only show info as the
following:
""virt-who seems to be already
running. If not, remove /var/run/virt-
who.pid"."
RHEL7-53824 - 1033-Check /etc/sysconfig/virt-who and /var/run/virt-who.pid permission
Step
***For all hypervisor
1. Check the virt-who config file
# ll /etc/sysconfig/virt-who
2. Start virt-who service
3. Check the permissions of the PID file
created
# ll /var/run/virt-who.pid
Expected Result
Refer to BZ 1308416
The permissions of the virt-who config file
default to 600
# ll /etc/sysconfig/virt-who
-rw-------. 1 root root 2164 Sep 16 17:04
/etc/sysconfig/virt-who
The permissions of the PID file is 600
# ll /var/run/virt-who.pid 
-rw-------. 1 root root 4 May 10 14:31
/var/run/virt-who.pid
RHEL7-53825 - 1034-Start virt-who service by ssh
Step
***For all hypervisor
1. start virt-who service by ssh, such as
the virt-who host is 10.66.144.10, restart it
by:
# ssh 10.66.144.10 "systemctl restart virt-
who"
2. check the service status
# ssh 10.66.144.10 "systemctl status virt-
who"
Expected Result
virt-who service can be restart normally
virt-who service status is running
RHEL7-79912 - 1035-Check virt-who uses entry_point for its /usr/bin/virt-who executable
Step
***For all hypervisor
1. Stop virt-who service 
2. Create a virtwho.py in any path
# cat > virtwho.py
print "test virt-who execute"
3. Run virt-who command
# virt-who
Expected Result
Refer to BZ 1347130
virt-who can send host/guest mapping to
server.
It also shouldn't show info as the following:
"test virt-who execute"
RHEL7-53826 - 1036-Config 2+ different hypervisors in /etc/sysconfig/virt-who
Step
***Not for Local_libvirt
1. config 2+ different hypervisors at the same time in
/etc/sysconfig/virt-who, such as:
# Options for RHEV-M mode
VIRTWHO_RHEVM=1
VIRTWHO_RHEVM_OWNER=7661967
VIRTWHO_RHEVM_ENV=7661967
VIRTWHO_RHEVM_SERVER=https://10.66.79.23:443
VIRTWHO_RHEVM_USERNAME=admin@internal
VIRTWHO_RHEVM_PASSWORD=redhat
# Options for HYPER-V mode
VIRTWHO_HYPERV=1
VIRTWHO_HYPERV_OWNER=7661967
VIRTWHO_HYPERV_ENV=7661967
VIRTWHO_HYPERV_SERVER=10.66.128.9
VIRTWHO_HYPERV_USERNAME=administrator
VIRTWHO_HYPERV_PASSWORD=Welcome1
2. restart virt-who service and check rhsm.log
Expected Result
virt-who mode, enable only
one option from following 5:
# Use libvirt to list virtual
guests [default]
#VIRTWHO_LIBVIRT=0
# Use vdsm to list virtual
guests
#VIRTWHO_VDSM=0
# Register ESX machines
using vCenter
#VIRTWHO_ESX=0
# Register guests using
RHEV-M
#VIRTWHO_RHEVM=0
# Register guest using Hyper-
V
#VIRTWHO_HYPERV=0
virt-who only support one
mode config in
/etc/sysconfig/virt-who, so the
rhsm.log should show only
one hypervisor's host/guest
json, not two.
RHEL7-53827 - 1037-Config http_proxy and https_proxy in /etc/sysconfig/virt-who
Step
***Not for Local_Libvirt, VDSM
1.Make sure virt-who host can't access to remote host/hypervisor
directly.
You can restrict the IP as following guide for windows:
http://jingyan.baidu.com/article/3f16e003d05c602590c10366.html
   [by firewall]
if enable firewall, need to set ICMP for ping, such as:
http://www.cnblogs.com/acmy/archive/2012/03/01/2375695.html 
2. Make sure virt-who host can access to squid server
(10.73.3.248) ,and the squid server can connect remote host /
hypervisors
Expected Result
Refer to BZ 1227259
Q: this case can be
running for hyper-v and
esxi, but how about the
linux proxy?
3. config virt-who with http_proxy, such as:
# vi /etc/sysconfig/virt-who
VIRTWHO_ESX=1
http_proxy=http://xxxx
https_proxy=https://xxxx
http_proxy=http://10.73.3.248:3128
VIRTWHO_ESX_OWNER=7661967
VIRTWHO_ESX_ENV=7661967
VIRTWHO_ESX_SERVER=10.73.3.231
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_PASSWORD=Welcome1!
[NOTE]:
ESX,RHEVM support https_proxy=https://xxxx
HYPERV support http_proxy=http://xxxx
[Optional]:
no_proxy=satserv.redhat.com
4. restart virt-who service and check the log message
The mapping info
should be found in
/var/log/rhsm/rhsm.log
normally.
RHEL7-53828 - 1038-Check guests attributes by curl
Step
***For all hypervisor
1. login to Sam/Satellite/Stage Candlepin web UI to check the hypervisor's uuid, such as:
827e7c16-cdb6-49b8-a4a2-24d8db2f2e58
2.
- for Stage Candlepin:
# curl -u virt-who-test:redhat --insecure --request  GET
https://subscription.rhn.stage.redhat.com:443/subscription/consumers/[HOST_UUID]/guestids/[GUEST_UUID]
| python -mjson.tool
HOST_UUID: come from stage candlepin webui
GUEST_UUID: come from rhsm_log
- for satellite server:
# curl -u admin:admin --insecure  -k  https://satserv.redhat.com/katello/api/v2/systems/[GUEST_UUID] |
python -mjson.tool
GUEST_UUID: come from satellite webui
-for sam server:
# curl -u admin:admin --insecure  -k 
https://samserv.redhat.com/sam/api/consumers/[HOST_UUID]/guestids/[GUEST_UUID] | python -mjson.tool
HOST_UUID: come from sam webui
GUEST_UUID: come from virt.uuid
Expected Result
Refer to BZ 1231065 BZ 1321229 BZ
1240728
if stage candlepin, the result should be:
{
    "attributes": {
        "active": "0",
        "hypervisorType": "qemu",
        "virtWhoType": "rhevm"
    },
    "created":
"2015-11-06T08:50:59.000+0000",
    "guestId": "a92a5f0d-
dd88-4b85-9edd-8d19cb4fbc44",
    "id":
"8a99f98250dbf6df0150dbfddd9f0004",
    "updated":
"2015-11-06T08:50:59.000+0000"
}
if candlepin version bigger than 2.0 or in
satellite5.x. the result should be:
  {
        "guestId":
"04c1acbb-239c-4ae6-886d-31dcd8a60c06",
 
        "state": 1, 
        "attributes": {
            "active": 1, 
            "hypervisorVersion": "0.12.1",
            "virtWhoType": "libvirt", 
            "hypervisorType": "QEMU"
        }
    }
RHEL7-53829 - 1039-Check mapping info after restart virt-who and rhsmcertd.service
Step
***For all hypervisor
1. register host to sate/sam/satellite
Expected Result
2. config virt-who, restart virt-who and
check host/guest mapping
after restart virt-who, can get the
host/guest mapping info normally
3. restart rhsmcertd.service, check virt-
who status and rhsm.log
#  systemctl restart rhsmcertd
restart rhsmcertd service successfully
without error
4. check virt-who status
# systemctl status virt-who
after restart rhsmcertd.service, virt-who
should be running
5. restart virt-who and check rhsm.log
host/guest mapping info can be updated to
server normally
RHEL7-53830 - 1040-Create a config file with one hypervisor in /etc/virt-who.d/
Step
Expected Result
***Not for Local_Libvirt
Refer to bug: BZ 1436617
1. disable hypervisor options in
/etc/sysconfig/virt-who
2. create a new config file including one
hypervisor in /etc/virt-who.d, such as:
# vi /etc/virt-who.d/libvirt.conf
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=7661967
env=7661967
3. restart virt-who service and check
rhsm.log
virt-who should fetch and send the
host/guests mapping info to server
normally
RHEL7-53831 - 1041-Create a config file with two different hypervisors in /etc/virt-who.d/
Step
Expected Result
***Not for Local_Libvirt
Refer to BZ 1295644 BZ 1444718
1. disable hypervisor options in
/etc/sysconfig/virt-who
2. create a new config file including two
or more hypervisors in /etc/virt-who.d,
such as:
# vi /etc/virt-who.d/mult.conf
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=7661967
env=7661967
[test-esx]
type=esx
server=10.66.79.5
username=Administrator@vsphere.local
password=qwer1234P!
owner=7661967
env=7661967
3. restart virt-who service and check
rhsm.log 
- the two hypervisors' host/guests json info should
be showed together, such as:
2017-07-19 23:20:27,453
[virtwho.destination_-3103206552139750212
INFO] MainProcess(5388):Thread-4
@subscriptionmanager.py:hypervisorCheckIn:202
- Sending update in hosts-to-guests mapping for
config "destination_-3103206552139750212": 5
hypervisors and 3 guests found
2017-07-19 23:20:27,453
[virtwho.destination_-3103206552139750212
DEBUG] MainProcess(5388):Thread-4
@subscriptionmanager.py:hypervisorCheckIn:203
- Host-to-guest mapping: {
    "a4db4d56-5db1-593f-3700-7c3942fd0c26": [],
    "9fea4d56-5ed5-ddfe-b806-e7872726c0d7": [
        {
            "guestId": "421cc74d-
a0d8-3608-09d2-73c6d77e7d0e",
            "state": 5,
            "attributes": {
                "active": 0,
                "virtWhoType": "esx"
            }
        },
        {
            "guestId": "421c583c-5d6a-79e4-
d50b-22db99686f6b",
            "state": 1,
            "attributes": {
                "active": 1,
                "virtWhoType": "esx"
            }
        }
    ],
    "42766af0-9742-4d38-8ecc-1ef434fb58f0": [],
    "0eb6c08a-596a-473a-9fbd-e5aca3f8538a": [
        {
            "guestId": "bb59d0d9-0f3c-4809-8401-
dd041cc22746",
            "state": 1,
            "attributes": {
                "active": 1,
                "virtWhoType": "rhevm"
            }
        }
    ],
    "896ff3be-eca0-4e39-a519-d09e425bf4e4": []
- virt-who should distinguish to show "Duplicate
report for config "xxx" found, ignoring" in rhsm log
for each hypervisor, such as:
2017-05-24 04:32:09,899
[virtwho.destination_2598285595642390377
DEBUG] MainProcess(2880):Thread-6
@virt.py:_get_data_common:522 - Duplicate
report found for config "test-esx", ignoring
2017-05-24 04:32:09,899
[virtwho.destination_2598285595642390377
DEBUG] MainProcess(2880):Thread-6
@virt.py:_get_data_common:522 - Duplicate
report found for config "test-libvirt", ignoring
2017-05-24 04:32:09,899
[virtwho.destination_2598285595642390377
DEBUG] MainProcess(2880):Thread-6
@virt.py:_send_data:560 - No data to send,
waiting for next interval
RHEL7-53832 - 1042-Create two config files for two different hypervisors in /etc/virt-who.d
Step
Expected Result
***Not for Local_Libvirt
Refer to: BZ 1444718
1. disable hypervisor options in
/etc/sysconfig/virt-who
2. create two new config files including
different hypervisors in /etc/virt-who.d,
such as:
# vi /etc/virt-who.d/libvirt.conf
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=7661967
env=7661967
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.5
username=Administrator@vsphere.local
password=qwer1234P!
owner=7661967
env=7661967
3. restart virt-who service and check
rhsm.log
- the two hypervisors' host/guests json info should
be showed together, such as:
2017-07-19 23:20:27,453
[virtwho.destination_-3103206552139750212
INFO] MainProcess(5388):Thread-4
@subscriptionmanager.py:hypervisorCheckIn:202
- Sending update in hosts-to-guests mapping for
config "destination_-3103206552139750212": 5
hypervisors and 3 guests found
2017-07-19 23:20:27,453
[virtwho.destination_-3103206552139750212
DEBUG] MainProcess(5388):Thread-4
@subscriptionmanager.py:hypervisorCheckIn:203
- Host-to-guest mapping: {
    "a4db4d56-5db1-593f-3700-7c3942fd0c26": [],
    "9fea4d56-5ed5-ddfe-b806-e7872726c0d7": [
        {
            "guestId": "421cc74d-
a0d8-3608-09d2-73c6d77e7d0e",
            "state": 5,
            "attributes": {
                "active": 0,
                "virtWhoType": "esx"
            }
        },
        {
            "guestId": "421c583c-5d6a-79e4-
d50b-22db99686f6b",
            "state": 1,
            "attributes": {
                "active": 1,
                "virtWhoType": "esx"
            }
        }
    ],
    "42766af0-9742-4d38-8ecc-1ef434fb58f0": [],
    "0eb6c08a-596a-473a-9fbd-e5aca3f8538a": [
        {
            "guestId": "bb59d0d9-0f3c-4809-8401-
dd041cc22746",
            "state": 1,
            "attributes": {
                "active": 1,
                "virtWhoType": "rhevm"
            }
        }
    ],
    "896ff3be-eca0-4e39-a519-d09e425bf4e4": []
- virt-who should distinguish to show "Duplicate
report for config "xxx" found, ignoring" in rhsm log
for each hypervisor, such as:
2017-05-24 04:32:09,899
[virtwho.destination_2598285595642390377
DEBUG] MainProcess(2880):Thread-6
@virt.py:_get_data_common:522 - Duplicate
report found for config "test-esx", ignoring
2017-05-24 04:32:09,899
[virtwho.destination_2598285595642390377
DEBUG] MainProcess(2880):Thread-6
@virt.py:_get_data_common:522 - Duplicate
report found for config "test-libvirt", ignoring
2017-05-24 04:32:09,899
[virtwho.destination_2598285595642390377
DEBUG] MainProcess(2880):Thread-6
@virt.py:_send_data:560 - No data to send,
waiting for next interval
RHEL7-53833 - 1043-Create a config file in /etc/virt-who.d/, config the different mode in
/etc/sysconfig/virt-who
Step
***Not for Local_Libvirt
Expected Result
1. create a new config file including one hypervisor in
/etc/virt-who.d, such as:
# vi /etc/virt-who.d/libvirt.conf
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=7661967
env=7661967
2. config /etc/sysconfig/virt-who for another hypervisor, such
as:
# vi /etc/sysconfig/virt-who
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=7661967
VIRTWHO_ESX_ENV=7661967
VIRTWHO_ESX_SERVER=10.73.2.15
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_PASSWORD=Welcome1!
3. restart virt-who service and check rhsm.log
the two hypervisors'
host/guests json info
should be found together
at the same same for
rhsm.log;
RHEL7-53834 - 1044-re-register virt-who host when configured for two different modes
Step
***Not for Local_Libvirt
1. register virt-who host to Sam/Satellite/Stage
2. create a new config file including one hypervisor in
/etc/virt-who.d, such as:
# vi /etc/virt-who.d/libvirt.conf
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=7661967
env=7661967
3. config /etc/sysconfig/virt-who for another hypervisor, such
as:
# vi /etc/sysconfig/virt-who
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=7661967
VIRTWHO_ESX_ENV=7661967
VIRTWHO_ESX_SERVER=10.73.2.15
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_PASSWORD=Welcome1!
4. restart virt-who service and check rhsm.log
5. unregister virt-who host from Sam/Satellite/Stage
    then restart virt-who service
6. register the virt-who host again
Expected Result
the two hypervisors' host/guests json
info should be found together at the
same same for rhsm.log; 
it will show error to rhsm log:
SubscriptionManagerUnregisteredError:
Unable to read certificate, system is not
registered or you are not root
check the rhsm.log, virt-who should
fetch and send all the  hypervisors
hosts/guests info to server normally.
RHEL7-53835 - 1045-Create a config file in /etc/virt-who.d/, config the same mode in
/etc/sysconfig/virt-who
Step
***Not for Local_Libvirt
Expected Result
1. create a new config files with one hypervisor in /etc/virt-
who.d, such as esx mode (vcenter1):
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.73.2.15
username=Administrator@vsphere.local
password=Welcome1!
owner=7661967
env=7661967
2. config the same mode as above in /etc/sysconfig/virt-who,
such as another esx mode (vcenter2):
# vi /etc/sysconfig/virt-who
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=7661967
VIRTWHO_ESX_ENV=7661967
VIRTWHO_ESX_SERVER=10.73.2.15
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_PASSWORD=Welcome1!
3. restart virt-who service and check rhsm.log
the two hypervisors'
host/guests json info
should be found together
at the same time for
rhsm.log; 
4. make vcenter2 is not reachable, and restart virt-who again only fetch and send
vcenter1 host/guests
mapping info to server
RHEL7-53836 - 1046-Create the config file in /etc/virt-who.d/, config and run virt-who from
CLI
Step
Expected Result
***Not for Local_Libvirt
1. disable hypervisor options in
/etc/sysconfig/virt-who
2. create a new config file including one
hypervisor in /etc/virt-who.d, such as:
# vi /etc/virt-who.d/libvirt.conf
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=7661967
env=7661967
3. disable virt-who service
4. run virt-who CLI with another
hypervisor, such as:
# virt-who --esx --esx-owner=7661967 --
esx-env=7661967 --esx-server=10.66.79.5
--esx-
username=Administrator@vsphere.local --
esx-password=qwer1234P! -o -d
the two hypervisors' host/guests json info
should be found together at the same
same for rhsm.log;
RHEL7-79905 - 1047-Check virt-who can handle quoted config values
Step
Expected Result
***Not for Local_Libvirt, VDSM
Refer to BZ 1336507
1. Disable hypervisor options in
/etc/sysconfig/virt-who
2. Create a new config file including one
hypervisor in /etc/virt-who.d and make
sure all value with single quotes '', such
as:
# vi /etc/virt-who.d/libvirt.conf
['test-libvirt']
type='libvirt'
server='10.66.129.60'
username='root'
password='redhat'
owner='7661967'
env='7661967'
3. Restart virt-who service and check virt-
who's log
4. Modify the config file to all values with
double quotes "", such as:
# vi /etc/virt-who.d/libvirt.conf
["test-libvirt"]
type="libvirt"
server="10.66.129.60"
username="root"
password="redhat"
owner="7661967"
env="7661967"
5. Restart virt-who service and
check virt-who's log
virt-who can send host/guest mapping info
to server successfully, it shouldn't
generate any error info.
virt-who can send host/guest
mapping info to server successfully,
it shouldn't generate any error info.
RHEL7-79897 - 1048-Check virt-who won't check swap config file in /etc/virt-who.d/
Step
Expected Result
***Not for Local_Libvirt, VDSM
Refer to BZ 1323029
1. disable hypervisor options in
/etc/sysconfig/virt-who
2. use vim edit a config file:
# vim /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.73.2.95
username=Administrator@vsphere.local
#password=Welcome1!
owner=ACME_Corporation
env=Library
3. don't save and don't quit vim, make sure
esx.conf.swp exist
# ls -a /etc/virt-who.d/
.  ..  libvirt.conf  .libvirt.conf.swp 
4. restart virt-who and check virt-who's log
virt-who restart successfully, it shouldn't
generate any error info in the log.
RHEL7-87424 - 1049-Check virt-who-password command for the encrypted password
function
Step
Expected Result
***Not for Local_Libvirt, VDSM
1. run virt-who-password without any
option for ad"min encrypted
# virt-who-password
Password:ad"min
2. run virt-who-password with -p
option for ad"min encrypted
without double quotes
# virt-who-password -p ad\"min
Use following as value for
encrypted_password key in the
configuration file:
fc8f8c77d1eac210cf044e3402cd038a
output should be:
fc8f8c77d1eac210cf044e3402cd038a
3. run virt-who-password with -p option
for ad"min encrypted with double quotes
# virt-who-password -p "ad\"min"
output should be:
fc8f8c77d1eac210cf044e3402cd038a
4. run virt-who-password without any
option for "ad"min" encrypted
# virt-who-password
Password:"ad"min"
5. run virt-who-password with -p
option for "ad"min" encrtyped
output should be:
d01bdc94bf59d8f7236a38da48cfd385
output should be same with using -p.
# virt-who-password -p \"ad\"min\"
6. repeat above step2-4 with --
password
# virt-who-password --
password=ad\"min
# virt-who-password --
password="ad\"min"
# virt-who-password --
password=\"ad\"min\"
RHEL7-53837 - 1050-Check encrypted_password option in /etc/virt-who.d config file
Step
Expected Result
***Not for Local_Libvirt, VDSM
NOTE: Before the case beginning, remove the key file under /var/lib/virt-
who if it exists.
# rm /var/lib/virt-who/key
Refer to BZ 1318887 BZ
1336507 
BZ 1461685 BZ
1447264 BZ 1472727
1. configure one hypervisor conf file in /etc/virt-who.d/, and use
encrypted_password option without value to instead of
password option , such as:
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
#password=qwer1234P
encrypted_password=
owner=ACME_Corporation
env=Library
2. start virt-who service and check rhsm.log
3. configure two hypervisor conf files in /etc/virt-who.d/, and use
encrypted_password option without value to instead of only
one hypervisor's password option, such as:
[test-hyperv]
type=hyperv
server=10.66.128.9
virt-who should be started
normally, but fail to get
and send mapping with
error info as the following:
"MainThread
@main.py:main:131 -
[Errno 2] No such file or
directory: '/var/lib/virt-
who/key'"
***BZ 1472727  existing,
fail to start virt-who
username=Administrator
#password=qwer1234P
encrypted_password=
owner=ACME_Corporation
env=Library
[test-esx]
type=esx
owner=ACME_Corporation
env=Library
server=10.73.3.234
username=Administrator@vsphere.local
password=Welcome1!
4. start virt-who service and check rhsm.log
5. use virt-who-password command to encrypt  the hypervisor's
password, such as:
# virt-who-password
Password:
44dbba931cba7c9a6569cd2871ba7e57
6. run step1&2 again.
- it should only fail to run
the [test-hyperv] mode
with error:
"MainThread
@main.py:main:131 -
[Errno 2] No such file or
directory: '/var/lib/virt-
who/key'"
- it should get and send
[test-esx] mapping
normally.
***BZ 1472727  existing,
fail to start virt-who
it should make a key file
in /vat/lib/virt-who
[need to track BZ
1461685]
virt-who should start
normally, but fail to
get [test-hyperv]
mapping with error:
"Option
"encrypted_password"
in config named "test-
hyperv" can't be
decrypted, possibly
corrupted'"
NOTE: virt-who
should not use libvirt
as backend.
7. run step3&4 again.
8. use encrypted_password option with above value (in step5) to instead
of password option in /etc/virt-who.d/ config file, such as:
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
#password=qwer1234P
encrypted_password=44dbba931cba7c9a6569cd2871ba7e57
owner=ACME_Corporation
env=Library
9. start virt-who service and check rhsm.log
10. use an wrong encrypted_password value to check again, such as:
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
#password=qwer1234P
encrypted_password=xxxxxxxxxxxxxxxxxxx
owner=ACME_Corporation
env=Library
11. restart virt-who service and check rhsm.log
***Bug 1519643
existing, failed to start
virt-who
virt-who should start
normally, get and send
[test-esx] mapping
successfully, but still fail
to run [test-hyperv] with
error:
"Option
"encrypted_password" in
config named "test-
hyperv" can't be
decrypted, possibly
corrupted'"
virt-who should fetch and
send the hosts/guests info
to server normally.
[need to track BZ
1461685]
virt-who should start
normally, but fail to
get [test-hyperv]
mapping with error:
"Option
"encrypted_password"
in config named "test-
hyperv" can't be
decrypted, possibly
12. Config encrypted_password to correct value with single
quotes('') or double quotes(""), such as:
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
encrypted_password='44dbba931cba7c9a6569cd2871ba7e57'
 /["44dbba931cba7c9a6569cd2871ba7e57"]
owner=ACME_Corporation
env=Library
13. Restart virt-who service and check virt-who's log
corrupted'"
NOTE: virt-who
should not use libvirt
as backend.
***Bug 1519643,
failed to start virt-who
virt-who can send
mapping to server
successfully.
RHEL7-53838 - 1051-Check rhsm_username and rhsm_password option in /etc/virt-who.d
config file
Step
***Not for Local_Libvirt, VDSM
***Not for SAM with Bug 1403122
Expected Result
Refer to BZ1229235  BZ
1336507  BZ 1406642 
1. create a config file with rhsm_username and
rhsm_password option in /etc/virt-who.d/ config file, the
rhsm_username and rhsm_password is the account for
SAM/Satellite/Stage Candlepin,
such as:
# /etc/virt-who.d/hyperv.conf
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=ACME_Corporation/Default_Organization
env=Library
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=admin
[NOTE]:
In satellite:
owner=Default_Organization
In SAM: 
owner=ACME_Corporation
2. keep virt-who host has been registered
# subscription-manager register
virt-who host register
successfully
3. restart virt-who service and check rhsm.log
4. configure with rhsm_username and rhsm_password
disabled or value is null, such as:
# /etc/virt-who.d/hyperv.conf
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=ACME_Corporation/Default_Organization
env=Library
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
#rhsm_username=admin
#rhsm_password=admin
5. use a wrong rhsm_username to check again, such as:
# /etc/virt-who.d/hyperv.conf
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=ACME_Corporation/Default_Organization
env=Library
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
rhsm_username=xxx
rhsm_password=admin
virt-who should fetch and
send the hosts/guests info to
server normally.
after restart virt-who, can
report mapping normally.
NOTE: when virt-who host
has been registered, when
run virt-who, it will first to
use the rhsm options in
/etc/virt-who.d/xxx.conf, if
the rhsm options are
missing, it will use the
default same with virt-who
host.
so when
rhsm_username/password
missing, virt-who will use the
username/password same
with when register virt-who
host.
after resart virt-who, can't
report info to server with
reminder info, such as:
- For Satellite62:
"Communication with
subscription manager failed
with code 500" [Bug
1406642 WONTFIX]
- For Stage Candlepin:
"Communication with
subscription manager failed
with code 401: The user has
been disabled, if this is a
mistake, please contact
customer service"
6. use a wrong rhsm_password to check again, such as:
# /etc/virt-who.d/hyperv.conf
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
after resart virt-who, can't
report info to server with
reminder info -
"Invalid username or
password" or
"Communication with
subscription manager failed
with code 500" [Bug
1406642 WONTFIX]
after restart virt-who, can
succeed to report the
mapping to server.
after restart virt-who, failed
to report mapping with error
info:
"Unable to read certificate,
system is not registered or
you are not root"
after restart virt-who, failed
to report mapping with error
info:
"Unable to read certificate,
system is not registered or
you are not root"
owner=ACME_Corporation/Default_Organization
env=Library
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=xxx
7. unregister virt-who host
# subscription-manager unregister
8. use all the valid configuration, such as
# /etc/virt-who.d/hyperv.conf
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=ACME_Corporation/Default_Organization
env=Library
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=admin
9. configure with rhsm_username disabled or value is
null to check again, such as:
# /etc/virt-who.d/hyperv.conf
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=ACME_Corporation/Default_Organization
env=Library
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
#rhsm_username=admin
rhsm_password=admin
10. configure with rhsm_password disabled or value is
null to check again, such as:
# /etc/virt-who.d/hyperv.conf
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=ACME_Corporation/Default_Organization
env=Library
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
after resart virt-who, can't
report info to server with
reminder info, such as:
- for Satellite62:
"Communication with
subscription manager failed
with code 500" [Bug
1406642 WONTFIX]
- for Stage Candlepin, now
the reminder info is -
"Communication with
subscription manager failed
with code 401: The user has
been disabled, if this is a
mistake, please contact
customer service"
- for satellite5 server:
"Unable to send host/guest
association to the satellite:
Unable to login to satellite5
server"
after resart virt-who, can't
report info to server with
reminder info:
" Invalid username or
password"
or
"Communication with
subscription manager failed
with code 500" [Bug
1406642 WONTFIX]
for satellite5 server:
"Unable to send host/guest
association to the satellite:
Unable to login to satellite5
server"
rhsm_username=admin
#rhsm_password=admin
11. use a wrong rhsm_username to check again, such
as:
# /etc/virt-who.d/hyperv.conf
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=ACME_Corporation/Default_Organization
env=Library
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
rhsm_username=xxx
rhsm_password=admin
12. use a wrong rhsm_password to check again, such
as:
# /etc/virt-who.d/hyperv.conf
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=ACME_Corporation/Default_Organization
env=Library
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=xxx
13. update rhsm_username and rhsm_password
to correct value with single qutoes('') or double
quotes(""), such as:
# /etc/virt-who.d/hyperv.conf
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=ACME_Corporation/Default_Organization
env=Library
rhsm_username='admin' /"admin"
rhsm_password='redhat'/"redhat"
14. restart virt-who service and check rhsm.log
again
virt-who can send host/guest
mapping to server
successfully.
RHEL7-53839 - 1052-Check rhsm_username and rhsm_encrypted_password option in
/etc/virt-who.d config file
Step
***Not for Local_Libvirt, VDSM
***Not for SAM with Bug 1403122 
1. unregister virt-who host
# subscription-manager unregister
2. use virt-who-password command to encrypt the rhsm_password for 
SAM/Satellite/Stage candlepin such as:
# virt-who-password
Password:
41ad63c59881a3e58037014ca2d3edcb
3. configure one hypervisor conf file in /etc/virt-who.d/, and use
encrypted_rhsm_password option without value to instead of
password option , such as:
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.234
username=Administrator@vsphere.local
password=Welcome1!
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
rhsm_username=admin
#rhsm_password=admin
rhsm_encrypted_password=
4. start virt-who service and check rhsm.log
Expected Result
Refer to BZ1229235 BZ
1336507  BZ 1447264 BZ
1472727 BZ 1461685
- virt-who should start
normally, but fail to send
[sat-esx] mapping with error:
"Option
"encrypted_password" in
config named "test-
hyperv" can't be decrypted,
possibly corrupted'" and
"Unable to read certificate,
system is not registered or
you are not root"
- should not run local libvirt.
virt-who should start normally,
report the valid one successfully,
but fail to run the bad one with
error:
"Option "encrypted_password" in
config named "sat-esx" can't be
decrypted, possibly
corrupted'" and "Unable to read
certificate, system is not
registered or you are not root"
5. configure two hypervisor conf files in /etc/virt-who.d/, one is valid, the other
uses rhsm_encrypted_password option without value to instead of
hypervisor's password option, such as:
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.234
username=Administrator@vsphere.local
password=Welcome1!
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
rhsm_username=admin
#rhsm_password=admin
rhsm_encrypted_password=
[sat-rhevm]
type=rhevm
owner=Default_Organization
env=Library
server=https://bootp-73-3-249.eng.pek2.redhat.com:443/ovirt-engine/
username=admin@internal
password=admin
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=admin
6. start virt-who service and check rhsm.log
7. create a config file with rhsm_username and using rhsm_encrypted_password
option to instead rhsm_password with the value created in step1, such as:
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.234
username=Administrator@vsphere.local
password=Welcome1!
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
rhsm_username=admin
#rhsm_password=admin
rhsm_encrypted_password=41ad63c59881a3e58037014ca2d3edcb
8. restart virt-who service and check rhsm.log
9. use a wrong rhsm account to check again, such as:
# /etc/virt-who.d/hyperv.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.234
username=Administrator@vsphere.local
password=Welcome1!
rhsm_hostname = bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
rhsm_username=admin
#rhsm_password=admin
rhsm_encrypted_password=xxxx
10. restart virt-who service and check rhsm.log
11. update rhsm_username and rhsm_encrypted_password to correct
value with single qutoes('') or double quotes(""), such as:
# /etc/virt-who.d/hyperv.conf
[sat-esx]
virt-who should fetch and send
the hosts/guests info to server
normally.
virt-who should start
normally, but fail to send
mapping with error:
"Option
"rhsm_encrypted_password"
cannot be decrypted,
possibly corrupted" and
"Communication with
subscription manager failed
with code 500:"
type=esx
owner=Default_Organization
env=Library
server=10.73.3.234
username=Administrator@vsphere.local
password=Welcome1!
rhsm_username='admin'/"admin"
#rhsm_password=admin
rhsm_encrypted_password='41ad63c59881a3e58037014ca2d3edcb'/
"41ad63c59881a3e58037014ca2d3edcb"
12. restart virt-who service and check rhsm.log
virt-who should fetch and
send the hosts/guests info to
server normally.
RHEL7-87439 - 1053-Check rhsm_hostname, rhsm_port and rhsm_prefix options in
/etc/virt-who.d
Step
Expected Result
***Not for Local_Libvirt, VDSM
NOTE:
The "rhsm_hostname/port/prefix"
options in /etc/virt-who.d/ will override
the rhsm.conf setup.
1. unregister virt-who host
# subscription-manager unregister
And keep rhsm_hostname/port/prefix
options with the default value in
/etc/rhsm/rhsm.conf, such as:
hostname = subscription.rhsm.redhat.com
port = 443
prefix = /subscription
2. configure the "hostname", "port", and
"prefix"  value to the default, such as:
# vi /etc/rhsm/rhsm.conf
hostname = subscription.rhsm.redhat.com
port = 443
prefix = /subscription
3. configure a valid configuration with rhsm
parameters configured in /etc/virt-who.d/,
such as:
#vi /etc/virt-who.d/libvirt.conf
[sate-libvirt]
type=libvirt
server=10.66.144.8
username=root
password=redhat
Refer to BZ 1412425 BZ 1404878 BZ 1450747 BZ 1450738
-for satlliste:
rhsm_username=admin
rhsm_password=admin
rhsm_hostname=bootp-73-3-164.eng.pek2.redhat.com
rhsm_port=443
rhsm_prefix=/rhsm
-for stage candlepin:
owner=Default_Organization
env=Library
rhsm_username=admin
rhsm_password=admin
rhsm_hostname =
bootp-73-3-218.eng.pek2.redhat.com
rhsm_port = 443
rhsm_prefix=/rhsm
4.restart virt-who service, then check rhsm
log and webUI
#service virt-who restart
5. disable rhsm_hostname option and keep
other options avalible, such as:
# rhsm_hostname=
then restart virt-who service
#service virt-who restart
6. configure rhsm_hostname value to null
and keep other options avalible, such as:
rhsm_hostname =
then restart virt-who service
#service virt-who restart
rhsm_username=[your test accout]
rhsm_password=[your test accout]
rhsm_hostname=subscription.rhsm.stage.redhat.com
rhsm_port=443
rhsm_prefix=/subscription
-for sam:
rhsm_username=admin
rhsm_password=admin
rhsm_hostname=samserv.redhat.com
rhsm_port=443
rhsm_prefix=/sam/api
virt-who restart and report mapping normally
restart virt-who normally, but fail to report mapping with error
info:
- for stage candlepin:
" Communication with subscription manager failed with code
401: Invalid username or password"
- for satellite6:
"Server error attempting a GET to /rhsm/status/ returned status
404" or "Name or service not known"
restart virt-who normally but failed to send mapping with error
info:
- for stage candlepin:
" Communication with subscription manager failed with code
401: Invalid username or password"
- for satellite6:
"Server error attempting a GET to /rhsm/status/ returned status
404" or "Name or service not known"
7. configure rhsm_hostname to wrong and
keep other options avalible, such as:
rhsm_hostname = xxx
restart virt-who normally but fail to send mapping with error:
"gaierror: [Errno -2] Name or service not known"
***BZ 1450738, should not show exception info
then restart virt-who service
#service virt-who restart
8. configure rhsm_hostname with https
prefix, such as:
rhsm_hostname =
https://bootp-73-3-218.eng.pek2.redhat.com
should get and send json info normally.
BZ 1404878 existing, but WONTFIX
then restart virt-who service
#service virt-who restart
9. disable rhsm_port option and keep other
options avalible, such as:
# rhsm_port=
restart virt-who and report mappings normally, due to it will use
the "rhsm_port=443" configured in /etc/rhsm/rhsm.conf
then restart virt-who service
#service virt-who restart
10. configure rhsm_port option value to null
and keep other options avalible, such as:
rhsm_port=
then restart virt-who service
#service virt-who restart
11. configure rhsm_port option value to
wrong and keep other options avalible, such
as:
rhsm_port=442
then restart virt-who service
#service virt-who restart
12. disable rhsm_port option and keep
other options avalible, such as:
# rhsm_prefix=
then restart virt-who service
#service virt-who restart
13. configure rhsm_port option value to null
and keep other options avalible, such as:
rhsm_prefix=
then restart virt-who service
#service virt-who restart
14. configure rhsm_port option value to
wrong and keep other options avalible, such
as:
rhsm_prefix=/xxx
then restart virt-who service
#service virt-who restart
restart virt-who and report mappings normally, due to it will use
the "rhsm_port=443" configured in /etc/rhsm/rhsm.conf
restart virt-who normally, but fail to report mapping with error:
"error: [Errno 111] Connection refused"
BZ 1450738 existing, should not show exception info
- for stage candlepin
restart virt-who and report mapping normally, due to it will use
the "rhsm_prefix=/subscription" configured in
/etc/rhsm/rhsm.conf
-for satellite6
restart virt-who normally, but fail to report mapping with error:
"Communication with subscription manager failed with code
404:"
- for stage candlepin
restart virt-who and report mapping normally, due to it will use
the "rhsm_prefix=/subscription" configured in
/etc/rhsm/rhsm.conf
-for satellite6
restart virt-who normally, but fail to report mapping with error:
"Communication with subscription manager failed with code
404:"
-for stage candlepin
"Server error attempting a GET to /xxx/status/ returned status
404"
- for satellite6:
"RestlibException" or "NetworkException: Network error code:
400"
RHEL7-87441 - 1054- Check rhsm proxy function under /etc/rhsm/rhsm.conf and /etc/virt-
who.d/
Step
***Not for Local_Libvirt, VDSM
NOTE:
"no_proxy=" option in /etc/rhsm/rhsm.conf can
disable rhsm proxy set in /etc/rhsm/rhsm.conf
Expected Result
Refer to BZ 1404878 BZ 1299643 
and /etc/virt-who.d/xx.conf
"NO_PROXY=" option manually added in
/etc/sysconfig/virt-who can disable all proxy set in
/etc/rhsm/rhsm.conf, /etc/virt-who.d/xx.conf and
/etc/sysconfig/virt-who
1. create conf file under /etc/virt-who.d/, such as:
#vi /etc/virt-who.d/xen.conf
[sate-xen]
type=xen
owner=Default_Organization
env=Library
server=10.73.5.231
username=root
password=red2017
2. configure rhsm proxy in /etc/rhsm/rhsm.conf
# vi /etc/rhsm/rhsm.conf
proxy_hostname =
bootp-73-3-248.eng.pek2.redhat.com
proxy_port = 3128
3. configure rhsm proxy to wrong in
/etc/rhsm/rhsm.conf
# vi /etc/rhsm/rhsm.conf
proxy_hostname = xxx.eng.pek2.redhat.com
proxy_port = xxx
4. configure rhsm proxy to wrong with
"no_proxy=server_hostname" in
/etc/rhsm/rhsm.conf.
# vi /etc/rhsm/rhsm.conf
proxy_hostname = xxx.eng.pek2.redhat.com
proxy_port = xxx
no_proxy = subscription.rhsm.stage.redhat.com
5. configure rhsm proxy to wrong with
"no_proxy=*" in /etc/rhsm/rhsm.conf.
# vi /etc/rhsm/rhsm.conf
proxy_hostname = xxx.eng.pek2.redhat.com
proxy_port = xxx
no_proxy = *
6. configure rhsm proxy to wrong in
/etc/rhsm/rhsm.conf and
"NO_PROXY=server_hostname" in
/etc/sysconfig/virt-who
# vi /etc/rhsm/rhsm.conf
proxy_hostname = xxx.eng.pek2.redhat.com
proxy_port = xxx
# vi /etc/sysconfig/virt-who
NO_PROXY=subscription.rhsm.stage.redhat.com
restart virt-who service and check rhsm
log:
h/g mapping is OK.
restart virt-who service and check rhsm
log:
"Unable to connect to:
bootp-73-3-248.eng.pek2.redhat.com:None
[Errno -8] Servname not supported for
ai_socktype"
restart virt-who service and check rhsm
log:
h/g mapping is OK.
restart virt-who service and check rhsm
log:
h/g mapping is OK.
restart virt-who service and check rhsm
log:
h/g mapping is OK.
7. configure rhsm proxy to wrong in
/etc/rhsm/rhsm.conf and "NO_PROXY=*" in
/etc/sysconfig/virt-who
# vi /etc/rhsm/rhsm.conf
proxy_hostname = xxx.eng.pek2.redhat.com
proxy_port = xxx
# vi /etc/sysconfig/virt-who
NO_PROXY=*
8. remove all proxy setting under
/etc/rhsm/rhsm.conf, and add rhsm proxy to
/etc/virt-who.d/xx.conf
# vi /etc/virt-who.d/xen.conf
rhsm_proxy_hostname =
bootp-73-3-248.eng.pek2.redhat.com
rhsm_proxy_port = 3128
9. configure rhsm proxy to wrong in /etc/virt-
who.d/xx.conf
# vi /etc/virt-who.d/xen.conf
rhsm_proxy_hostname =
xxx.eng.pek2.redhat.com
rhsm_proxy_port = xxx
restart virt-who service and check rhsm
log:
h/g mapping is OK.
restart virt-who service and check rhsm
log:
h/g mapping is OK.
restart virt-who service and check rhsm
log:
[Errno -8] Servname not supported for
ai_socktype
10. configure rhsm proxy to wrong in /etc/virt-
who.d/xx.conf and "no_proxy=server_hostname"
in /etc/rhsm/rhsm.conf
# vi /etc/rhsm/rhsm.conf
no_proxy = subscription.rhsm.stage.redhat.com
restart virt-who service and check rhsm
log:
h/g json info can be fetched and sent
normally.
# vi /etc/virt-who.d/xen.conf
rhsm_proxy_hostname =
xxx.eng.pek2.redhat.com
rhsm_proxy_port = xxx
11. configure rhsm proxy to wrong in /etc/virt-
who.d/xen.conf and "no_proxy=*" in
/etc/rhsm/rhsm.conf
# vi /etc/rhsm/rhsm.conf
no_proxy = *
# vi /etc/virt-who.d/xen.conf
rhsm_proxy_hostname =
xxx.eng.pek2.redhat.com
rhsm_proxy_port = xxx
12. configure rhsm proxy to wrong in /etc/virt-
who.d/xx.conf with
"NO_PROXY=server_hostname" in
/etc/sysconfig/virt-who
# vi /etc/sysconfig/virt-who
NO_PROXY=subscription.rhsm.stage.redhat.com
# vi /etc/virt-who.d/xen.conf
rhsm_proxy_hostname
restart virt-who service and check rhsm
log:
h/g mapping is OK.
restart virt-who service and check rhsm
log:
h/g mapping is OK.
=xxx.eng.pek2.redhat.com
rhsm_proxy_port = xxx
13. configure rhsm proxy to wrong in /etc/virt-
who.d/xxconf with "NO_PROXY=*" in
/etc/sysconfig/virt-who
# vi /etc/sysconfig/virt-who
NO_PROXY=*
# vi /etc/virt-who.d/xen.conf
rhsm_proxy_hostname =
xxx.eng.pek2.redhat.com
rhsm_proxy_port = xxx
restart virt-who service and check rhsm
log:
h/g mapping is OK.
RHEL7-79919 - 1055-[Satellite] - Check virt-who can send mapping info to multi-org
Step
***Not for Local_Libvirt, VDSM
1. Configure a new org in satellite(eg:BJ_OG_LB).
Open satellite webUI, go to Default Organization-->Manage
organization-->New organization
2. Unregister virt-who host
# subscription-manager unregister
3. Configure virt-who run at any mode with
"owner=Default_Organization"
such as:
# /etc/virt-who.d/hyperv.conf
[test-hyperv1]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=Default_Organization
env=Library
rhsm_hostname=bootp-73-3-167.eng.pek2.redhat.com
rhsm_port=443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=admin
4. Restart virt-who service and check rhsm.log
5. Check satellite WebUI
Expected Result
Refer to BZ
1408935 BZ
1415025 BZ 1408792
With rhsm options
configured, virt-who
can send hypervisor
to the defined org
successfully.
virt-who should fetch
and send the
hosts/guests info to
server normally.
hypervisors just can
show on "Default
6. Unregister/delete hypervisor registered above from webui,
then configure virt-who run at any mode with
"owner=BJ_OG_LB"
and "owner=Default_Organization"
such as:
# /etc/virt-who.d/hyperv.conf
[test-hyperv1]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=Default_Organization
env=Library
rhsm_hostname=bootp-73-3-167.eng.pek2.redhat.com
rhsm_port=443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=admin
[test-hyperv2]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=BJ_OG_LB
env=Library
rhsm_hostname=bootp-73-3-167.eng.pek2.redhat.com
rhsm_port=443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=admin
7. Restart virt-who service and check rhsm.log
8. Check satellite webUI, go to "Default organization--
>BJ_OG_LB-->Hosts-->Content hosts"
organization-->Hosts-
->Content hosts"
Configure the same
hypervisor mode to
different orgs in the
same server
successfully.
virt-who should
fetch and send the
hosts/guests
mapping to the
defined server
successfully.
hypervisors can
show on both
"Default
organization--
>BJ_OG_LB--
>Hosts-->Content
hosts"
and "Default
organization--
>Hosts-->Content
hosts"
RHEL7-53840 - 1056-Check filter_hosts option in /etc/virt-who.d config file
Step
***Not for Local_Libvirt, VDSM
1.  filter_hosts options can be used for (remote libvirt,
hypervisor, esx, xen, hyperv), but if ( vcenter, rhevm, xencenter)
is configured, this options become more useful for two or more
hosts.
filter_hosts:
Only hosts which uuid (or hostname or hwuuid, based on
hypervisor_id) is specified in comma-separated list in this option
will be  reported.
filter_host_uuids is deprecated alias for this option.
2. create a config file in /etc/virt-who.d, and add filter_host_uuids
option with host_uuid value to filter host, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.72
username=Administrator@vsphere.local
password=qwer1234P!
owner=ACME_Corporation
env=Library
filter_hosts="aee4ff00-8c33-11e2-994a-6c3be51d959a"
3. restart virt-who service and check the rhsm.log
4. set a NULL value to filter_host_uuids and check again, such
as:
filter_hosts=""
filter_hosts=''
filter_hosts=
5. use different quotes for split, such as:
1). double quote:
filter_hosts="aee4ff00-8c33-11e2-994a-6c3be51d959a",
"86b2bd00-8bad-11e2-87f4-6c3be514699d"
2). single quote:
filter_hosts='aee4ff00-8c33-11e2-994a-6c3be51d959a',
'86b2bd00-8bad-11e2-87f4-6c3be514699d'
Expected Result
Refer to BZ 1259295 BZ 1318915 BZ
1359653 BZ 1401420  BZ 1445579 
- for esx/xen/rhevm mode, should add two
or more hosts to these vm managers.
-for remote libvirt/hyperv mode, only one
hypervisor to filter and exclude.
virt-who only send
"aee4ff00-8c33-11e2-994a-6c3be51d959a"
to Sam/Satellite/Stage Candlepin, other
host_uuid will skip 
virt-who will skip all the host_uuid and give
"0 hypervisors and 0 guests found"
mapping to rhsm log
virt-who will send the host_uuid according
to filter_hosts value even though different
quotes or separator, skip other host_uuid
3). blank space between uuids
filter_hosts='aee4ff00-8c33-11e2-994a-6c3be51d959a',   
'86b2bd00-8bad-11e2-87f4-6c3be514699d'
4). blank space before comma
filter_hosts='aee4ff00-8c33-11e2-994a-6c3be51d959a'
 ,'86b2bd00-8bad-11e2-87f4-6c3be514699d'
5). with different quote:
filter_hosts='aee4ff00-8c33-11e2-994a-6c3be51d959a',
"86b2bd00-8bad-11e2-87f4-6c3be514699d"
RHEL7-53841 - 1057-Check exclude_hosts option in /etc/virt-who.d config file
Step
***Not for Local_Libvirt, VDSM
1. exclude_hosts options can be used for (remode_libvirt, rhevm,
esx, hyper-v, xen), but if ( vcenter, rhevm, xencenter) is configured,
this options become more useful for two or more hosts.
exclude_hosts:
Hosts  which  uuid (or hostname or hwuuid, based on hypervisor_id)
is specified in comma-separated list in this option will NOT be
reported.
exclude_host_uuids is deprecated alias for this option.
2. create a config file in /etc/virt-who.d, and add exclude_hosts with
host_uuid value to filter host, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.72
username=Administrator@vsphere.local
password=qwer1234P!
owner=ACME_Corporation
env=Library
exclude_hosts="aee4ff00-8c33-11e2-994a-6c3be51d959a"
3. restart virt-who service and check the rhsm.log
4. set a NULL value to exclude_host_uuids and check again, such
as:
exclude_hosts=""
exclude_hosts=''
exclude_hosts=
Expected Result
Refer to BZ 1318915 BZ 1359653 BZ
1401420
- for esx/xen/rhevm mode, should add two
or more hosts to these vm managers.
-for remote libvirt/hyperv mode, only one
hypervisor to filter and exclude.
virt-who will send all host/guest mapping
info except
"aee4ff00-8c33-11e2-994a-6c3be51d959a"
to SAM/Satellite/Stage candlepin
virt-who will send all host/guest mapping
info to SAM/Satellite/Stage candlepin
5. use different quotes for split, such as:
1). double quote:
exclude_hosts="aee4ff00-8c33-11e2-994a-6c3be51d959a",
"86b2bd00-8bad-11e2-87f4-6c3be514699d"
virt-who will send all host/guest mapping
info except
"aee4ff00-8c33-11e2-994a-6c3be51d959a"
and
'86b2bd00-8bad-11e2-87f4-6c3be514699d'
to SAM/Satellite/Stage candlepin
if excluded all hypervisor, virt-who should
give "0 hypervisors and 0 guests found"
mapping to rhsm log
2). single quote:
exclude_hosts='aee4ff00-8c33-11e2-994a-6c3be51d959a',
'86b2bd00-8bad-11e2-87f4-6c3be514699d'
3). blank space between uuids
exclude_hosts='aee4ff00-8c33-11e2-994a-6c3be51d959a',   
'86b2bd00-8bad-11e2-87f4-6c3be514699d'
4). blank space before comma
exclude_hosts='aee4ff00-8c33-11e2-994a-6c3be51d959a'
  ,'86b2bd00-8bad-11e2-87f4-6c3be514699d'
5). with different quote:
exclude_hosts='aee4ff00-8c33-11e2-994a-6c3be51d959a'
  ,"86b2bd00-8bad-11e2-87f4-6c3be514699d"
RHEL7-53842 - 1058-[ESX] Check filter_host_parents option in /etc/virt-who.d config file
Expected Result
refer to BZ 1445579
virt-who only send host/guest mapping info
"domain-s98" to SAM/Satellite/Stage
server
virt-who will skip all the hosts and give "0
hypervisors and 0 guests found" mapping
to rhsm log
virt-who will send the hosts according to
filter_host_parents value even though
different quotes or separator, skip other
hosts
Step
***Only for ESX
NOTE: please add two or more hosts to
these vm managers
1. create a config file in /etc/virt-who.d, and
add filter_host_parents with domain_id
value to filter host, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.72
username=Administrator@vsphere.local
password=qwer1234P!
owner=ACME_Corporation
env=Library
filter_host_parents="domain-s98"
2. restart virt-who service and check the
rhsm.log
3. set a NULL value to filter_host_parents
and check again, such as:
filter_host_parents=""
filter_host_parents=''
filter_host_parents=
4. set two or more value to
filter_host_parents, use different quotes for
split, such as:
1). double quote:
filter_host_parents="domain-s98","domain-
c122"
2). single quote:
filter_host_parents='domain-s98','domain-
c122'
3). blank space between uuids
filter_host_parents="domain-s98",  
 "domain-c122"
4). blank space before comma
filter_host_parents="domain-s98"   ,
"domain-c122"
5). with different quote:
filter_host_parents="domain-s98" ,
'domain-c122'
RHEL7-53843 - 1059-[ESX] Check exclude_host_parents option in /etc/virt-who.d config
file
Step
***Only for ESX
NOTE: please add two or more
hosts to these vm managers
1. create a config file in /etc/virt-who.d, and
add exclude_host_parents with domain_id
value to filter host, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.72
username=Administrator@vsphere.local
password=qwer1234P!
owner=ACME_Corporation
env=Library
 
2. restart virt-who service and check the
rhsm.log
3. set a NULL value to
exclude_host_parents and check again,
such as:
exclude_host_parents=""
exclude_host_parents=''
exclude_host_parents=
4. set two or more value to
exclude_host_parents, use
different quotes for split, such as:
1). double quote:
exclude_host_parents="domain-s98",
"domain-c122"
2). single quote:
exclude_host_parents='domain-s98',
'domain-c122'
3). blank space between uuids
Expected Result
refer to BZ 1445579
virt-who will send all host/guest mapping
info except "domain-s98" to
SAM/Satellite/Stage candlepin
virt-who will send all host/guest mapping
info to SAM/Satellite/Stage candlepin
virt-who will send all host/guest mapping
info except "domain-s98" and "domain-
c122" to SAM/Satellite/Stage candlepin
if excluded all hypervisor, virt-who should
give "0 hypervisors and 0 guests found"
mapping to rhsm log
exclude_host_parents="domain-s98",  
 "domain-c122" 
4). blank space before comma
exclude_host_parents="domain-s98"
  , "domain-c122" 
5). with different quote:
exclude_host_parents='domain-s98',
"domain-c122"
RHEL7-53844 - 1060-Check filter_hosts and exclude_hosts together in /etc/virt-who.d
config file.
Step
Expected Result
***Not for Local_Livirt, VDSM
NOTE:
- for esx/xen/rhevm mode, should add two or more
hosts to these vm managers.
-for remote libvirt/hyperv mode, only one hypervisor to
filter and exclude.
1. create a config file in /etc/virt-who.d, and add
filter_hosts and exclude_hostts to filter host, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.72
username=Administrator@vsphere.local
password=qwer1234P!
owner=ACME_Corporation
env=Library
filter_hosts="aee4ff00-8c33-11e2-994a-6c3be51d959a",
"86b2bd00-8bad-11e2-87f4-6c3be514699d"
exclude_hosts= "86b2bd00-8bad
11e2-87f4-6c3be514699d"
2. restart virt-who service and check the rhsm.log
will only send hosts on
aee4ff00-8c33-11e2-994a-6c3be51d959a
to SAM/Satelliter/Stage,
will skip
"86b2bd00-8bad-11e2-87f4-6c3be514699d"
 
RHEL7-53845 - 1061-[ESX] Check filter_host_parents and exclude_host_parents together
in /etc/virt-who.d config file
Step
Expected Result
***Only for ESX
NOTE: please add two or more hosts to
these vm managers
1. create a config file in /etc/virt-who.d, and
add filter_host_uuids and
exclude_host_parents to filter host, such
as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.72
username=Administrator@vsphere.local
password=qwer1234P!
owner=ACME_Corporation
env=Library
filter_host_parents="domain-s32","domain-
s72"
exclude_host_parents= "domain-s32"
2. restart virt-who service and check the
rhsm.log
will only send hosts on domain-s72 to
SAM/Satelliter/Stage,
will skip domain-s32
RHEL7-53846 - 1062-[ESX] Check filter_hosts and exclude_host_parents together in
/etc/virt-who.d config file
Step
Expected Result
***Only for ESX
NOTE: please add two or more hosts to these vm
managers
1. create a config file in /etc/virt-who.d, and add
filter_hosts and exclude_host_parents to filter host,
such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.72
username=Administrator@vsphere.local
password=qwer1234P!
owner=ACME_Corporation
env=Library
filter_hosts="aee4ff00-8c33-11e2-994a-6c3be51d959a",
"86b2bd00-8bad-11e2-87f4-6c3be514699d"
exclude_host_parents= "domain-s32"
2. restart virt-who service and check the rhsm.log
will only send hosts on
domain-s72 to
SAM/Satelliter/Stage,
will skip domain-s32
RHEL7-53847 - 1063-[ESX] Check filter_host_parents and exclude_hosts together in
/etc/virt-who.d config file
Step
Expected Result
***Only for ESX
NOTE: please add two or more hosts to these vm
managers
1. create a config file in /etc/virt-who.d, and add
exclude_hosts and filter_host_parents to filter host, such
as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.72
username=Administrator@vsphere.local
password=qwer1234P!
owner=ACME_Corporation
env=Library
filter_host_parents= "domain-s32","domain-s72"
exclude_hosts="aee4ff00-8c33-11e2-994a-6c3be51d959a"
2. restart virt-who service and check the rhsm.log
will only send hosts
"86b2bd00-8bad-11e2-87f4-6c3be514699d"  to
SAM/Satelliter/Stage
will
skip"
aee4ff00-8c33-11e2-994a-6c3be51d959a
"
RHEL7-53848 - 1064-[ESX] Check simplified_vim option in /etc/virt-who.d config file
Step
***Only for ESX
Expected Result
Refer to BZ 1339419                         
1. create a esx config file and config
simplified_vim to "false" in /etc/virt-who.d, such
as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.73.2.15
username=Administrator@vsphere.local
password=Welcome1!
owner=7661967
env=7661967
simplified_vim=false
2. restart virt-who service and check rhsm.log
3. create a esx config file and config
virt-who  by  default uses stripped-
down version of vimService.wsdl file
that contains vSphere SOAP API
definition. Set this option to false to
use server provided wsdl file that will
be retrieved automatically.
simplified_vim to "true" in /etc/virt-
who.d, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.73.2.15
username=Administrator@vsphere.local
password=Welcome1!
owner=7661967
env=7661967
simplified_vim=true
4. restart virt-who service and check
rhsm.log
virt-who can send mapping info to
server. it shouldn't show any error info
in rhsm.log.
RHEL7-53849 - 1065-Check hypervisor_id option in /etc/virt-who.d config file
Step
Expected Result
***not for Local_Libvirt, VDSM
NOTE:
hypervisor_id:
Property that should be used as
identification of the hypervisor. Can be
one of following: uuid, hostname,
hwuuid.
1. create a config file and set
hypervisor_id to uuid, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.73.2.15
username=Administrator@vsphere.local
password=Welcome1!
owner=7661967
env=7661967
hypervisor_id=uuid
2. restrat virt-who, check rhsm.log and
server webui.
Refer to BZ 1233074 BZ 1315547 BZ
1367287 BZ 1401420 BZ 1437229  BZ
1458125
1) for stage candlepin, satellite6.3.x:
- rhsm log should show hypervisor details with
uuid, like below showing, but still send
hostname to server webui:
"hypervisorId": {
                "hypervisorId":
"8e2d4136-3a06-41a1-9c84-aee6ecf103ad"
            },
            "name": "xenmaster",
            "guestIds": [
                {
                    "guestId": "0565daea-bcbb-
bf1c-03a5-df2bd3bd7f34",
                    "state": 1,
                    "attributes": {
                        "active": 1,
                        "virtWhoType": "xen"
                    }
                }
            ],
            "facts": {
                "hypervisor.type": "XenServer",
                "cpu.cpu_socket(s)": "2",
                "hypervisor.version": "7.1.0"
            }
2) for satellite6.1, satellite6.2 and sam
- rhsm log shows uuid without hypervisor's
detail info, just show guest info, like below
showing, and can send uuid to server webui:
    "0eb6c08a-596a-473a-9fbd-e5aca3f8538a":
[
        {
            "guestId": "bb59d0d9-0f3c-4809-8401-
dd041cc22746",
            "state": 1,
            "attributes": {
                "active": 1,
                "virtWhoType": "rhevm"
            }
        }
    ],
1). for stage candlepin, satellite6.3.x:
- rhsm log should show hypervisor detail facts
info with hostname, like below showing, and
send hostname to server webui:
        {
            "hypervisorId": {
                "hypervisorId": "xenmaster"
            },
            "name": "xenmaster",
            "guestIds": [
                {
                    "guestId": "0565daea-bcbb-
bf1c-03a5-df2bd3bd7f34",
                    "state": 1,
                    "attributes": {
                        "active": 1,
                        "virtWhoType": "xen"
                    }
                }
3. set hypervisor_id to hostname, such
as:
hypervisor_id=hostname
4. restrat virt-who, check rhsm.log and
server webui.
            ],
            "facts": {
                "hypervisor.type": "XenServer",
                "cpu.cpu_socket(s)": "2",
                "hypervisor.version": "7.1.0"
            }
        },
2). for satellite6.1, satellite6.2 and sam
- rhsm log shows hostname without
hypervisor's detail facts info, just show guest
info, like below showing, and send hostname
to server webui:
    "10.66.144.11": [
        {
            "guestId": "bb59d0d9-0f3c-4809-8401-
dd041cc22746",
            "state": 1,
            "attributes": {
                "active": 1,
                "virtWhoType": "rhevm"
            }
        }
NOTE: virt-who should send the hypervisor
hostname, not the define name in
RHEVM/vCenter/Xencenter
***BZ 1389729 existing for rhevm, not use
hostname (CLOSED)
***Bug 1408782 existing for satellite6.2, should
keep only one hypervisor in webui
***Bug 1520807 existing for stage candlepin
hwuuid just for esx and rhevm mode, but need
to test with other hypervisors to check if the log
is normall.
***for rhevm/esx
1) for stage candlepin, satellite6.3.x:
- rhsm log should show hypervisor detail facts
info with hwuuid, like below showing, and still
send hostname to server webui:
{
            "hypervisorId": {
                "hypervisorId": "host-83"
            },
            "name": "bootp-73-5-206",
            "guestIds": [
                {
                    "guestId": "421c583c-5d6a-79e4-
d50b-22db99686f6b",
                    "state": 1,
                    "attributes": {
5. set hypervisor_id to hwuuid, such as:
hypervisor_id=hwuuid
6. restrat virt-who, check rhsm.log and
server webui.
                        "active": 1,
                        "virtWhoType": "esx"
                    }
                },
            ],
            "facts": {
                "hypervisor.type": "VMware ESXi",
                "cpu.cpu_socket(s)": "2",
                "hypervisor.version": "6.5.0"
            }
        },
2) for satellite6.1, satellite6.2 and sam
- rhsm log shows uuid without hypervisor's
detail facts info, just show guest info, like
below showing, and send uuid to server webui:
   
"456BDE80-8BA8-11E2BD4C10604B88F13F":
[
        {
            "guestId": "bb59d0d9-0f3c-4809-8401-
dd041cc22746",
            "state": 1,
            "attributes": {
                "active": 1,
                "virtWhoType": "rhevm"
            }
        }
]
***for remote_libvirt/hyperv/xen mode,
the error should be as following : 
"Thread 'stage-libvirt' fails with error: Invalid
option hwuuid for hypervisor_id, use one of:
uuid, or hostname"
should no error - "NameError: global name 'virt'
is not defined"
***Bug 1408782 existing for satellite6.2, should
keep only one hypervisor in webui
***Bug 1520807 existing for stage candlepin
RHEL7-79884 - 1066-Check hostname show correct when hostname is not with domain
name
Step
Expected Result
***Only for ESX and Remote Libvirt
Refer to BZ 1361434 BZ 1361445 
1. configure host's name to without
domain name in
KVM/XEN/HYPERV/ESX/RHEVM 
eg: "bootp-73-5-222"
 not "bootp-73-5-222.redhat.com"
2. create a config file and set
hypervisor_id to hostname, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.73.2.15
username=Administrator@vsphere.local
password=Welcome1!
owner=7661967
env=7661967
hypervisor_id=hostname
3. restart virt-who service and check
hostname in rhsm.log,
hostname shouldn't with extra "." at the end
of hostname.  eg "bootp-73-5-222.".
The hostname should be "bootp-73-5-222".
"bootp-73-5-222": [  
        {
            "guestId":
"42098426-0d49-7dc6-0cb7-2331f149b8aa",
 
            "state": 1, 
            "attributes": {
                "active": 1, 
                "virtWhoType": "esx", 
                "hypervisorType": "vmware"
            }
        }
    ]
RHEL7-53850 - 1067-Check hypervisor_id and filter_hosts option in /etc/virt-who.d config
file
Expected Result
Refer to BZ 1272149 
Step
***hypervisor_id=uuid/hostname, not for Local_Libvirt,
VDSM
***hypervisor_id=hwuuid, only for ESX and RHEVM.
1. this case is only for vcenter /rhevm/scvmm(hyperv-
manager), please add two or more hosts to these vm
managers, such as:
1). domain-s32 with host1 
aee4ff00-8c33-11e2-994a-6c3be51d959a
2). domain-s72 with host2 
86b2bd00-8bad 11e2-87f4-6c3be514699d
2. create a config file and set hypervisor_id to uuid
restart virt-who and check rhsm.log, it
should show json with uuid,
but only send 
"aee4ff00-8c33-11e2-994a-6c3be51d959a"
json info
and filter_hosts, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.73.2.15
username=Administrator@vsphere.local
password=Welcome1!
owner=7661967
env=7661967
hypervisor_id=uuid
filter_hosts="aee4ff00-8c33-11e2-994a-6c3be51d959a"
3. set hypervisor_id to hostname and filter_hosts, such
as:
hypervisor_id=hostname
filter_hosts="bootp-73-5-248.rhts.eng.pek2.redhat.com"
restart virt-who and check rhsm.log, it
should show the json info with hostname,
but only send hostname
"bootp-73-5-248.rhts.eng.pek2.redhat.com"
4. set hypervisor_id to hwuuid and filter_hosts,such as:
hypervisor_id=hwuuid
filter_hosts="host-53"
restart virt-who and check rhsm.log, it
should show the json info with hwuuid
but only send hwuuid "host-53"
RHEL7-53851 - 1068-Check hypervisor_id and exclude_hosts option in /etc/virt-who.d
config file
Step
Expected Result
***hypervisor_id=uuid/hostname, not for Local_Libvirt,
VDSM
***hypervisor_id=hwuuid, only for ESX and RHEVM.
1. this case is only for vcenter /rhevm/scvmm(hyperv-
manager), please add two or more hosts to these vm
managers, such as:
1). domain-s32 with host1 
aee4ff00-8c33-11e2-994a-6c3be51d959a
2). domain-s72 with host2 
86b2bd00-8bad 11e2-87f4-6c3be514699d
2. create a config file and set hypervisor_id to uuid, such
as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.73.2.15
username=Administrator@vsphere.local
password=Welcome1!
owner=7661967
env=7661967
hypervisor_id=uuid
exclude_hosts="aee4ff00-8c33-11e2-994a-6c3be51d959a"
restart virt-who and check rhsm.log, it
should show the json  with uuid,
but will skip
"aee4ff00-8c33-11e2-994a-6c3be51d959a"
3. set hypervisor_id to hostname and exclude_hosts, such
as:
restart virt-who and check rhsm.log, it
should show the json with hostname ,
hypervisor_id=hostname
exclude_hosts=bootp-73-5-248.rhts.eng.pek2.redhat.com"
4. set hypervisor_id to hwuuid and exclude_hosts, such as:
hypervisor_id=hwuuid
exclude_hosts="host-53"
but will skip hostname
"bootp-73-5-248.rhts.eng.pek2.redhat.com"
restart virt-who and check rhsm.log, it
should show the json with hwuuid ,
but will skip hwuuid "host-53"
RHEL7-87349 - 1069-Check filter and exclude ability for
hypervisor_id=uuid/hostname/hwuuid using wildcard
Step
Expected Result
***not for Local_Libvirt, VDSM
Refer to BZ 1405967 BZ 1405967 
1. create a config file and set hypervisor_id to
hostname, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.73.3.222
username=Administrator@vsphere.local
password=Welcome1!
owner=7661967
env=7661967
hypervisor_id=hostname
2. set filter_hosts with hypervisor_id=hostname, such
as:
hypervisor_id=hostname
filter_hosts="bootp-73-5-210.rhts.eng.pek2.redhat.com",
"bootp-73-5-232.rhts.eng.pek2.redhat.com"
3. set filter_hosts using ending wildcard with
hypervisor_id=hostname,
such as:
hypervisor_id=hostname
filter_hosts=bootp*
restart virt-who and check rhsm.log, it
should show the json  with hostname:
{
    "host236": [],
   
"bootp-73-5-210.rhts.eng.pek2.redhat.com":
[]
    "host206": [],
   
"bootp-73-5-232.rhts.eng.pek2.redhat.com":
[]
}
restart virt-who and check rhsm.log, it
should filter and show the json  with
hostname:
{
   
"bootp-73-5-210.rhts.eng.pek2.redhat.com":
[]
   
"bootp-73-5-232.rhts.eng.pek2.redhat.com":
[]
}
restart virt-who and check rhsm.log, it
should filter all the hostname begining with
"bootp"
{
   
"bootp-73-5-210.rhts.eng.pek2.redhat.com":
[]
   
"bootp-73-5-232.rhts.eng.pek2.redhat.com":
[]
}
4. set filter_hosts using beginning wildcard with
restart virt-who and check rhsm.log, it
hypervisor_id=hostname,
such as:
hypervisor_id=hostname
filter_hosts=*.redhat.com
5. set filter_hosts using middle wildcard with
hypervisor_id=hostname,
such as:
hypervisor_id=hostname
filter_hosts=bootp*redhat.com
6.  set exclude_hosts using wildcard with
hypervior_id=hostname.
the steps refer to step3-5
7. set exclude_hosts and filter_hosts using wildcard
together to filter hosts, such as:
filter_hosts=bootp*
exclude_hosts=bootp-73-5-2*
8. change hypervisor_id to uuid and restart virt-who.
9. set filter_hosts using wildcard with
hypervisor_id=uuid,
such as:
hypervisor_id=uuid
filter_hosts=9fea4d56*
10. set exclude_hosts using wildcard with
hypervisor_id=uuid,
such as:
hypervisor_id=uuid
exclude_hosts=*e7872726c0d7
should filter all the hostname ending with
"redhat.com"
{
   
"bootp-73-5-210.rhts.eng.pek2.redhat.com":
[]
   
"bootp-73-5-232.rhts.eng.pek2.redhat.com":
[]
}
restart virt-who and check rhsm.log, it
should filter all the hostname with
"redhat.com"
{
   
"bootp-73-5-210.rhts.eng.pek2.redhat.com":
[]
   
"bootp-73-5-232.rhts.eng.pek2.redhat.com":
[]
}
can use wildcard to exclude hostname.
can only filter the
"bootp-73-5-232.rhts.eng.pek2.redhat.com":
[]
it will show all the  Host-to-guest mapping:
{
  "9fea4d56-5ed5-ddfe-b806-
e7872726c0d7": [],
  "44924d56-c187-17c7-
f4e8-7ef45e796d8b": [],
  "33744d56-dd96-0722-
fea2-2038132de72d": []
}
restart virt-who and check rhsm.log, it
should filter the host, which uuid begin with
'9fea4d56'.
{
    "9fea4d56-5ed5-ddfe-b806-
e7872726c0d7": []
}
restart virt-who and check rhsm.log, it
should exclude the host, which uuid end
with 'e7872726c0d7'.
{
  "44924d56-c187-17c7-
f4e8-7ef45e796d8b": [],
  "33744d56-dd96-0722-
fea2-2038132de72d": []
}
11. change hypervisor_id to hwuuid, and check the filter
and exclude function with wildcard,
refer to step8-10.
the hwuuid also will support wildcard
Note: hwuuid just for ESX, RHEVM
RHEL7-79916 - 1070-[Satellite] - Check virt-who support multi-org
Step
Expected Result
***Not for Local_Libvirt, VDSM
1. Configure a new org in
satellite(eg:BJ_OG_LB).
Open satellite webUI, go to Default
Organization-->Manage organization--
>New organization
2. Register virt-who host to satellite with
default org (Default_Organization)
# subscription-manager register --
username=admin --password=admin --
org=Default_Organization
3. Configure virt-who run at any
mode with
"owner=Default_Organization"
such as:
# /etc/virt-who.d/hyperv.conf
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=Default_Organization
env=Library
4. Restart virt-who service and check
rhsm.log
without rhsm options configured, virt-who
will register the hypervisor to the org same
with virt-who host.
mapping is OK with which org the host-to-
guests mapping is pointing, such as:
Host-to-guest mapping being sent to
'Default_Organization':
5. Open satellite webUI, go to "Default
organization-->Hosts-->Content hosts"
hypervisors can show on content hosts
page
6. Open satellite webUI, go to "Default
organization-->BJ_OG_LB-->Hosts--
>Content hosts"
7. Unregister virt-who host on terminal side
# subscription-manager unregister
hypervisors can't show on content
hosts page
8. Open satellite webUI, go to "Default
organization-->Hosts-->Content
hosts-->[physical host]", delete this
host.
delete host successfully.
skip the step, iIf do the opration on
Satellite WebUI -> "Administer" ->
"Settings" -> "Katello" ->
"unregister_delete_host" -> set to "True".
9. Register virt-who host to satellite's
another org BJ_OG_LB
# subscription-manager register --
username=admin --password=admin
--org=BJ_OG_LB
10.  Update virt-who run at any mode
with "owner=BJ_OG_LB"
such as:
# /etc/virt-who.d/hyperv.conf
[test-hyperv]
type=hyperv
server=10.66.128.9
username=Administrator
password=qwer1234P
owner=BJ_OG_LB
env=Library
11. Restart virt-who service and
check rhsm.log
12. Open satellite webUI, go to
"Default organization-->BJ_OG_LB--
>Hosts-->Content hosts"
13. Open satellite webUI, go to
"Default organization-->Hosts--
>Content hosts"
mapping is OK with which org the
host-to-guests mapping is pointing,
such as:
Host-to-guest mapping being sent to
'BJ_OG_LB':
hypervisors can show on content
hosts page
hypervisors can't show on content
hosts page
RHEL7-53852 - 1071-Check fake mode for single hypervisor in /etc/virt-who.d config file
Expected Result
Refer to BZ 1259038
Step
***For all hypervisor
1. stop virt-who service
2. run virt-who with -p to create the json
data
- if local libvirt mode:
# virt-who -p -d > /tmp/fake.json
- if vdsm mode:
# virt-who --vdsm -p -d > /tmp/fake.json
- if other remote hypervisor mode, need
to define by yourself, such as:
virt-who --esx --esx-owner=7661967 --
esx-env=7661967 --
esx-server=10.73.2.15 --esx-
username=Administrator@vsphere.local
--esx-
3. create a fake config file in /etc/virt-
who.d with is_hypervisor=Ture, such as:
[fake-virt]
type=fake
file=/tmp/fake.json
is_hypervisor=True
owner=7661967
env=7661967
4. restart virt-who service and check
rhsm.log
5. create a fake config file in /etc/virt-
who.d with is_hypervisor=False, such
as:
[fake-virt]
type=fake
file=/tmp/fake.json
is_hypervisor=False
owner=7661967
env=7661967
6. restart virt-who service and check
rhsm.log
is_hypervisor=True (default) works for
hypervisor(remote_kvm/esx/xen/rhevm/hyperv)
- if vdsm/local_kvm mode, virt-who should fail
to run the hypervisor with error:
Thread 'fake-virt' fails with error: Fake virt file
'/tmp/fake.json' is not properly formed: 'uuid'
- if remote_kvm/esx/xen/rhevm/hyperv, virt-
who shold succeed to send the mapping info
according to the file "/tmp/fake.json" normally.
***Bug 1360530 exists for satellite5
is_hypervisor=False works for local
mode(local_kvm, vdsm)
- if vdsm/local_kvm mode, virt-who should
succeed to send the mapping info according to
the file "/tmp/fake.json" normally.
- if remote_kvm/esx/xen/rhevm/hyperv,virt-who
will fail to run the fake conf with error:
Fake virt file '/tmp/fake.json' is not properly
formed: uuid key shouldn't be present, try to
check is_hypervisor value
RHEL7-53853 - 1072-Check fake mode, host and guest can subscirbe normally
Step
***For all hypervisor
Expected Result
1. register host and guest to
Sam/Satellite/Stage
2. create the host/guests associations file,
such as:
# virt-who --esx --esx-owner=7661967 --
esx-env=7661967 --esx-server=10.73.2.15
--esx-
username=Administrator@vsphere.local --
esx-password=Welcome1! -p -d >
/tmp/fake.json
3. create a fake config file in /etc/virt-
who.d, such as:
[fake-virt]
type=fake
file=/tmp/fake.json
is_hypervisor=True
owner=7661967
env=7661967
4. restart virt-who service and check
rhsm.log
5.
subscribe host to a physical pool
subscribe guest to the bonus pool
the offline file can be created by -p option
if is_hypervisor true (default), means the
fake mode is running for hypervisor;
if is_hypervisor false, means the fake
mode is running for local libvirt mode;
virt-who can send the mapping info
according to the file "/tmp/fake.json"
normally
the host and guest can be subscribed
normally
RHEL7-53854 - 1073-Check fake mode, guest consumed bonus pool revoke after
unregister host
Step
Expected Result
***For all hypervisor
1. register host and guest to
Sam/Satellite/Stage
2. create the host/guests associations file,
such as:
# virt-who --esx --esx-owner=7661967 --
esx-env=7661967 --esx-server=10.73.2.15
--esx-
username=Administrator@vsphere.local --
esx-password=Welcome1! -p -d >
/tmp/fake.json
3. create a fake config file in /etc/virt-
who.d, such as:
[fake-virt]
type=fake
file=/tmp/fake.json
is_hypervisor=True
owner=7661967
the offline file can be created by -p option
if is_hypervisor true (default), means the
fake mode is running for hypervisor;
if is_hypervisor false, means the fake
mode is running for local libvirt mode;
env=7661967
4. restart virt-who service and check
rhsm.log
virt-who can send the mapping info
according to the file "/tmp/fake.json"
normally
5. subscribe host to a physical pool
   subscribe guest to the bonus pool
the host and guest can be subscribed
normally
6. check consumed bonus on guest
# subscription-manager list --co
7. unregister host from server
8. refresh and check the consumed bonus
pool on guest
# subscription-manager refresh
# subscription-manager list --co
the consumed pool should be listed
the consumed pool should be revoked
RHEL7-53855 - 1074-Check fake mode for multiple hypervisors in /etc/virt-who.d config file
Step
Expected Result
***Not for Local_Libvirt, VDSM
1. config two different hypervisors in
/etc/sysconfig/virt-who or /etc/virt-who.d/,
for example:
# vi /etc/virt-who.d/libvirt.conf
[test-libvirt]
type=libvirt
server=10.66.129.60
username=root
password=redhat
owner=7661967
env=7661967
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.5
username=Administrator@vsphere.local
password=qwer1234P!
owner=7661967
env=7661967
2. run virt-who with -p option to create the
fake json, such as:
# virt-who -p -d > /tmp/fake.json
3. disable or remove  the above config
from /etc/sysconfig/virt-who or /etc/virt-
who.d/, and then 
create a fake config file in /etc/virt-who.d,
such as:
[fake-virt]
if is_hypervisor true (default), means the
fake mode is running for hypervisor;
if is_hypervisor false, means the fake
mode is running for local libvirt mode;
type=fake
file=/tmp/fake.json
is_hypervisor=True
owner=7661967
env=7661967
3. restart virt-who service and check
rhsm.log
virt-who can send the mapping info
according to the file "/tmp/fake.json"
including all the hypervisors normall.
RHEL7-53857 - 1075-Check virt-who log and thread normally after unregister/re-register
system
Step
***For all hypervisor
Expected Result
Refer to  BZ 1216278 BZ 1293821 BZ
1362351 BZ 1400788
1 Configure virt-who run at any mode
2 Register system to server and check virt-
who's log.
# tail -f /var/log/rhsm/rhsm.log
# subscription-manager register --
username=xxx --password=xxx
3 Unregister system and check virt-
who's log.
# tail -f /var/log/rhsm/rhsm.log
# subscription-manager unregister
System has been registered successfully.
No exception or error info found in the log
System has been unregistered
successfully.
No exception info found in the log.
Eg: "BadStatusLine"  or "error:
[Errno 4] Interrupted system call"
Within one interval time, it should
show system has been registered
info in the log.
"Unable to read certificate, system is
not registered or you are not root"
4. Check virt-who's status and thread 
# service virt-who status
# ps -ef|grep virt-who
Virt-who is still running.
Still only one virt-who thread (PPID = 1) is
exist.
RHEL7-79893 - 1076-Check virt-who log and thread normally if virt-who run in abnormal
Step
Expected Result
***Not for Local_Libvirt, VDSM
Refer to BZ 1339863
1 Configure virt-who run at any mode and
make sure the
vcenter/hyperv/rhevm/xen/rhel can't
reacheable
2 Restart virt-who service and check virt-
Virt-who run restart successfully, but it
who's log
# service virt-who restart && tail -f
/var/log/rhsm/rhsm.log
3 Restart virt-who service and check
virt-who's log again
hasn't get any response
from vcenter/hyperv/rhevm/xen/rhel.
Virt-who run restart successfully.
It shouldn't show error info as the
following:
"Interrupted system call"
4. Check virt-who's status and thread 
# service virt-who status
# ps -ef|grep virt-who
Virt-who is still running.
It should show only one virt-who threads
(PID=1).
RHEL7-79902 - 1077-[Satellite5.X] Check virt-who log normally after delete profiles in
/var/lib/virt-who
Step
Expected Result
***Only for satellite5.X server
Refer to BZ 1311962 BZ 1410317
1. Register system to server
2. Configure virt-who run at any
mode, restart virt-who service
3. Monitor profile which generate
by virt-who.
# cat /var/lib/virt-who
4. Delete all profiles 
# rm -rf /var/lib/virt-who/*
5. Restart virt-who service
and check virt-who's log
6. Check profiles
# cat /var/lib/virt-who/
7. Check server webui
virt-who send host/guest mapping info to server
It will show hypervisor-systemid-[uuid] as the
following:
[root@hp-z220-03 virt-who]# ls
 hypervisor-systemid-
bootp-73-5-222.rhts.eng.pek2.redhat.com
hypervisor-
systemid-2ea93fc2-4e47-4c14-9e83-6ceeb8d2f5d4
Virt-who restart successfully.
Virt-who send host/guest mapping to
service and it won't generate any error info
in the log.
It will generate new hypervisor-systemid-
[hostuuid], and [hostuuid] is the same as it
on rhsm.log.
It should update the hypervisor uuid based on the
original one, should not generate another same
hypervisor on WebUI.
RHEL7-53858 - 1078-[WEBUI] Check virt-who log normally after delete host/hypervisor in
server webUI
Step
Expected Result
***For all hypervisor
Refer to BZ 1284037 BZ 1325765
1. Register system to server
2. Configure virt-who run at any mode,
restart virt-who service
virt-who send host/guest mapping info to
server
3. Open server webUI, delete system
4. Restart virt-who service and check rhsm
log
5. Register system to server 
# subscription-manager clean
# subscription-manager register --
username=admin --password=admin
6. Monitor virt-who's log
# tail -f /var/log/rhsm/rhsm.log
Open server webUI, delete
hypervisor
virt-who won't send host/guest mapping
info to server.
It won't show any other exception
info except the following info:
"Unable to send data: Communication with
subscription manager failed: consumer no
longer exists"
It won't show any exception info in
the log.
RHEL7-90471 - 1079-Check the virt-who parameters consistency by CLI
Step
Expected Result
***Not for Local_Libvirt, VDSM
Refer to BZ 1404117, Bug 1461417
1. stop virt-who service
# systemctl stop virt-who
2. Run virt-who with all right and consistent
parameters for your different modes, such
as:
# virt-who --libvirt --libvirt-
owner=ACME_Corporation  --libvirt-
env=Library --libvirt-server=[Host2_IP] --
libvirt-username=root --libvirt-
password=redhat -d -o
3. Run virt-who with inconsistent
parameters, such as:
# virt-who --libvirt --hyperv-
owner=ACME_Corporation --
libvirt-env=Library --libvirt-
server=[Host2_IP] --libvirt-
username=root --xen-password=redhat -d
-o
Host/Guest mapping info can be showed
and sent to server successfully.
virt-who will fail to be started with error log:
Argument --hyperv-owner does not match
virtualization backend: libvirt
RHEL7-95000 - 1080 - [ESX] Check filter(exclude)_host_parents ability using wildcard
Expected Result
Refer to: BZ 1461272 
should filter out host "domain-s98"
should filter out all the hosts beginning
with "domain-". [BZ 1461272 ]
should exclude the host ending with "-s98"
[BZ 1461272 ]
should exclude the host ending with "-s98"
from all hosts beginning with "domain-" [BZ
1461272 ]
Step
***Only for ESX mode
1. create a config file in /etc/virt-who.d, and
add
filter_host_parents with domain_id value to
filter host, such
as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.72
username=Administrator@vsphere.local
password=qwer1234P!
owner=ACME_Corporation
env=Library
filter_host_parents="domain-s98"
2. configure filter_host_parents using
ending wildcard, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.72
username=Administrator@vsphere.local
password=qwer1234P!
owner=ACME_Corporation
env=Library
filter_host_parents="domain-*"
3. configure exclude_host_parents using
beginning wildcard, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.72
username=Administrator@vsphere.local
password=qwer1234P!
owner=ACME_Corporation
env=Library
exclude_host_parents="*-s98"
4. configure filter_host_parents and
exclude_host_parents together using
wildcard, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.66.79.72
username=Administrator@vsphere.local
password=qwer1234P!
owner=ACME_Corporation
env=Library
filter_host_parents="domain-*"
exclude_host_parents="*-s98"
RHEL7-103659 - 1081 - Creat a config file with two different hypervisors against different
servers in /etc/virt-who.d/
Step
***Not for Local_Libvirt, VDSM
Note: no need to register virt-who host.
Expected Result
Not for SAM with
Bug 1403122 - Failed to send
mapping info to SAM when run
virt-who with rhsm_username
and rhsm_password
[WONTFIX]
1. Disable hypervisor options in /etc/sysconfig/virt-who
2. Create a new config file including two hypervisors
against two different servers in /etc/virt-who.d/ with
rhsm parameters, such as:
# vi /etc/virt-who.d/test.conf
[stage-esx]
type=esx
owner=11343171
env=11343171
server=10.73.3.234
username=Administrator@vsphere.local
password=Welcome1!
rhsm_hostname=subscription.rhsm.stage.redhat.com
rhsm_port=443
rhsm_prefix=/subscription
rhsm_username=virtwho_test
rhsm_password=redhat
[sat-hyperv]
type=hyperv
owner=Default_Organization
env=Library
server=10.73.5.244
username=Administrator
password=Welcome1
rhsm_hostname=bootp-73-3-227.eng.pek2.redhat.com
rhsm_port=443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=admin
3. Restart virt-who service and check rhsm log
virt-who run normally and the
two hypervisors mapping can
be got and sent successfully.
4. Check the two hypervisors' info in server WebUI.
The two hypervisors can be
RHEL7-104173 - 1082 - Virt-who can check invalid parameters in /etc/virt-who.d/*.conf file
listed to the coincident server.
Step
***Not for vdsm, local libvirt
Expected Result
Refer to BZ 1436617 
1. Register virt-who host to Stage Candlepin/Satellite/Sam
server
2. Create virt-who conf file in /etc/virt-who.d, such as:
# vi /etc/virt-who.d/test.con[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.234
username=Administrator@vsphere.local
password=Welcome1!
3. Restart virt-who service and check rhsm log
4. Add invalid parameters to the virt-who conf file, such as:
# vi /etc/virt-who.d/test.con[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.234
username=Administrator@vsphere.local
password=Welcome1!
VIRTWHO_ESX_OWNER=Default_Organization
VIRTWHO_ESX_ENV=Library
VIRTWHO_ESX_SERVER=10.73.3.234
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_PASSWORD=Welcome1!
5. Restart virt-who service and check rhsm log
virt-who restart normally
and the mapping is OK.
virt-who should feedback
error message for these
invalid options, such as:
"Ignoring unknown
configuration option
"xxx""
RHEL7-110502 - 1083 - Check virt-who can get and send two same hostname to server
Step
Expected Result
***not for Local_Libvirt, VDSM
1.  Prepare two or more hypervisors with
same hostname, such as: one vCenter
contains two esx hosts with same
hostname - "esxhost".
2. Register virt-who host to Satellite/Stage
Candlepin/SAM
3. Create a config file and set
hypervisor_id to hostname, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.73.2.15
username=Administrator@vsphere.local
password=Welcome1!
owner=7661967
env=7661967
hypervisor_id=hostname
4. Create a config file and set
hypervisor_id to uuid, such as:
# vi /etc/virt-who.d/esx.conf
[test-esx]
type=esx
server=10.73.2.15
username=Administrator@vsphere.local
password=Welcome1!
owner=7661967
env=7661967
hypervisor_id=uuid
5. Restart virt-who and check server
WebUI
If remote_libvirt and hyperv, should
prepare two hosts with same hostname
and create two conf files in /etc/virt-who.d.
After restart virt-who, it will only report one
list of hostname to server WebUI.
After restart virt-who,
-For Satellite6: it will report the two host
uuid to server WebUI.
-For Stage Candlepin: it will report the two
same hostname to server WebUI
RHEL7-110582 - 1084 - Upgrade virt-who package
Step
***For all hypervisor
1. Uninstall virt-who
# rpm -e virt-who
Expected Result
virt-who should be uninstalled normally
2.  Install an old version virt-who, such as:
# rpm -ivh virt-who-0.19-2.el7.noarch
install successfully
3. Check the virt-who package
# rpm -qa |grep virt-who
the old version of virt-who package should
be listed.
configure successfully
4. Configure /etc/sysconfig/virt-who,
/etc/virt-who.conf and /etc/virt-who.d/, such
as:
# vi /etc/sysconfig/virt-who
VIRTWHO_DEBUG=1
VIRTWHO_INTERVAL=60
# vi /etc/virt-who.conf
interval=120
debug=False
# vi /etc/virt-who.d/esx.conf
[stage-esx]
type=esx
owner=11373231
env=11373231
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
5. Restart virt-who service to keep it
running
# systemctl restart virt-who
# systemctl status virt-who
6. Upgrade the virt-who package to the
latest test version from repo
# yum update virt-who
virt-who is running
7. Check the virt-who package again
# rpm -qa |grep virt-who
virt-who package should have been
upgraded to the latest version.
8. Check /etc/sysconfig/virt-who, /etc/virt-
who.conf and /etc/virt-who.d/x.conf
the configured info in above step4 still
exists:
9. Check virt-who status
# systemctl status virt-who
virt-who is still running
RHEL7-110601 - 1085 - Using Unicode characters in a hypervisor's account password
Step
Expected Result
***not for local_libvirt, vdsm
1.  Edit hypervisor's account password
with Unicode characters.
Hypervisor's account password should be
edit with unicode characters successfully,
such as:
- for libvirt: edit remote libvirt host account
password to "red2015????? "
- for esx: edit vCenter account password to
"Welcome1!????? "
- for rhevm: edit rhevm account password
to "redhat????? "
- for xen: edit xenmaster pool account
password to "xen!@#$%^&*"
- for hyperv: edit windows account
password to "Welcome1????? "
2.  Restart virt-who service to send
host-guest mapping should be ok in rhsm
mapping and check rhsm log
3. Check server WebUI
log.
*** Bug 1503271 - Problem with virt-who
using Unicode characters in a hypervisor's
account password?
hypervisors should be registered
successfully.
4. Edit the account password back to
original.
should no problem
RHEL7-110678 - 1086 - Congiure multi virt-who to send mapping
Step
***for all hypervisors
1. Prepare two or more virt-who hosts
Expected Result
2. Register all virt-who hosts to the same
server - SAM/Satellite/Stage Candlepin
register successfully
3. Configure all the virt-who with different
hypervisor modes by /etc/virt-
who.d/xxx.conf or /etc/sysconfig/virt-who
4. Start all the virt-who service at the same
time and check rhsm log
# systemctl restart virt-who & tail -f
/var/log/rhsm/rhsm.log
5. Check server WebUI
??if need configure virt-who with the same
hypervisor??
all virt-who service should be restarted
normally and mapping should be OK
all hypervisors should be registered
successfully
RHEL-112993 - 1087 - Virt-who how to check the job state
Step
Expected Result
***for all hypervisors against Stage
Candlepin and Satellite6.3
1. prepare one config file in /etc/virt-who.d,
and then run virt-who with interval 60:
# virt-who -i 60
virt-who will wait 15s to check the job state,
such as:
2017-11-03 01:22:17,475 INFO: Report for
config "esx_config" gathered, placing in
datastore
2017-11-03 01:22:18,394 INFO: Sending
update in hosts-to-guests mapping for
config
"destination_-1557685887681118964": 2
hypervisors and 1 guests found
2017-11-03 01:22:33,747 INFO: Mapping
for config
"destination_-1557685887681118964"
updated
2. prepare 2 config files in /etc/virt-who.d,
and then run virt-who with interval 60:
# virt-who -i 60
2017-11-03 01:23:17,478 INFO: Report for
config "esx_config" gathered, placing in
datastore
for rhel6.9 or rhel7.3, virt-who will print and
send the report one by one immediately,
after that, will check the job state one by
one (every 15s to check)
for rhel7.4 and rhel6.10 or above, virt-who
will print and send all the reports together,
after that, only check the job state once
3. prepare  5 config files in /etc/virt-who.d,
and then run virt-who with interval 60:
# virt-who -i 60
virt-who will take 15 seconds for each
check event,  now I have 5 config files to
send, virt-who how to check the job state?
for rhel7.4 or above, all the reports will be
printed and sent together, no matter how
many config files, only check the job state
once (take 15s)
for rhel6.9 and 7.3, the report will be
printed and sent one by one, after that, will
check the job state for each report, it will
take 5*15=75s to check all the job state.
But the interval time is 60s,  if the job state
check events can't be finished within the
interval time, virt-who will send the check
event in next interval
RHEL-113033 - 1088- Check hosts/guests mapping info is pointing to the specified owner
in the rhsm.log
Step
***for all hypervisors
Expected Result
Refer to Bug 1408556 
1. Create a config file in /etc/virt-who.d/virt-
who.conf, make sure the owner is enabled,
such as:
# vi /etc/virt-who.d/virt-who.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
2. Restart virt-who service and check rhsm
log
# systemctl restart virt-who & tail -f
/var/log/rhsm/rhsm.log
virt-who should be started normally and
show the h/g mapping is sent to which
owner, such as:
Host-to-guest mapping being sent to
RHEL-113034 - 1089 - Check all the options are valid in /etc/virt-who.d/xxx.conf
'Default_Organization'
Step
***not for Local_Libvirt, VDSM
Expected Result
Refer to Bug 1436617
1. Create a config file in /etc/virt-who.d/, and make
sure all the options are available, such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
2. Restart virt-who service and check rhsm log
# systemctl restart virt-who & tail -f
/var/log/rhsm/rhsm.log
virt-who should be started and
mapping can be got/sent
successfully.
3. Add some unsupported options to the conf file,
such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
VIRTWHO_LIBVIRT_OWNER=Default_Organization
VIRTWHO_LIBVIRT_ENV=Library
VIRTWHO_LIBVIRT_SERVER=10.66.129.67
VIRTWHO_LIBVIRT_USERNAME=root
VIRTWHO_LIBVIRT_PASSWORD=red2015
4. Restart virt-who service and check rhsm log
# systemctl restart virt-who & tail -f
/var/log/rhsm/rhsm.log
Error message should be
showed about the unsupported
options, such as:
"Ignoring unknown configuration
option "xxx"
RHEL-113035 - 1090 - Check the detail info of virt-who package by "# rpm -qi virt-who"
Step
***for all hypervisors
Expected Result
Refer to Bug 1502442 
1. Install the latest virt-who package
# yum install virt-who
2. Check details info of the virt-who
should rightly list all the virt-who package
detail,
Name:
Version:
Release:
Architecture:        ----Not for rhel6
Install Date:
Source RPM:
Build Date: ??
Build Host:
Vendor  : Red Hat, Inc.
URL         : https://github.com/virt-who/virt-
who
package
# rpm -qi virt-who
Name        : virt-who
Version     : 0.21.0
Release     : 1.el7
Architecture: noarch
Install Date: Thu 02 Nov 2017 03:57:44
PM CST
Group       : System Environment/Base
Size        : 795652
License     : GPLv2+
Signature   : (none)
Source RPM  : virt-
who-0.21.0-1.el7.src.rpm
Build Date  : Tue 31 Oct 2017 02:49:41
AM CST
Build Host  :
ppc-055.build.eng.bos.redhat.com
Relocations : (not relocatable)
Packager    : Red Hat, Inc.
<http://bugzilla.redhat.com/bugzilla>
Vendor      : Red Hat, Inc.
URL         : https://github.com/virt-who/virt-
who
Summary     : Agent for reporting virtual
guest IDs to subscription-manager
Description :
Agent that collects information about
virtual guests present in the system and
report them to the subscription manager.
RHEL-114168 - 1091 - Check section header option - "[global]" in /etc/virt-who.conf
Expected Result
Step
***for all hypervisor
1. Disable DEBUG/ONESHOE/INTERVAL
options in /etc/sysconfig/virt-who
2. Configure virt-who run in any hypervisor
mode by any way, such as:
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
3. Configure /etc/virt-who.conf with all 
options disabled
# grep -E -v '(^#|^$)' /etc/virt-who.conf
4. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
virt-who restart normally without debug
info and give reminder info:
"[global]: No values provided in: global"
5. Enable and set "debug=True" in 
/etc/virt-who.conf with [global] header
disabled.
# vi /etc/virt-who.conf
#[global]
debug=True
6. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
virt-who restart normally without debug
info and give error info:
"Configuration file /etc/virt-who.conf
contains no section headers"
7. Enable and set "debug=True" in 
/etc/virt-who.conf with [global] header
enabled.
# vi /etc/virt-who.conf
[global]
debug=True
8. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
virt-who restart normally with debug info
and no ERROR info
RHEL-113036 - 1092 - Check global option - "interval" in /etc/virt-who.conf
Step
***for all hypervisor
1. Disable debug/interval/oneshot in
/etc/sysconfig/virt-who, only enable debug
option in /etc/virt-who.conf:
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[global]
debug=True
2. Configure virt-who run in any mode by
/etc/virt-who.d/ or /etc/sysconfig/virt-who,
such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
3. Restart virt-who service
Expected Result
also can configure virt-who by
/etc/sysconfig/virt-who
virt-who restart normally with default
interval time 3600s with reminder info -
"[global]: Value for "interval" not set, using
default: 3600" and "Starting infinite loop
with 3600 seconds interval"
virt-who restart and send report normally
with default interval time 3600s with
warning info -
"??? ''
***Bug 1523482 , fail to report with null
value
- virt-who will send mapping by each
3600s with warning info: "Interval value
can't be lower than 60 seconds. Default
value of 3600 seconds will be used."
- should no the warning info show -
"[global]: Value for "interval" not set, using
default: 3600".
***Bug 1519704 existing, no reminder info
virt-who will send mapping by each 120s
and should no the warning info show -
4. Enable [global] option and configure
interval value to null, such as:
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[global]
interval=
debug=True
5. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
6. Configure interval time to 10s, such as:
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[global]
interval=10
debug=True
7. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
8. Configure interval time to 120s in
/etc/virt-who.conf, such as
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[global]
interval=120
debug=True
9. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
10. Configure /etc/sysconfig/virt-who with
interval=60 and /etc/virt-who.conf with
interval=120, such as:
# grep -E -v '(^#|^$)' /etc/sysconfig/virt-who
VIRTWHO_INTERVAL=60
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[global]
interval=120
debug=True
11. Restart virt-who service and check
rhsm log
# systemctl restart virt-who
12. Stop virt-who service and keep the
configuration in step10, then run virt-who
by CLI
# systemctl stop virt-who
# virt-who -d
13. Also keep configuration in step10, run
virt-who by CLI with "-i" option setting,
such as:
# virt-who -d -i 80
virt-who will send mapping by each 60s
NOTE:
1). the interval value configuration in
/etc/sysconfig/virt-who is higher than in
/etc/virt-who.conf.
2). debug/oneshot=True (or 1) take
effect no matter in /etc/sysconfig/virt-
who or /etc/virt-who.conf
virt-who will send mapping by each 120
NOTE: when run virt-who by CLI
without parameters (-i, -d, -o), it will use
the setting in /etc/virt-who.conf
virt-who will send mapping by each 80
NOTE: the interval value setting by CLI
is higher than in /etc/virt-who.conf
RHEL-114169 - 1093 - Check global option - "reporter_id" in /etc/virt-who.conf
Step
***for all hypervisr
NOTE: "reporter_id" is the id of this virt-
who instance to report mappings,
default is HOSTNAME-MACHINEID
1. Configure virt-who run in any mode
by /etc/virt-who.d/, such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
2. Enable [global] option and configure
"reporter_id" option disabled, such as:
# vi /etc/virt-who.conf
[global]
# reporter_id=
3. Restart virt-who service and check
log
4. Enable and configure "reporter_id"
value to null, such as:
# vi /etc/virt-who.conf
Expected Result
Refer to Bug 1523067 
also can configure virt-who by /etc/sysconfig/virt-who
virt-who restart normally and report mappings using the default "HOSTNAME-
MACHINEID" as "reporter_id" with reminder info:
"[global]: Value for "reporter_id" not set, using default:
dhcp-128-33.nay.redhat.com-704cfae1bd274ed8acd6a5e05045d24b"
[global]
reporter_id=
5. Restart virt-who service
6. Enable and configure "reporter_id"
value without non-ASCII, such as:
# vi /etc/virt-who.conf
[global]
reporter_id=xxxxxx
7. Restart virt-who service and check
log
8. Enable and configure "reporter_id"
value with non-ASCII, such as:
# vi /etc/virt-who.conf
[global]
reporter_id=??©¥®ðπ?
9. Restart virt-who service and check
log
virt-who restart normally and report mappings using the default "HOSTNAME-
MACHINEID", such as:
"Using
reporter_id='dhcp-128-33.nay.redhat.com-704cfae1bd274ed8acd6a5e05045d24b'"
***Bug 1523067 , still use the null value.
virt-who restart normally and report mappings using "xxxxxx" as reporter_id, such
as:
"Using reporter_id='xxxxxx'"
virt-who restart normally and report mappings using "??©¥®ðπ?" as reporter_id,
such as:
"Using reporter_id='??©¥®ðπ?'"
RHEL-114170 - 1094 - Check global option - "debug" in /etc/virt-who.conf
Step
Expected Result
 ***for all hypervisors
NOTE: will print debug info to rhsm log
with any debug option enabled by /etc/virt-
who.conf or /etc/sysconfig/virt-who or CLI.
1. Disable all options in /etc/sysconfig/virt-
who and /etc/virt-who.conf
2. Configure virt-who run in any mode,
such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
3. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
also can configure virt-who by
/etc/sysconfig/virt-who
restart virt-who and send mapping
normally without debug info
4. Enable [global] option and configure
"debug" value to null, such as:
[global]
debug=
5. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
6. Enable [global] option and configure
"debug" value to False, such as:
[global]
debug=False
7. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
8. Enable [global] option and configure
"debug" value to True, such as:
[global]
debug=True
9. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
restart virt-who and report mapping
normally without debug info
restart virt-who and report mapping
normally without debug info
restart virt-who and report mapping
normally with debug info.
RHEL-114171 - 1095 - Check global option - "oneshot" in /etc/virt-who.conf
Step
Expected Result
 ***for all hypervisors
NOTE: virt-who will only run once when
any one interval option is enabled by
/etc/virt-who.conf or /etc/sysconfig/virt-who
or CLI.
1. Disable all options in /etc/sysconfig/virt-
who.
2. Configure virt-who run in any mode,
such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
3. Enable [global] option with "oneshot"
option disabled, such as:
[global]
debug=True
#oneshot=False
4. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
virt-who restart and send mapping
normally by each 3600s with warning info:
"[global]: Value for "oneshot" not set, using
default: False"
5. Configure "oneshot" option value to null,
such as:
[global]
debug=True
interval=60
oneshot=
6. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
virt-who restart and send mapping
normally by each 60s without warning info
- "[global]: Value for "oneshot" not set,
using default: False"
7. Configure "oneshot" option value to
False, such as:
[global]
debug=True
interval=60
oneshot= False
8. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
virt-who restart and send mapping
normally by each 60s without warning info-
"[global]: Value for "oneshot" not set, using
default: False"
9. Configure "oneshot" option value to null,
such as:
[global]
debug=True
oneshot= True
10. Restart virt-who service and check
rhsm log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
# systemctl status virt-who
# ps -ef |grep virt-who
virt-who will only send mapping once with
reminder info: "Thread 'xxx' stopped after
running once", process has been killed.
***Bug 1448821  existing for hyperv and
rhevm, no the reminder info.
RHEL-114172 - 1096 - Check global option - "log_per_config" in /etc/virt-who.conf
Step
Expected Result
 ***for all hypervisor
NOTE: "log_per_config=", use to write a separate log file per
configuration in the config directory.
1. Configure virt-who run in two or more hypervisor modes by Configure two different hypervisors report to
/etc/virt-who.d/, such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
[stage-hyperv]
type=hyperv
owner=Default_Organization
env=Library
server=10.73.5.236
username=Administrator
password=Welcome1
rhsm_hostname=bootp-73-3-167.eng.pek2.redhat.com
rhsm_port=443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=admin
2. Enable [global] option and configure "log_per_config"
option disabled, such as:
# vi /etc/virt-who.conf
[global]
# log_per_config=
3. Remove all log file before tesing
# rm -rf /var/log/rhsm/*
4. Restart virt-who service and check log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
5. Check /var/log/rhsm/
#ls /var/log/rhsm/
rhsm.log
6. Enable [global] option and configure "log_per_config"
option to False, such as:
# vi /etc/virt-who.conf
[global]
log_per_config=False
7. Restart virt-who service and check rhsm log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
8. Check /var/log/rhsm/
#ls /var/log/rhsm/
rhsm.log
9. Enable [global] option and configure "log_per_config"
different [virtwho.destination].
virt-who restart and report mapping normally
with reminder info:
"[global]: Value for "log_per_config" not set,
using default: False"
only the rhsm.log
virt-who restart and report mapping normally,
but no the reminder info show - 
"[global]: Value for "log_per_config" not set,
using default: False".
still only the rhsm.log and rhsmcertd.log
option to True, such as:
# vi /etc/virt-who.conf
[global]
log_per_config=True
10. Restart virt-who service and check log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
11. Check /var/log/rhsm/
#ls /var/log/rhsm/
rhsm.log 
virtwho.destination_-3922809058255318456.log 
virtwho.destination_-7426371236027194430.log 
virtwho.main.log  virtwho.rhsm_log.log
12. Check the rhsm.log
# tail -f /var/log/rhsm/rhsm.log
13. Check the
virtwho.destination_-3922809058255318456.log
# tail -f
/var/log/rhsm/virtwho.destination_-3922809058255318456.log
14. Check the
virtwho.destination_-7426371236027194430.log
# tail -f
/var/log/rhsm/virtwho.destination_-7426371236027194430.log
15. Check the virtwho.main.log
# tail -f /var/log/rhsm/virtwho.main.log
16. Check the virtwho.rhsm_log.log
# tail -f /var/log/rhsm/virtwho.rhsm_log.log
virt-who restart and report mapping normally,
but no the reminder info "[global]: Value for
"log_per_config" not set, using default:
False".
***Bug 1554258 for rhel6.10
separate log file per configuration
only the [rhsm.https DEBUG],
[rhsm.connection INFO] and
[rhsm.connection DEBUG] info.
only the
[virtwho.destination_-3922809058255318456]
log info with mapping messages.
only the
[virtwho.destination_-7426371236027194430]
log info with mapping messages.
only the [virtwho.main DEBUG]
and [virtwho.main INFO] log info
only the [virtwho.rhsm_log WARNING],
[virtwho.rhsm_log DEBUG] and
[virtwho.rhsm_log INFO].
RHEL-114173 - 1097 - Check global option - "log_dir" in /etc/virt-who.conf
Expected Result
Refer to Bug 1523548,
also can configure virt-who by
/etc/sysconfig/virt-who
Step
 ***for all hypervisor
NOTE: "log_dir=": configure the absolute
path of the directory to write logs to, the
default is /var/log/rhsm/
1. Configure virt-who run in any mode by
/etc/virt-who.d/, such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator
2. Enable [global] option and configure
"log_dir"
option disabled, such as:
# vi /etc/virt-who.conf
[global]
# log_dir=
3. Restart virt-who service and check
rhsm log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
4. Enable and configure "log_dir="
option value to null, such as:
# vi /etc/virt-who.conf
[global]
log_dir=
5. Restart virt-who service and check
rhsm log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
6. Enable and configure "log_dir=/root/"
such as:
# vi /etc/virt-who.conf
[global]
log_dir=/root/
7. Restart virt-who service and check
rhsm log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
8. Check # tail -f /root/rhsm.log
virt-who restart and report mapping normally
with reminder info:
"[global]: Value for "log_dir" not set, using
default: /var/log/rhsm"
- all the log info still is in
/var/log/rhsm/rhsm.log
virt-who restart and report mapping normally
with reminder info:
"[global]: log_dir cannot be empty, using
default"
- all the log info still is in
/var/log/rhsm/rhsm.log
- virt-who restart and report mapping
normally without any reminder info about
"log_dir" is not set
- only rhsm related info is  printed to
/var/log/rhsm/rhsm.log, no any virtwho
message
***Bug 1554258 for rhel6.10
will show all other virtwho log info, such as:
[virtwho.init INFO/DEBUG]
[virtwho.stage-hyperv DEBUG]
[virtwho.destination_-6163071036687252851
DEBUG]
RHEL-114174 - 1098 - Check global option - "log_file" in /etc/virt-who.conf
Step
***for all hypervisors
NOTE: log_file: The file name to write
logs to (used only if
Expected Result
Refer to Bug 1523548
log_per_config=False)
1. Configure virt-who run in any mode by
/etc/virt-who.d/, such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
2. Enable [global] option and configure
"log_file"
option disabled, such as:
# vi /etc/virt-who.conf
[global]
# log_file=
3. Restart virt-who service and check log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
4. Enable and configure "log_file" value
to null
# vi /etc/virt-who.conf
[global]
log_file=
5. Restart virt-who service and check log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
6. Enable and configure "log_file" value
without non-ascii.
# vi /etc/virt-who.conf
[global]
log_file=virtwho.log
7. Restart virt-who service and check log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
8. Check # tail -f
/var/log/rhsm/test_rhsm.log
9. Enable and configure "log_file" value
can configure virt-who by /etc/sysconfig/virt-
who
virt-who restart and report mappings
normally with reminder info:
"[global]: Value for "log_file" not set, using
default: rhsm.log"
virt-who restart and report mappings
normally with reminder info:
"[global]: log_file cannot be empty, using
default"
- virt-who restart and report mapping
normally without any reminder info about
"log_file" is not set
- only rhsm related info is  printed to
/var/log/rhsm/rhsm.log, virtwho log is printed
to /var/log/rhsm/virtwho.log
***Bug 1554258 for rhel6.10
will show all other virtwho log info, such as:
[virtwho.init INFO/DEBUG]
[virtwho.stage-hyperv DEBUG]
[virtwho.destination_-6163071036687252851
DEBUG]
without non-ascii.
# vi /etc/virt-who.conf
[global]
log_file=??©¥®ðπ?
10. Restart virt-who service and check
log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
11. Check # tail -f /var/log/rhsm/??
©¥®ðπ?
- virt-who restart and report mapping
normally without any reminder info about
"log_file" is not set
- only [rhsm.commection] and
[virtwho.config] log info are printed to
/var/log/rhsm/rhsm.log, virtwho log is printed
to /var/log/rhsm/??©¥®ðπ?
will show all other virtwho log info, such as:
[virtwho.init INFO/DEBUG]
[virtwho.stage-hyperv DEBUG]
[virtwho.destination_-6163071036687252851
DEBUG]
RHEL-114175 - 1099 - Check global option - "configs" in /etc/virt-who.conf
Step
Expected Result
 ***for all hypervisor
NOTE: "configs=": a list of files containing
configurations for virt-who.
1. Configure virt-who run in any mode by
/etc/virt-who.d/, such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
2. Enable [lglobal] option and configure
"configs=" option disabled, such as:
# vi /etc/virt-who.conf
[global]
# configs=
3. Restart virt-who and check rhsm log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
4. Enable and configure "configs=" value
to null, such as:
# vi /etc/virt-who.conf
[global]
configs=
also can configure virt-who by
/etc/sysconfig/virt-who.
virt-who restart and report [sat-esx]
mapping normally with reminder info -
"[global]: Value for "configs" not set, using
default: []"
??? no reminder info, need report bug???
5. Restart virt-who and check rhsm log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
6. Enable and configure "configs=" value
to wrong "xxx", such as:
# vi /etc/virt-who.conf
[global]
configs=xxx
7. Restart virt-who and check rhsm log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
virt-who start and report [sat-esx] mapping
normally with reminder error info -
"Unable to read configuration file xxx"
8. Create a valid configuration not in
/etc/virt-who.d/, such as:
# vi /root/hyperv.conf
[stage-hyperv]
type=hyperv
owner=11373231
env=11373231
server=10.73.5.236
username=Administrator
password=Welcome1
9. Enable and configure "configs=" to an
valid config, such as:
# vi /etc/virt-who.conf
[global]
configs=/root/hyperv.conf
10. Restart virt-who and check rhsm log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
virt-who restart normally and succeed to
send all the configurations under /etc/virt-
who.d/, /etc/sysconfig/virt-who and the
/root/hyperv.conf
RHEL-114354 - 1100 - Check section header option - "[defaults]" in /etc/virt-who.conf
Step
Expected Result
***not for local libvirt and vdsm mode
1. Configure virt-who run in any hypervisor
mode with owner and env disabled, such
as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
#owner=Default_Organization
#env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
2. Disable [default] header option in
/etc/virt-who.conf with available owner and
env, such as:
# grep -E -v '(^#|^$)' /etc/virt-who.conf
#[defaults]
owner=Default_Organization
env=Library
3. Restart virt-who and check rhsm log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
4. Enable [default] header option in
/etc/virt-who.conf, such as:
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[defaults]
owner=Default_Organization
env=Library
5. Restart virt-who and check rhsm log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
virt-who restart normally but failed to send
mapping with error:
"KeyError: 'owner not in stage-hyperv'"
NOTE: the options will not take effect with
[defaults] header disabled.
virt-who restart and report mapping
normally.
RHEL-113049 - 1101 - Check default option - "owner" in /etc/virt-who.conf
Step
Expected Result
***Not for Local_Libvirt, VDSM
Refer to Bug 1516173
1. Keep all options disabled in /etc/virt-
who.conf.
2. Configure virt-who run in any hypervisor
mode with owner disabled, such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
3. Restart virt-who service
# systemctl restart virt-who
4. Configure available owner in /etc/virt-
who.conf and disable owner option in
/etc/virt-who.d/xxx.conf, such as:
# vi /etc/virt-who.conf
[defaults]
owner=Default_Organization
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
report mappings normally
virt-who should succeed to send mapping
NOTE: the owner configured in /etc/virt-
who.conf can be used for /etc/virt-
who.d/x.conf.
virt-who service should be started normally
and fail to send mapping with error:
"ManagerError: Communication with
subscription manager failed with code
415:"
***Bug 1516173 for satellite, report
successfully.
start virt-who normally, but failed to send
mapping with reminder info -
- For Satellite6:
"ManagerError: Cannot send data to:
Default_Organization, because owner from
configuration: xxxxxx is different”"
-For Stage Candlepin:
"ManagerError: Communication with
subscription
manager failed with code 404:
Organization with id
xxxxxx could not be found"
#owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
5. Restart virt-who service
# systemctl restart virt-who
6. Set owner value to null in /etc/virt-
who.conf, such as:
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[defaults]
owner=
7. Restart virt-who service
# systemctl restart virt-who
8. Set owner to wrong in /etc/virt-who.conf,
such as
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[defaults]
owner=xxxxxx
9. Restart virt-who service
# systemctl restart virt-who
10. Set available owner in /etc/virt-
who.conf and wrong owner in /etc/virt-
who.d/xxx.conf, such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=xxxxxx
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[defaults]
owner=Default_Organization
11. Restart virt-who service
# systemctl restart virt-who
start virt-who normally, but failed to send
mapping with reminder info -
- For Satellite6:
"ManagerError: Cannot send data to:
Default_Organization, because owner from
configuration: xxxxxx is different”"
-For Stage Candlepin:
"ManagerError: Communication with
subscription
manager failed with code 404:
Organization with id
xxxxxx could not be found"
NOTE: the owner option configured in
/etc/virt-who.d/x.conf is higher than in
/etc/virt-who.conf
RHEL-114355 - 1102 - Check default option - "env" in /etc/virt-who.conf
Step
Expected Result
***Not for Local_Libvirt, VDSM
1. Keep all options in /etc/virt-who.conf
disabled.
2. Configure virt-who run in any hypervisor
mode with env disabled, such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
3. Restart virt-who service
# systemctl restart virt-who
4. Configure available env in /etc/virt-
who.conf and disable env option in
/etc/virt-who.d/xxx.conf, such as:
# vi /etc/virt-who.conf
[defaults]
env=Library
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
#env=Library
report mappings normally
virt-who should succeed to send mapping
NOTE: the env configured in /etc/virt-
who.conf can be used for /etc/virt-
who.d/x.conf
start virt-who normally, but failed to send
the mapping with reminder info -
"ManagerError: Communication with
subscription manager failed with code
415:"
***Bug 1530290 for all, still send mapping
out
start virt-who normally, but failed to send
mapping with reminder info -
for satellite62: "ManagerError: Cannot
send data to: Default_Organization,
because Satellite env: Library differs from
configuration: xxxx"
***Bug 1530426 for stage, also send out
mapping
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
5. Restart virt-who service
# systemctl restart virt-who
6. Set env value to null in /etc/virt-
who.conf, such as:
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[defaults]
env=
7. Restart virt-who service
# systemctl restart virt-who
8. Set env to wrong in /etc/virt-who.conf,
such as
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[defaults]
env=xxxxxx
9. Restart virt-who service
# systemctl restart virt-who
10. Set available env in /etc/virt-who.conf
and wrong owner in /etc/virt-
who.d/xxx.conf, such as:
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=xxxxxx
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[defaults]
env=Library
11. Restart virt-who service
# systemctl restart virt-who
start virt-who normally, but failed to send
mapping with reminder info -
for satellite62: "ManagerError: Cannot
send data to: Default_Organization,
because Satellite env: Library differs from
configuration: xxxx"
***Bug 1530426 for stage, also send out
mapping
NOTE: the env options configured in
/etc/virt-who.d/x.conf is higher than in
/etc/virt-who.conf
RHEL-113050 - 1103 - Check default option - "hypervisor_id" in /etc/virt-who.conf
Step
Expected Result
***not for Local_Libvirt and VDSM
1. Configure virt-who run in any mode in
/etc/virt-who.d/
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
2. Restart virt-who service
# systemctl restart virt-who
virt-who should send mapping with:
"hypervisorId": "uuid"
3. Set "hypervisor_id=uuid" in /etc/virt-
who.conf
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[defaults]
hypervisor_id=uuid
4. Restart virt-who service
# systemctl restart virt-who
virt-who should send mapping with:
"hypervisorId": "uuid"
5. Set "hypervisor_id=hostname" in
/etc/virt-who.conf
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[defaults]
hypervisor_id=hostname
6. Restart virt-who service
# systemctl restart virt-who
7. Set "hypervisor_id=hwuuid" in /etc/virt-
who.conf
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[defaults]
hypervisor_id=hwuuid
virt-who should send mapping with:
"hypervisorId": "hostname"
just for ESX and RHEVM mode
8. Restart virt-who service
# systemctl restart virt-who
virt-who should send mapping with:
"hypervisorId": "hwuuid"
9. Set "hypervisor_id=hostname" in
/etc/virt-who.conf and "hypervisor_id=uuid"
in /etc/virt-who.d/x.conf
# grep -E -v '(^#|^$)' /etc/virt-who.conf
[defaults]
hypervisor_id=hostname
# vi /etc/virt-who.d/esx.conf
[sat-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
hypervisor_id=uuid
10. Restart virt-who service
# systemctl restart virt-who
virt-who should send mapping with:
"hypervisorId": "uuid"
NOTE: the hypervisor_id option
cofigured in /etc/virt-who.d/x.conf is
higher than /etc/virt-who.conf
RHEL-113447 - 1104 - Check [config_name] option by /etc/virt-who.d/ config file
Step
Expected Result
***Not for Local_Libvirt
Refer to Bug 1506869
1. Create a config file with available
options, such as:
[stage-esx]
type=esx
owner=11373231
env=11373231
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
2. Restart virt-who service and check
rhsm.log
# systemctl restart virt-who
3. Only create a config file with
[config_name] option disabled, such as:
#[stage-esx]
type=esx
owner=11373231
env=11373231
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
virt-who start normally and send mapping
successfully.
4. Restart virt-who service and check
rhsm.log
- failed to start virt-who with reminder info:
"Configuration file /etc/virt-who.d/xen.conf
contains no section headers" in rhsm log.
***Bug 1516120 existing, virt-who start
normally.
- virt-who should not run the local libvirt
mode.
***Bug 1506869 existing, run local libvirt.
virt-who start normally,  succeed to report
the valid one, and fail to send the bad one
with reminder info "Configuration file
/etc/virt-who.d/xen.conf contains no
section headers".
- failed to start virt-who with reminder info:
"Configuration file /etc/virt-who.d/xen.conf
contains no section headers" in rhsm log
and "no suitable backend
configuration can be found" by the
command "# systemctl restart virt-who"
***Bug 1516120 existing, virt-who start
normally.
- virt-who should not run the local libvirt
mode.
***Bug 1506869 existing, run local libvirt.
virt-who start normally,  succeed to report
the valid one, and fail to send the bad one
with reminder info "Configuration file
/etc/virt-who.d/xen.conf contains no
section headers".
# systemctl restart virt-who
# systemctl restart virt-who
5. Configure another valid configuration,
then restart virt-who service.
6. Only create a config file with
[config_name] value is null, such as:
[]
type=esx
owner=11373231
env=11373231
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
7. Restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# systemctl restart virt-who
8. Configure another valid configuration,
then restart virt-who service.
9. Only create a config file with
[config_name] value is one space, such
as:
[ ]
type=esx
owner=11373231
env=11373231
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
10. Restart virt-who service and check
rhsm.log
# systemctl restart virt-who
- failed to start virt-who with reminder info:
"Configuration file /etc/virt-who.d/xen.conf
contains no section headers" in rhsm log
# systemctl restart virt-who
11. Configure another valid configuration,
then restart virt-who service.
12. Only configure the [config_name] value
with non-ASCii, such as:
[??©¥®ðπ?]
type=esx
owner=11373231
env=11373231
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
13. Restart virt-who service and check
rhsm.log
# systemctl restart virt-who
and "no suitable backend
configuration can be found" by the
command "# systemctl restart virt-who"
***Bug 1516120 existing, virt-who start and
send mapping normally using the space as
name.
- virt-who should not run the local libvirt
mode.
virt-who start normally, succeed to report
the valid one and fail to send the bad one
with reminder info "Configuration file
/etc/virt-who.d/xen.conf contains no
section headers".
***Bug 1516120 existing, virt-who start and
send mapping normally using the space as
name.
virt-who start normally and send mapping
successfully.
RHEL-113339 - 1105 - Check type option by /etc/virt-who.d/ config file
Step
***not for local KVM
Expected Result
Refer to Bug 1506893 
1. Create a config file with available
options, such as:
[stage-esx]
type=esx
owner=11373231
env=11373231
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
2. Restart virt-who service and check
rhsm.log
# systemctl restart virt-who
3. Only create a config file with type option
disabled, such as:
[stage-esx]
virt-who start normally and send mapping
successfully.
#type=esx
owner=11373231
env=11373231
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
4. Restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# systemctl status virt-who
5. Configure another valid configuration,
then restart virt-who service.
6. Only create a config file with type value
is null, such as:
[stage-esx]
type=
owner=11373231
env=11373231
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
7. Restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# systemctl status virt-who
8. Configure another valid configuration,
then restart virt-who service.
9. Create a config file with type value is
wrong without non-ASCII, such as:
[stage-esx]
type=xxxx
owner=11373231
env=11373231
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
- fail to start virt-who with reminder info -
"No valid configurations found'" in
rhsm.log
***Bug 1506893 existing,virt-who still
running.
virt-who should be started normally,
succeed to report the valid one, and failed
to send the bad one with reminder info -
"Value for "type" not set, using default:
libvirt" and "no connection driver available
for 10.73.3.166"
-fail to start virt-who with reminder info,
such as:
"Dropping invalid configuration "stage-
esx"" and several messages about
ignoring unknown configuration options in
the conf file.
- should not run default local libvirt mode
start virt-who normally, succeed to report
the valid one, and failed to send the bad
one with reminder info like step7.
10. Restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# systemctl status virt-who
-fail to start virt-who with reminder info,
such as:
"Dropping invalid configuration "stage-
esx"" and several messages about
11. Configure another valid configuration,
then restart virt-who service.
12. Create a config file with type value is
wrong without non-ASCII, such as:
[stage-esx]
type=??©¥®ðπ?
owner=11373231
env=11373231
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
13. Restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# systemctl status virt-who
14. Configure another valid configuration,
then restart virt-who service.
ignoring unknown configuration options in
the conf file.
- should not run default local libvirt mode
start virt-who normally, succeed to report
the valid one, and failed to send the bad
one with reminder info like step10. 
-fail to start virt-who with reminder info,
such as:
"Dropping invalid configuration "stage-
esx"" and several messages about
ignoring unknown configuration options in
the conf file.
- should not run default local libvirt mode 
start virt-who normally, succeed to report
the valid one, and failed to send the bad
one with reminder info like step13.  
RHEL-113340 - 1106 - Check --[virt-who type]-server option by CLI
Step
***Not for Local_Libvirt
1. Stop virt-who service
# systemctl stop virt-who
2. Run virt-who by CLI with available
options, such as:
#virt-who --esx --esx-owner=11343171 --
esx-env=11343171 --esx-
server=10.73.3.166 --esx-
username="Administrator@vsphere.local"
--esx-password='Welcome1!' -d
3. Run virt-who without "--[virt-who type]-
server" option, such as:
# virt-who --esx --esx-owner=11343171 --
esx-env=11343171 --esx-
username="Administrator@vsphere.local"
--esx-password='Welcome1!' -d
Expected Result
Bug 1530562 
virt-who should start normally and send
mapping successfully.
fail to start virt-who with error info:
"Required command line argument: --esx-
server is not set."
for remote libvirt: will run the local libvirt
4. Run virt-who with "--[virt-who type]-
server" value is null, such as:
fail to start virt-who with error info:
"Required command line argument: --esx-
# virt-who --esx --esx-owner=11343171 --
esx-env=11343171 --esx-server= --esx-
username="Administrator@vsphere.local"
--esx-password='Welcome1!' -d
5. Run virt-who with "--[virt-who type]-
server" value is wrong, such as:
# virt-who --esx --esx-owner=11343171 --
esx-env=11343171 --esx-server=xxxxxx --
esx-
username="Administrator@vsphere.local"
--esx-password='Welcome1!' -d
server is not set."
for remote libvirt: will run the local libvirt
start virt-who normally with error info:
"Thread 'env/cmdline' fails with error:
('Connection aborted.', gaierror(-2, 'Name
or service not known'))"
RHEL-113341 - 1107 - Check virt-who "VIRTWHO_TYPE_SERVER" option by
/etc/sysconfig/virt-who
Step
***Not for Local_Libvirt, VDSM
Expected Result
Refer to Bug 1512778 Bug
1530562
1. Configure virt-who by /etc/sysconfig/virt-who with all
available options, such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=11343171
VIRTWHO_ESX_ENV=11343171
VIRTWHO_ESX_SERVER=10.73.3.166
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_PASSWORD=Welcome1!
2. Restart virt-who service and check rhsm log
# systemctl restart virt-who
virt-who start normally and
send mapping successfully
3. Only configure virt-who by /etc/sysconfig/virt-who with
server option disabled, such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=11343171
VIRTWHO_ESX_ENV=11343171
#VIRTWHO_ESX_SERVER=10.73.3.166
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_PASSWORD=Welcome1!
4. Restart virt-who service and check rhsm log
# systemctl restart virt-who
# systemctl status virt-who
# ps -ef |grep virt-who
- fail to start virt-who with
reminder info:
"'VIRTWHO_ESX_SERVER'
is not set"
- virt-who is not runing and
no process exists.
***Bug 1516209 [comment5]
existing for remote libvirt,
can start virt-who.
***Bug 1530557 for
esx/xen/hyperv/rhevm,
wrong reminder info
start virt-who normally,
succeed to send the valid
one, but fail to run the bad
one with reminder info -
"'VIRTWHO_ESX_SERVER'
is not set"
- for remote libivrt, will run
the default local libvirt [Bug
1530562 closed as notabug]
***Bug 1530557 for
esx/xen/hyperv/rhevm,
wrong reminder info
fail to start virt-who with
reminder info -
"'VIRTWHO_ESX_SERVER'
is not set"
- virt-who is not runing and
no process exists.
***Bug 1516209 [comment5]
existing for remote libvirt,
can start virt-who.
***Bug 1530557 for
esx/xen/hyperv/rhevm,
wrong reminder info
start virt-who normally,
succeed to send the valid
one, but fail to run the bad
one with reminder info -
"'VIRTWHO_ESX_SERVER'
is not set"
- for remote libivrt, will run
the default local libvirt [Bug
1530562 closed as notabug]
***Bug 1530557 for
esx/xen/hyperv/rhevm,
wrong reminder info
5. Create any one valid configuration by /etc/virt-
who.d/xxx.conf, then restart virt-who service.
6. Only configure virt-who by /etc/sysconfig/virt-who with
server option value is null, such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=11343171
VIRTWHO_ESX_ENV=11343171
VIRTWHO_ESX_SERVER=
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_PASSWORD=Welcome1!
7. Restart virt-who service and check rhsm log
# systemctl restart virt-who
# systemctl status virt-who
# ps -ef |grep virt-who
8. Create any one valid configuration by /etc/virt-
who.d/xxx.conf, then restart virt-who service.
9. Only configure virt-who by /etc/sysconfig/virt-who with
server option value is wrong without non-ASCII, such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=11343171
VIRTWHO_ESX_ENV=11343171
VIRTWHO_ESX_SERVER=xxx
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_PASSWORD=Welcome1!
10. Restart virt-who service and check rhsm log
# systemctl restart virt-who
11. Create any one valid configuration by /etc/virt-
who.d/xxx.conf, then restart virt-who service.
12. Only configure virt-who by /etc/sysconfig/virt-who with
server option value is wrong with non-ASCII, such as:
VIRTWHO_ESX=1
VIRTWHO_ESX_OWNER=11343171
VIRTWHO_ESX_ENV=11343171
VIRTWHO_ESX_SERVER=??©¥®ðπ?
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_PASSWORD=Welcome1!
13. Restart virt-who service and check rhsm log
# systemctl restart virt-who
14. Create any one valid configuration by /etc/virt-
who.d/xxx.conf, then restart virt-who service.
start virt-who normally with
reminder info -
"Thread 'env/cmdline' fails
with error: ('Connection
aborted.', gaierror(-2, 'Name
or service not known'))"
start virt-who normally,
succeed to send the valid
one, failed to send the bad
one with reminder info -
"Thread 'env/cmdline' fails
with error: ('Connection
aborted.', gaierror(-2, 'Name
or service not known'))"
start virt-who normally with
reminder info -
- for xen/esx/hyperv/rhevm:
"Thread 'env/cmdline' fails
with error: ('Connection
aborted.', gaierror(-2, 'Name
or service not known'))"
- for remote libvirt:
"internal error: Unable to
parse URI
qemu+ssh://root@??
©¥®ðπ?/system?no_tty=1"
start virt-who normally,
succeed to send the valid
one, failed to send the bad
one with reminder info like
above step13
RHEL-113342 - 1108 - Check virt-who "server" option by /etc/virt-who.d config file
Step
Expected Result
***Not for Local_Libvirt, VDSM
Refer to Bug 1530562
1. Create a config file with all available
value in /etc/virt-who.d/, such as:
# vi /etc/virt-who.d/esx.conf
[stage-esx]
type=esx
owner=11373231
env=11373231
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
2. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
3. Only create a config file with server
option disabled in /etc/virt-who.d/, such as:
# vi /etc/virt-who.d/esx.conf
[stage-esx]
type=esx
owner=11373231
env=11373231
# server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
4. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# systemctl status virt-who
# ps -ef | grep virt-who
5. Create any another valid configuration
then restart virt-who service.
6. Only create a config file with server
value  is null in /etc/virt-who.d/, such as:
# vi /etc/virt-who.d/esx.conf
[stage-esx]
type=esx
owner=11373231
env=11373231
server=
username=Administrator@vsphere.local
password=Welcome1!
virt-who start normally and send mapping
successfully
- failed to start virt-who with reminder info -
"[sat-esx]: Required option: "server" not
set." and "virt-who can't be started: no
valid configuration found"
- virt-who is not runing and no process
exists.
***Bug 1516209 [comment5] existing for
remote libvirt, can start virt-who.
virt-who should start normally, succeed to
send the available hypervisor, but fail to
run the bad one with reminder info:
"[sat-esx]: Required option: "server" not
set."
- for remote libivrt, will run the default local
libvirt [Bug 1530562 closed as notabug]
7. Restart virt-who service and check rhsm
log
# systemctl restart virt-who
# systemctl restart virt-who
# ps -ef |grep virt-who
failed to start virt-who with reminder info-
"Required option: "server" is missing in:
"sat-rhevm"" and "virt-who can't be started:
no valid configuration found"
- virt-who is not runing and no process
8. Create any another valid configuration
then restart virt-who service.
9. Only create a config file with server
value  is wrong without non-ASCII in
/etc/virt-who.d/, such as:
# vi /etc/virt-who.d/esx.conf
[stage-esx]
type=esx
owner=11373231
env=11373231
server=xxxx
username=Administrator@vsphere.local
password=Welcome1!
10. Restart virt-who service and check
rhsm log
# systemctl restart virt-who
11. Create any another valid configuration
then restart virt-who service.
12. Only create a config file with server
value  is wrong with non-ASCII in /etc/virt-
who.d/, such as:
# vi /etc/virt-who.d/esx.conf
[stage-esx]
type=esx
owner=11373231
env=11373231
server=??©¥®ðπ?
username=Administrator@vsphere.local
password=Welcome1!
13. Restart virt-who service and check
rhsm log
# systemctl restart virt-who
exists.
***Bug 1516209 existing for all, virt-who
still can be started
start virt-who normally, succeed to report
the valid one, but fail to run the bad with
reminder info, such as -
"Thread 'sat-rhevm' fails with error: Unable
to connect to RHEV-M server: Invalid URL
u'https://:8443/api': No host supplied"
start virt-who normally but fail to get
mapping with error:
" Thread 'stage-esx' fails with error:
('Connection aborted.', gaierror(-2, 'Name
or service not known'))"
start virt-who normally, succeed to report
the valid one, but fail to run the bad one
with reminder info, such as:
" Thread 'stage-esx' fails with error:
('Connection aborted.', gaierror(-2, 'Name
or service not known'))"
start virt-who normally but fail to get
mapping with error:
- for xen/hyperv/esx/rhevm:
" Thread 'stage-esx' fails with error:
('Connection aborted.', gaierror(-2, 'Name
or service not known'))"
- for remote libvirt:
"internal error: Unable to parse URI
14. Create any another valid configuration
then restart virt-who service.
qemu+ssh://root@??
©¥®ðπ?/system?no_tty=1"
start virt-who normally, succeed to report
the valid one, but fail to run the bad one
with reminder info, such as:
" Thread 'stage-esx' fails with error:
('Connection aborted.', gaierror(-2, 'Name
or service not known'))"
2 . Virt-who VM Manager cases
RHEL7-53860 - 2001-No any hosts on Vcenter/RHEVM
Step
Expected Result
***Only for ESX, RHEVM
Refer to BZ 1409984 BZ 1452436
1. make sure there is no any hosts on
Vcenter or RHEVM
1. make sure there is no any hosts on
Vcenter or RHEVM
2. check rhsm.log
It should show log like - "Hosts-to-guests
mapping for config "xxx": 0 hypervisors and 0
guests found"
- for RHEVM, log as following:
2017-07-31 14:58:01,283 [virtwho.sat-rhevm
INFO] MainProcess(22534):Thread-2
@virt.py:_send_data:912 - Report for config
"sat-rhevm" gathered, placing in datastore
2017-07-31 14:58:01,652
[virtwho.destination_-6765871383904734538
INFO] MainProcess(22534):Thread-3
@virt.py:_send_data:590 - Hosts-to-guests
mapping for config "sat-rhevm": 0
hypervisors and 0 guests found
***Bug BZ 1409984 existing for esx, failed
get mapping with null host.
RHEL7-53861 - 2002-Add a new host to Vcenter/RHEVM
Step
Expected Result
***Only for ESX, RHEVM
Refer to BZ 1392704 BZ 1400431
1. add a new host to Vcenter or RHEVM
2. check rhsm.log
the new host uuid should be found from
rhsm.log and Host/Guest mapping info can
3. check the host uuid by web UI.
be got and sent to server without error.
the host uuid should be found by web ui
and the uuid is the same as rhsm.log
RHEL7-53862 - 2003-Delete a host from Vcenter/RHEVM
Step
Expected Result
1. delete a host from Vcenter or RHEVM
***Only for ESX, RHEVM
2. check rhsm.log
3. check the host uuid by web UI.
the host uuid should be removed from
rhsm.log
the host uuid should be removed from web
ui
RHEL7-53863 - 2004-No any guests on host or hypervisors
Step
***For all hypervisor
1. make sure there is no any guests on
host or hypervisors
2. check rhsm.log
Expected Result
shouldn't  show any guest uuid for the
hosts or hypervisor.
it should be [  ] for  vdsm  and kvm,  show 
{ } for esx, hyper-v, rhevm.
RHEL7-53864 - 2005-Add a guest and then reboot host such as libvirt / vdsm / vcenter /
rhevm / hyperv
Step
***For all hypervisor
Expected Result
Refer to BZ 1231602 BZ 1247866 BZ
1415050
the new guest uuid should be found from
host/guests mapping info and no any error
info found
1. add a new guest  to host or hypervisors
2. power on the guest
3. check rhsm.log
4. make sure the host or hypervisors
subscribe to a physical pool which can
create a bonus pool
5. make sure the guest registered,  and
subscribed to the bonus pool
6. reboot  following remote host,
if libvirt mode, restart libvirtd service
if vdsm mode, restart vdsm service
if esx mode, reboot vcenter server
if rhevm mode, reboot rhevm server
if hyperv mode, reboot hyperv server
7. check the rhsm.log after reboot
8. check the host and guest subscription
status, such as:
# subscription-manager list --co
after reboot successfully, the hosts/guests
mapping info should be found normally
(needn't wait for over 15min) and no error
info
if the guest is a new, need to make sure
the uuid is matched.
***Bug BZ 1415050 existing for xen and
libvirt
after reboot, the hosts/guests subscription
should not be revoked and no changes
RHEL7-85736 - 2006-Edit guest name&description with unicode words
Step
Expected Result
***For all hypervisor
Refer to BZ 1391512 BZ 1388577
1. add a new guest to host or hypervisors
without chinese words in the guest name.
2. power on the guest
3. restart virt-who service and check
rhsm.log
4. edit the guest name and description
with chinese words, eg: ???
???? _rhel7.3?
5. restart virt-who service again and check
rhsm.log
the guest uuid should be found from
host/guests mapping info normally and the
mapping info can be sent to server
succesfully.
- for libvirt: Name + Title + Description
- for esx: Name +
- for xen: Name + Description
-for rhevm/vdsm:  Name + Description , but
don't support "€€€€"
-for hyperv: Name + note
the guest uuid should also be found from
host/guests mapping info normally and no
any error fond.
eg: UnicodeEncodeError: 'ascii'
codec can't encode characters in
position 657-662: ordinal not in
range(128)
RHEL7-53865 - 2007-Delete a guest and then reboot host such as libvirt / vdsm / vcenter /
rhevm / hyperv /Xenhost
Step
***For all hypervisor
1. power off the guest
2. delete the guest  from host or
hypervisors
3. check rhsm.log
4. reboot  following remote services or
host, such as:
if libvirt mode, restart libvirtd service
if vdsm mode, restart vdsm service
if esx mode, reboot vcenter server
if rhevm mode, reboot rhevm server
if hyperv mode, reboot hyperv server
5. check the rhsm.log after reboot
Expected Result
Refer to BZ 1415050
the guest uuid should be removed from
host/guests mapping info and no any error
info found 
after reboot, the hosts/guests mapping info
should be found normally and no error info
***Bug BZ 1415050 existing for xen and
libvirt
RHEL7-53866 - 2008-Host can't reachable and then reboot vcenter / rhevm
Step
Expected Result
***Only for ESX, RHEVM
Refer to BZ 1312228
1. Register system to server
2. Configure virt-who run at esx/rhevm
mode
   restart virt-who service
3. Monitor virt-who's log, Disconnect
one esx/rhel/rhevh host
# tail -f /var/log/rhsm/rhsm.log
4. Monitor virt-who's log, Reboot /
rhevm
host/guest mapping info can send to
server
host/guest mapping info still can send to
server
host/guest mapping info still can
send to server after vcenter/rhevm
reboot successfully.
RHEL7-79903 - 2009-Check virt-who can detect the hypervisor's connection/disconnection
Step
Expected Result
***Not for Local_Libvirt, VDSM
Refer to BZ 1263512
1. Register system to server
2. Configure virt-who run at
host/guest mapping info can send to server
esx/rhevm/hyperv/xen mode and
refresh interval is 60s. then restart
virt-who service
# systemctl restart virt-who
3. In vcenter/rhevm/hyperv/xen, Set
firewall to block the connection from
virt-who's machine
4. After 60s, check virt-who's
log
5. In vcenter/rhevm/hyperv/xen,
delete the firewall to make virt-who
connect
vcenter/rhevm/hyperv/xen
normally.
6. After 60s, check virt-who's log
every 60s.
to forbidden:
iptables -I INPUT -s 10.66.144.5 -j DROP
to recovery:
iptables -D INPUT -s 10.66.144.5 -j DROP
virt-who will throw timeout error info in the
log.
"ReadTimeout:
HTTPSConnectionPool(host='10.73.2.95',
port=443): Read timed out. (read
timeout=64)"
virt-who won't generate error info and it
can throw normally info in the log.
RHEL7-79904 - 2010-Check virt-who can detect unreachable proxy
Expected Result
Refer to BZ 1265582
host/guest mapping
info can send to
server
successfully. 
Step
***Not for Local_Libvirt, VDSM
1. Register system to server
2. Configure virt-who run at esx/rhevm/hyperv/xen mode and make
virt-who connect these esx/rhevm/hyperv/xen through proxy.
# vi /etc/sysconfig/virt-who
VIRTWHO_ESX=1
http_proxy=http://10.73.3.248:3128
VIRTWHO_ESX_OWNER=7661967
VIRTWHO_ESX_ENV=7661967
VIRTWHO_ESX_SERVER=10.73.2.15
VIRTWHO_ESX_USERNAME=Administrator@vsphere.local
VIRTWHO_ESX_PASSWORD=Welcome1!
[NOTE]:
ESX,RHEVM support https_proxy=https://xxxx
HYPERV support http_proxy=http://xxxx
[Optional]:
no_proxy=satserv.redhat.com
3. In proxy machine, stop squid service.
[root@samdns ~]# service squid stop
4. restart virt-who service and check the virt-who's log 
# tail -f /var/log/rhsm/rhsm.log
5. enable "NO_PROXY=*" in /etc/sysconfig/virt-who
6. restart virt-who service and check the virt-who's log
It should show
ConnectionError
info once as the
following:
ConnectionError:
('Connection aborted.',
BadStatusLine("''",)) or
'Connection refused'
It shouldn't show
redundant DEBUG info
as the following:
"[DEBUG]
 @esx.py:105 - Wait
for ESX event finished,
timeout"
host/guest mapping
info can send to
server successfully.
it means the
"NO_PROXY=*"
can disable all
proxy set in
/etc/sysconfig/virt-
who
RHEL7-53867 - 2011-Check guest Attr such as resume/pause/poweroff/poweron
Step
***For all hypervisor
Expected Result
Refer to BZ 1353074 BZ 1415050 Bug
1458674 
1. make sure the host or hypervisors
subscribe to a pool which can create a
bonus pool
2. make sure the guest subscribe to the
bonus pool
3. make guest pause
4. check guest state from rhsm.log
if KVM, Hyper-v, ESX, the state should be
"3"
if vdsm, rhevm, xen,  when suspend, no
state, the guest will be removed from json
***Bug BZ 1415050 existing for xen, libvirt
5. make guest resume
6. check guest state from rhsm.log
check consumed bonus pool
check the host/guests mapping info and
consumed bonus pool on webUI
if  resume, all kvm, vdsm, rhevm, esx,
hyper-v, xen, the state should be "1", and
the bonus pool shouldn't be revoked
***Bug BZ 1415050 existing for xen, libvirt
7. make guest poweroff
8. check guest state from rhsm.log
check consumed bonus pool
check the host/guests mapping info and
consumed bonus pool on webUI
9. make guest poweron
if KVM, Hyper-v, ESX, the state should be
"5"
if vdsm, rhevm, xen, will be suspend, no
state, the guest will be removed from json 
***Bug BZ 1415050 existing for xen, libvirt
10. check guest state from rhsm.log
check consumed bonus pool
check the host/guests mapping info and
consumed bonus pool on webUI
if  resume, all kvm, vdsm, rhevm, esx,
hyper-v, xen, the state should be "1", and
the bonus pool shouldn't be revoked 
***Bug BZ 1415050 existing for xen, libvirt
RHEL7-53868 - 2012-Check virt-who can get name, type, hypervisorVersion, capacity from
hypervisor
Step
***For all hypervisor
Expected Result
Refer to  BZ 1110427, BZ 1321229, BZ
1240728 BZ 1440036 
1. Make sure candlepin can support "
hypervisors_async"
Prepare a host/hypervisors and
install a guest on host/hypervisor at
least.
2. Register system with virt-who to server
3. Configure virt-who run at any mode,
start virt-who service and check virt-who's
log.
-for satellite5.X, satellite6.3 and stage
candlepin, will print detail info to rhsm.log:
# tail -f /var/log/rhsm/rhsm.log
-for satellite6.1 and satellite6.2 and
sam, check detail info with -p option:
#virt-who -p -d -o
It should display hypervisor's name, type,
hypervisorVersion and
capacity(cpu.cpu_socket(s)) in the log:
Eg:
Host-to-guest mapping: {
"hypervisors": [
{
"hypervisorId": {
"hypervisorId":
"564D900A-2E82-672D-2CB7-
C17F0B3FF876"
}, 
"name": "win16-hyperv-01", 
"guestIds": [
{
"guestId": "EBBF4A99-85AD-0947-
AB31-45DD18FE96E5", 
"state": 1, 
"attributes": {
"active": 1, 
"hypervisorVersion": "10.0.10586.0", 
"virtWhoType": "hyperv", 
"hypervisorType": "hyperv"
}
}
], 
"facts": {
"cpu.cpu_socket(s)": "2"
}
}
]
}
for vdsm and local_kvm, will only show
guest info.
***Bug 1440036 for remote libvirt, should
gather "name" option
RHEL7-81396 - 2013-Check the connection built info with stage/satellite/sam from
rhsm.log
Step
Expected Result
***For all hypervisor
Refer to BZ 1401867
1. Ensure debugging is
turned on in virt-who:
$ grep
VIRTWHO_DEBUG
etc/sysconfig/virt-who
VIRTWHO_DEBUG=1
2.  Run virt-who and
check logs in
/var/log/rhsm/rhsm.log
for stage candlepin and satellite6.3:
it should show [rhsm.connection INFO] and [rhsm.connection
DEBUG] log to rhsm log, such as:
2017-08-01 13:35:38,814 [rhsm.connection DEBUG]
MainProcess(11029):Thread-3 @connection.py:_request:516
- Making request: POST
/rhsm/hypervisors?owner=Default_Organization&env=Library
2017-08-01 13:35:39,258 [rhsm.connection INFO]
MainProcess(11029):Thread-3 @connection.py:_request:552
- Response: status=200, request="POST
/rhsm/hypervisors?owner=Default_Organization&env=Library"
RHEL7-53869 - 2014-Migrate a guest to an unsubscribed host
Step
Expected Result
***For all hypervisor
Refer to BZ 1415050
1. prepare two hosts or hypervisors(host1
and host2),  and install a  guest on
host1(guest1)
2. register host1, host2, guest1
3. subscribe host/guest by CLI (if
hypervisor, subscribe by webui)
subscribe host1 to RH00050 physical pool
subscribe guest1 to RH00050 bonus pool
don't subscribe host2
4. migrate guest1 to host2
5. check rhsm.log
# tail -f /var/log/rhsm/rhsm.log
6. check the guest's bonus subscription
status
# subscription-manager list --co
the hosts/guests mapping info should be
changed, guest1 uuid should be removed
from host1 to host2, and no any error info
found in all virt-who hosts.
***Bug BZ 1415050 existing for xen and
libvirt
if SAM server
guest1's old bonus pool will be
revoked(RH00050), and can't subscribe a
new one
if Satellite server:
guest1's old bonus pool will be
revoked(RH00050), and will subscribe a
new one by auto.
1). libvirt+satellite => guest1's old bonus
pool will be revoked(RH00050), but it will
subscribe a new bonus pool  (RH00204)
by auto
2). esx+satellite => guest1's old bonus
pool will be revoked(RH00050), but it will
subscribe a new bonus pool  (RH00204)
by auto
3). xen+satellite => guest1's old bonus
pool will be revoked(RH00050), but it will
subscribe a new bonus pool  (RH00204)
by auto
4). rhevm+satellite => guest1's old bonus
pool will be revoked(RH00050), but it will
subscribe a new bonus pool  (RH00204)
by auto
if Stage Candlepin server:
guest1's old bonus pool will be
revoked(RH00050), and will subscribe a
new one by auto.
1). libvirt+Stage => guest1's old bonus
pool will be revoked(RH00050), but it will
subscribe a new bonus pool  (RH0103708)
by auto
2). hyper-v+Stage => guest1's old bonus
pool will be revoked(RH00050), but it will
subscribe a new bonus pool  (RH0103708)
by auto
3). vdsm+Stage => guest1's old bonus
pool will be revoked(RH00050), but it will
subscribe a new bonus pool  (RH0103708)
by auto
RHEL7-53870 - 2015-Migrate a guest to a subscribed host
Step
***For all hypervisor
1. prepare two hosts or hypervisors(host1
and host2),  and install a  guest on
host1(guest1)
2. register host1, host2, guest1
3. subscribe host/guest by CLI (if
hypervisor, subscribe by webui)
subscribe host1 to RH00050 physical pool
subscribe guest1 to RH00050 bonus pool
subscribe host2 to RH00050 physical pool
4. migrate guest1 to host2
5. check rhsm.log 
# tail -f /var/log/rhsm/rhsm.log
6. check the guest's bonus subscription
status
# subscription-manager list --co
Expected Result
the hosts/guests mapping info should be
changed, guest1 uuid should be removed
from host1 to host2, and no any error info
found in all virt-who hosts.
if SAM server
guest1's old bonus pool will be
revoked(RH00050), and can't subcribe a
new one
if Satellite/ server:
guest1's old bonus pool  will be revoked
(RH00050), but it will subscribe again to
the same bonus pool  (RH00050)
if Stage Candlepin server:
guest1's old bonus pool will not be
revoked(RH00050), always RH00050
RHEL7-53871 - 2016-[WEBUI] - Migrate a guest to a subscribed host
Step
Expected Result
***For all hypervisor
NOTE: we want to add this case to above
migration case, but the webui check is not
available for CI auto, so we separate it
from above case.
1. prepare two hosts or hypervisors(host1
and host2),  and install a  guest on
host1(guest1)
2. register host1, host2, guest1
3. subscribe host/hypervisor and guest by
webui
subscribe host1 to RH00050 physical pool
subscribe guest1 to RH00050 bonus pool
subscribe host2 to RH00050 physical pool
4. migrate guest1 to host2
5. check webui
if Satellite server:
will show which host/hypervisor produces
the bonus pool, like -  "Guests of virt-who-
host1", and can subscribe successfully.
if SAM/Stage Canlepin server:
will not show bonus pool source detail info,
can subscribe to RH00050 bonus pool
successfully
host1 and guest1 are not associated any
more, host2 and guest1 will be associated
if Satellite server:
the guest1's RH00050 bonus pool change
to -  "Guests of virt-who-host2"
if SAM/Stage Canlepin server:
guest1's bonus pool will no changes, still is
subscribed to RH00050 bonus pool.
RHEL7-53872 - 2017-Ping-Pong Migrate a guest and then restart such as libvirt / vdsm /
vcenter / rhevm / hyperv
Step
***For all hypervisor
Expected Result
Refer to BZ 1468992
1. prepare two hosts or hypervisors(host1
and host2),  and install a  guest on
host1(guest1)
2. register host1, host2, guest1
3.
subscribe host1 to RH00050 physical pool
subscribe guest1 to RH00050 bonus pool
subscribe host2 to RH00050 physical pool
4. [Ping] migrate guest1 to host2
5. check rhsm.log 
# tail -f /var/log/rhsm/rhsm.log
if SAM server
the hosts/guests mapping info should be
changed, guest1 uuid should be removed
from host1 to host2, and no any error info
found in all virt-who hosts.
if Satellite server:
the hosts/guests mapping info should be
changed, guest1 uuid should be removed
from host1, will be added to host2, and no
any error info found in all virt-who hosts.
if Stage Candlepin server:
the hosts/guests mapping info should be
changed, guest1 uuid should be removed
from host1, will be added to host2, and no
any error info found in all virt-who hosts.
if SAM server
guest1's old bonus pool will be
revoked(RH00050), and can't subcribe a
new one
if Satellite server
guest1's old bonus pool will be
revoked(RH00050), but it will subscribe to
the same bonus pool again by auto 
(RH00050)
if Stage Candlepin server:
guest1's old bonus pool will not be
revoked(RH00050), always RH00050
the hosts/guests mapping info should be
changed, guest1 uuid should be removed
from host2, will be added to host1, and no
any error info found in all virt-who hosts.
if SAM server
guest1's old bonus pool has been
revoked(RH00050), and can't subcribe a
new one
if Satellite server
guest1's old bonus pool will be
revoked(RH00050), but it will subscribe to
the same bonus pool again by auto 
(RH00050)
***Bug BZ 1468992 existing for vdsm
if Stage Candlepin server:
guest1's old bonus pool will not be
revoked(RH00050), always RH00050
6. check the guest's bonus subscription
status
# subscription-manager list --co
7. [Pong] migrate the guest from host2 to
host1
8. check rhsm.log 
# tail -f /var/log/rhsm/rhsm.log
9. check the guest's bonus subscription
status
# subscription-manager list --co
10. restart service such as:
libvirt / vdsm / vcenter / rhevm / hyperv
11. check the result as step 8, 9
RHEL7-53873 - 2018-Migrate a guest to another host under fake mode
Step
***For all hypervisor
1. prepare two hosts or hypervisors(host1
and host2),  and install a  guest on
host1(guest1)
2. register host1, host2, guest1
3. config and run virt-who with -p option to
create the fake json
# virt-who -p -d >/tmp/fake.json
4. create a fake config file in /etc/virt-
who.d, such as:
[fake-virt]
type=fake
file=/tmp/fake.json
is_hypervisor=True
owner=7661967
env=7661967
5. restart virt-who service and check
rhsm.log
6.
subscribe host1 to RH00050 physical pool
subscribe guest1 to RH00050 bonus pool
subscribe host2 to RH00050 physical pool
7. migrate guest1 to host2
8. check rhsm.log 
# tail -f /var/log/rhsm/rhsm.log
9. check webui
Expected Result
virt-who can send the mapping info
according to the file "/tmp/fake.json"
normally
after migration, the hosts/guests mapping
info should be no changes, guest1 uuid is
still exist on host1.
after migration, the host/guests association
still no changes
10. check the guest's bonus subscription
status
# subscription-manager list --co
after migration, the guest's bonus
subscription shouldn't be revoked.
3 . Virt-who Subscription cases
RHEL7-53875 - 3001-Check guest virt.uuid/host_type/is_guest facts via GUI and CLI of
subscription-manager
Step
***For all hypervisor
1.Start the guest
2.Register the guest to
Sam/Satellite/Stage
3.Check the virt.uuid facts via GUI
# subscription-manager-gui
Click the 'System' -> 'View System Facts' -
> 'virt'
Expected Result
the guest registered successfully
the virt.uuid displays as following:
virt.uuid:45uteefdfjkldfjjsdfjdjf0200
4.Check the facts via CLI
# subscription-manager facts --list | grep
virt.uuid
the virt.uuid should be the same as above
GUI:
virt.uuid:45uteefdfjkldfjjsdfjdjf0200
5. Check the virt.host_type facts via GUI
# subscription-manager-gui
Click the 'System' -> 'View System Facts' -
> 'virt'
the virt.host_type dispalys as follow:
virt.host_type: vmware
6. Check the facts via CLI
# subscription-manager facts --list | grep
virt.host_type
the virt.host_type should be the same as
above GUI:
virt.host_type: vmware
7. Check the virt.host_type facts via GUI
# subscription-manager-gui
Click the 'System' -> 'View System Facts' -
> 'virt'
the virt.is_guest dispalys as follow:
virt.is_guest: True
8. Check the facts via CLI
# subscription-manager facts --list | grep
virt.is_guest
the virt.is_guest should be the same as
above GUI:
virt.is_guest: True
RHEL7-53876 - 3002-Check the host/guests association info
Step
***For all hypervisor
1. register host to the SAM/Satellite/Stage
Expected Result
2. register guest to the
SAM/Satellite/Stage 
3. restart virt-who service
4. check rhsm.log
5. check the association in
SAM/Satellite/Stage web ui
the host/guests mapping info should be
found from rhsm.log
if no guest register on host, should be no
any guest association info found for this
host;
if the guest register on host, should find
the guest running on this host;
RHEL7-53877 - 3003-[Unlimited] GUI - Check Both Type on guest
Step
***For all hypervisor 
1. Make sure the host or hypervisor
subscribed to "Resilient Storage for
Unlimited Guests" physical pool
1. Open subscription-manager-gui in guest
# subscription-manager-gui
2. Click "All Available Subscriptions" tab ---
-> 'Update' button --- > look for a both
bonus subscription, such as:
' Resilient Storage for Unlimited Guests '
3. Click "Attach" button
4. Click "Attach" button in the contract
selection dialog
Expected Result
Available subscriptions are listed, and the
"Type" column of bonus shows a
value of "Both", available number is correct
The virtual subscription can be selected via
the contract selection dialog
The virtual subscription can be subscribed,
check "My Subscribeptions" tab, the
"Type" in subscription details should be
"Virtual"
RHEL7-53878 - 3004-[Unlimited] The unlimited bonus pool should be created on guest
Step
***For all hypervisor
1. register the host(hypervisor) and guest
to SAM/Satellite/Stage Candlepin
2. subscribe the host to a pool which can
create a bonus pool(SKU:RH00060),
please don't sue Datacenter pool
# subscription-manager subscribe  --
pool=8a99f9814f99ff5e014faa9a8d725864
3. check the unlimited bonus pool created
on guest
# subscription-manager list --av
Expected Result
The Unlimited bonus pool shoud be
created, such as:
Pool ID:            
2c90ec9451671b670151675eeecd16bc
Available:           Unlimited
RHEL7-53879 - 3005-[Unlimited] The unlimited bonus pool should be subscribed by
pool_id on guest
System Type:         Virtual
Step
***For all hypervisor
1. register the host(hypervisor) and guest to
SAM/Satellite/Stage Candlepin
2. subscribe the host to a pool which can
create a bonus pool(SKU:RH00060), please
don't use Datacenter pool:
# subscription-manager subscribe  --
pool=8a99f9814f99ff5e014faa9a8d725864
3. check the unlimited bonus pool created on
guest
# subscription-manager list --av
4. subscribe guest to the unlimited bonus
pool by pool_id, such as:
# subscription-manager subscribe  --
pool=2c90ec9451671b670151675eeecd16bc
5. check the consumed info on guest
# subscription-manager list --co
# subscription-manager list --in
Expected Result
The Unlimited bonus pool shoud be
created, such as:
Pool ID:            
2c90ec9451671b670151675eeecd16bc
Available:           Unlimited
System Type:         Virtual
should be subscribed no error
should show the unlimited bonus pool
RHEL7-53880 - 3006-[Unlimited] The unlimited bonus pool can be subscribed by auto on
guest
Step
***For all hypervisor
1. register the host(hypervisor) and guest
to SAM/Satellite/Stage Candlepin
2. subscribe the host to a pool which can
create a bonus pool(SKU:RH00060),
please don't use Datacenter pool:
# subscription-manager subscribe  --
pool=8a99f9814f99ff5e014faa9a8d725864
3. check the unlimited bonus pool created
on guest
# subscription-manager list --av
Expected Result
The Unlimited bonus pool shoud be
created, such as:
Pool ID:            
2c90ec9451671b670151675eeecd16bc
Available:           Unlimited
4. subscribe guest to the unlimited bonus
pool by pool_id, such as:
# subscription-manager subscribe  --auto
5. check the consumed info on guest
# subscription-manager list --co
# subscription-manager list --in
System Type:         Virtual
should be subscribed successfully
should show the unlimited bonus pool
for satellite/stage, it will subscribe a bonus
pool by auto, may be not the bonus pool
created by the host subscribed physical
pool
RHEL7-53881 - 3007-[Unlimited] Remove host subscribed pool, the unlimited bonus pool
should be removed on guest
Step
***For all hypervisor
1. register the host(hypervisor) and guest to
SAM/Satellite/Stage Candlepin
2. subscribe the host to a pool which can
create a bonus pool(SKU:RH00060), please
don't use Datacenter pool:
# subscription-manager subscribe  --
pool=8a99f9814f99ff5e014faa9a8d725864
3. check the unlimited bonus pool created on
guest
# subscription-manager list --av
4. subscribe guest to the unlimited bonus
pool by pool_id or auto, such as:
# subscription-manager subscribe  --
pool=2c90ec9451671b670151675eeecd16bc
5. check the consumed info on guest
# subscription-manager list --co
# subscription-manager list --in
6. check the consumed serial and remove it
on host
# subscription-manager list --co
# subscription-manager remove --
serial=5575032216163770990
7. check the bonus pool revoked or not
# subscription-manager refresh
# subscription-manager list --co
Expected Result
The Unlimited bonus pool shoud be
created, such as:
Pool ID:            
2c90ec9451671b670151675eeecd16bc
Available:           Unlimited
System Type:         Virtual
should be subscribed successfully
should show the unlimited bonus pool
the unlimited bonus pool should be
revoked
RHEL7-53882 - 3008-[Unlimited] Re-register host, check bonus pool revoked and
host/guests mapping info
Step
Expected Result
***For all hypervisor
NOTE: for hypervisor, you don't need to
register a hypervisor by CLI, you just need to
config the virt-who hypervisor mode and
restart virt-who service, the hypervisor will be
registered to the server as your virt-who
host.
but you can unregister the hypervisor from
satellite/sam/stage web ui
1. register the host(hypervisor) and guest to
SAM/Satellite/Stage Candlepin
2. subscribe the host to a pool which can
create a bonus pool(SKU:RH00060), please
don't use Datacenter pool:
# subscription-manager subscribe  --
pool=8a99f9814f99ff5e014faa9a8d725864
3. check the unlimited bonus pool created on
guest
# subscription-manager list --av
4. subscribe guest to the unlimited bonus
pool by pool_id or auto, such as:
# subscription-manager subscribe  --
pool=2c90ec9451671b670151675eeecd16bc
5. check the consumed info on guest
# subscription-manager list --co
# subscription-manager list --in
6. unregister host
# subscription-manager unregister
check virt-who/libvirtd/vdsmd status
check virt-who thread number
7. check the bonus pool revoked or not
# subscription-manager refresh
# subscription-manager list --co
8. re-register host again
check rhsm.log
check web
The Unlimited bonus pool shoud be
created, such as:
Pool ID:            
2c90ec9451671b670151675eeecd16bc
Available:           Unlimited
System Type:         Virtual
should be subscribed successfully
should show the unlimited pool
the unlimited bonus pool should be
revoked
make sure the host/guests mapping info
normally and no any error info found
make sure host/guests mapping info has
been send to server
RHEL7-53883 - 3009-[Unlimited] GUI - Subscribe physical unlimited pool on host,
subscribe bonus pool on guest
Step
Expected Result
***For all hypervisor
NOTE: if the host is not local KVM or
VDSM mode, please subscribe the
hypervisor by webUI
1. open subscription-manager-gui on host,
click "All Available Subscriptions" tab, click
"Update" button.
2. choose an unlimited physical
pool(SKU:RH00060), Click "Subscribe",
Note: please don't use Datacenter pool
3.click "My Subscriptions"
4.open subscription-manager-gui on guest,
click "All Available Subscriptions" tab, click
"Update" button.
5. choose the unlimited bonus pool, click
"Subscribe"
6.click "My Subscriptions"
Subscribe successfully to the unlimited
pool on host, the Status Details of the
consumed subscription are empty or is
current.
Subscribe successfully to the bonus pool
on guest, the Status Details of the
consumed subscription are empty or is
current.
RHEL7-53884 - 3010-[Unlimited] GUI - Unsubscribe host by gui, guest's bonus pool should
be revoked
Step
Expected Result
***For all hypervisor
NOTE: if the host is not local KVM or
VDSM mode, please
subscribe/unsubscribe the hypervisor by
webUI
1. subscribe the physical unlimited pool on
host by GUI(SKU:RH00060)
2. subscribe the bonus pool on guest by
GUI
3. unsubscribe physical pool on host by
GUI
4. run "subscription-manager refresh" on
guest
5. open subscription-manager-gui on guest
check "My Subscriptions" tab
check "My Installed Software" tab
The attached bonus pool should be
revoked.
The RHEL installed product cert will
become Red
RHEL7-53885 - 3011-[Unlimited] GUI - Unregister host by gui, guest's bonus pool should
be revoked
Step
Expected Result
***For all hypervisor
NOTE: if the host is not local KVM or
VDSM mode, please subscribe the
hypervisor by webUI
1. subscribe an pyhiscal unlimited pool on
host by GUI(SKU:RH00060)
2. subscribe the bonus pool on guest by
GUI
3. unregister host by GUI
4. run "subscription-manager refresh" on
guest
5. open subscription-manager-gui on guest
check "My Subscriptions" tab
check "My Installed Software" tab
if the host is not local KVM or VDSM
mode, please unregister the hypervisor by
webUI
The attached bonus pool should be
revoked.
The RHEL installed product cert will
become Red
RHEL7-53886 - 3012-[Unlimited] WEBUI - Check the unlimited bonus pool by webUI
Step
***For all hypervisor
1. find the guest in the SAM/Satellite/Stage
candlepin web UI, list guest available
subscriptions.
2.  find the host/hypervisor in web UI, 
subscribe host/hypervisor to the physical
pool whose bonus pool available quantity
is unlimited(SKU:RH00060)
3. find the guest again, list guest available
subscriptions again
Expected Result
there are only physical pools listed in
guest.
there are both physical and virtual bonus
pool listed in guest, and the available
quantity of virtual pools is unlimited.
4. subscribe the bonus pool to guest by
the bonus pool should be attached
web UI
normally.
5. check the consumed bonus pool on
guest by CLI and WebUI
# subscription-manager refresh
# subscription-manager list --co
# subscription-manager list --in
after refresh, the bonus pool should be
listed by --co
RHEL7-53887 - 3013-[Unlimited] WEBUI - Unsubscribe host by webUI, guest's bonus pool
should be revoked
Step
***For all hypervisor
1. subscribe the physical pool to host by
webui(SKU:RH00060)
2. subscribe the bonus pool on guest by
webui
3. unsubscribe physical pool from
host/hypervisor by webui
4. run "subscription-manager refresh" on
guest
5. check the consumed pool on guest by
CLI
# subscription-manager refresh
# subscription-manager list --co
# subscription-manager list --in
6. open/refresh the guest web page
Expected Result
The attached bonus pool should be
revoked.
The attached bonus pool should be
revoked.
List available subscriptions on guest web
page, the bonus pools should be not found
any more.
RHEL7-53888 - 3014-[Unlimited] WEBUI - Unregister host by webUI, guest's bonus pool
should be revoked
Expected Result
Step
***For all hypervisor
1. subscribe physical pool to host by
webui(SKU:RH00060)
2. subscribe the bonus pool on guest by
webui
3. unregister physical pool from
host/hypervisor by webui
4. run "subscription-manager refresh" on
guest
5. check the consumed pool on guest by
CLI
# subscription-manager refresh
# subscription-manager list --co
# subscription-manager list --in
6. open/refresh the guest web page
The attached bonus pool should be
revoked.
The attached bonus pool should be
revoked.
List available subscriptions on guest web
page, the bonus pools should be not found
any more.
RHEL7-53889 - 3015-[Datacenter] Set cpu.cpu_socket and subscribed on host, check the
consumed status for KVM / VDSM
Step
Expected Result
***Only for Local_Libvirt, VDSM
NOTE: physical Datacenter pool is not
designed for any product, so it can not be
auto-attached to physical hosts, only can
attach by manual.
1. register the host(hypervisor) to
SAM/Satellite/Stage Candlepin
2. set cpu.cpu_socket(s) to 4 on host
# echo '{"cpu.cpu_socket(s)":"4"}' >
/etc/rhsm/facts/custom.facts,
# subscription-manager facts --update
# subscription-manager facts --list
3. check the Datacenter pool id and
subscribe it:
# subscription-manager subscribe  --
pool=8a99f9814f99ff5e014faa9a8d725864
check the cpu_socket should be updated
normally
should be subscribed successfully
4. check the consumed info on host
# subscription-manager list --co
# subscription-manager list --in
show the Datacenter pool normally and the
status should be as:
Status Details:      Subscription is current
5. remove the subscribed pool on host
# subscription-manager remove --
serial=5575032216163770990
6. subscribe it again with --quantity=1 on
host
# subscription-manager subscribe  --
pool=8a99f9814f99ff5e014faa9a8d725864
--quantity=1
should be subscribed successfully
7. check the consumed info on host
# subscription-manager list --co
# subscription-manager list --in
show the Datacenter pool normally and the
status should be as
Status Details:      Only supports 2 of 4
RHEL7-53890 - 3016-[Datacenter] Set cpu.cpu_socket and subscribed bonus pool on
guest, check the consumed status
sockets
Step
Expected Result
***For all hypervisor
NOTE: Vitual Datacenter pool can be auto
attached to the supported product.
1. register the host(hypervisor) and guest
to SAM/Satellite/Stage Candlepin
2. subscribe the host to a pool which can
create a bonus pool, such as the
Datacenter pool (RH00002), such as:
# subscription-manager subscribe  --
pool=8a99f9814f99ff5e014faa9a8d725864
3. set cpu.cpu_socket(s) to 4 on guest
# echo '{"cpu.cpu_socket(s)":"4"}' >
/etc/rhsm/facts/custom.facts,
# subscription-manager facts --update
# subscription-manager facts --list
4. check the unlimited bonus pool id and
subscribe it, such as:
# subscription-manager subscribe  --
pool=8a99f9814f99ff5e014faa9a8dad5891
5. check the consumed info on guest
# subscription-manager list --co
# subscription-manager list --in
6. remove the subscribed pool on guest,
such as:
# subscription-manager remove --
serial=5575032216163770990
7. subscribe it again with --quantity=1 on
guest, such as:
# subscription-manager subscribe  --
pool=8a99f9814f99ff5e014faa9a8dad5891-
-quantity=1
check the cpu_socket should be updated
normally
should be subscribed successfully
show the Datacenter pool normally and
the status should be as:
Quantity Used:       1
Status Details:      Subscription is current
should be subscribed successfully
8. check the consumed info on guest
# subscription-manager list --co
# subscription-manager list --in
show the Datacenter pool normally and
the status should be as
Status Details:      Subscription is current
RHEL7-53891 - 3017-[Datacenter] Check repos in Host and Guest when host has
subscribed
Step
***For all hypervisor
1. On the Host: subscribe to the
DataCenter:
#subscription-manager subscribe --
pool=[DataCenter subscription pool id]
2. On the Guest: attach the bonus.
3. if your host is kvm or vdsm, run the
command :
#subscription-manager repos --list
4. if your host is kvm or vdsm, run the
command:
#rct cat-cert
/etc/pki/entitlement/<serial>.pem
5. On the Guest, run the command :
#subscription-manager repos --list
Expected Result
Subscribe successfully to the DataCenter
subscription pool
It should display "This system has no
repositories available through
subscriptions." , No repos have been
added to redhat.repo
It should show the Entitlement Certificate
information, but NO Content Sets.
Stage:It should display a lot of RHEL
repos.
Satellite: It should show "This system has
no repositories available through
subscriptions."
6. On the Guest, run the command:
#yum repolist
It should display a lot of RHEL repos and
available package counts
7. On the Guest, run the command:
#rct cat-cert
/etc/pki/entitlement/<serial>.pem
It should show the Entitlement Certificate
information, it also with many Content
Sets.
[NOTE:] : In the HyperV, ESX,RHEVM, it
just need to check the repos in the guest
RHEL7-53892 - 3018-[Datacenter] GUI - Set cpu.cpu_socket and subscribed on host, check
the consumed status for KVM / VDSM
Step
Expected Result
***only for Local Libvirt, VDSM
1. register the host(hypervisor) to
SAM/Satellite/Stage Candlepin
2. set cpu.cpu_socket(s) to 4 on host
# echo '{"cpu.cpu_socket(s)":"4"}' >
/etc/rhsm/facts/custom.facts,
# subscription-manager facts --update
# subscription-manager facts --list
3. open subscription-manager-gui, click
update, and subscribe "Datacenter pool"
by default
check the cpu_socket should be updated
normally
should be subscribed successfully
4. check the consumed info on host
# subscription-manager list --co
# subscription-manager list --in
show the Datacenter pool normally and the
status should be as:
Status Details:      Subscription is current
5. remove the subscribed pool on host
# subscription-manager remove --
serial=5575032216163770990
6. open subscription-manager-gui, click
update, and subscribe "Datacenter pool"
with quantity=1
7. check the consumed info on host
# subscription-manager list --co
# subscription-manager list --in
should be subscribed successfully
show the Datacenter pool normally and the
status should be as
Status Details:      Only supports 2 of 4
sockets
RHEL7-53893 - 3019-[Limited] Check limited bonus pool creation
Step
Expected Result
***for all hypervisor Refer to BZ 1379926 
1. prepare a host,
two guests
2. register host and
guests to
Sam/Satellite/Stage
3. subscribe the
host to a limit pool,
such as (RH00204)
# subscription-
manager subscribe
--pool=$Poolid
what is a limit pool?
its bonus pool available quantity is 1, the avaiable quantity can be inquired by the
following command
# curl -u stage_test_12:redhat -k
https://subscription.rhn.stage.redhat.com/subscription/products/$productID|python
-mjson.tool
4. list the available
pools on two
guests
# subscription-
manager list --
available
5. in the first guest,
subscribe the
bonus pool which
created by the host
# subscription-
manager subscribe
--pool=$Poolid
6. In the second
guest, list available
entitlement pools
# subscription-
there are both physical and virtual entitlement pools listed, and the available
quantity of virtual pools is 1.
subscribe the first guest to the bonus pool successfully
there are only available physical pools listed, because the bonus pool is only 1
and consumed by guest1
manager list --
available
RHEL7-53894 - 3020-[Limited] WEBUI - Check limited bonus pool by webUI
Step
***for all hypervisor
1. prepare a host, two guests
2. register host and guests to
Sam/Satellite/Stage
3. subscribe the host to a limit pool by web
UI, such as (RH00204)
4. list the available pools on two guests in
web UI
Expected Result
Refer to BZ 1379926
there are both physical and virtual
entitlement pools listed, and the available
quantity of virtual pools is 1.
5. in the first guest, subscribe the bonus
pool by web UI
subscribe the first guest to the bonus pool
successfully
6. In the second guest, list available
entitlement pools in web UI
there are only available physical pools
listed, because the bonus pool is only 1
and consumed by guest1
RHEL7-53895 - 3021-[Instance] Set cpu.cpu_socket to 1 on host, subscribe instance base
pool to host for KVM / VDSM
Step
Expected Result
***only for Local Libvirt, VDSM
1. register host to /Sam/Satellite/Stage
2. make sure the cpu.cpu_socket(s) is 1
on host:
# cat /etc/rhsm/facts/custom.facts
{"cpu.cpu_socket(s)":"1"}
# subscription-manager facts --update
3. subscribe instance base pool
(RH00003) to host without --quantity
option, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
4. check  status by --co / --in
# subscription-manager list --co
# subscription-manager list --in
subscribe normally:
The --co status should be:
Status Details:      Subscription is current
The --in status should be:
Status:         Subscribed
5. remove above subscribed pool:
# subscription-manager remove --all
6. subscribe instance base pool
(RH00003) to host with --quantity=1 option
again, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
--quantity=1
7. remove above subscribed pool:
# subscription-manager remove --all
8. subscribe instance base pool
(RH00003) to host with --quantity=2 option
again, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
--quantity=2
subscribe failed:
Subscription 'Red Hat Enterprise Linux
Server, Premium (Physical or Virtual
Nodes)' must be attached using a quantity
evenly divisible by 2
subscribe normally:
The --co status should be:
Status Details:      Subscription is current
The --in status should be:
Status:         Subscribed
RHEL7-53896 - 3022-[Instance] Set cpu.cpu_socket to 8 on host, subscribe instance base
pool to host with quantity for KVM / VDSM
Step
Expected Result
***only for Local Libvirt, VDSM
1. register host to /Sam/Satellite/Stage
2. make sure the cpu.cpu_socket(s) is 8
on host:
# cat /etc/rhsm/facts/custom.facts
{"cpu.cpu_socket(s)":"8"}
# subscription-manager facts --update
3. subscribe instance base pool
(RH00003) to host, don't use --quantity
option, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
4. check  status by --co / --in
# subscription-manager list --co
# subscription-manager list --in
subscribe normally:
The --co status should be:
Status Details:      Subscription is current
The --in status should be:
Status:         Subscribed 
5. remove above subscribed pool:
# subscription-manager remove --all
6. subscribe instance base pool
(RH00003) to host with --quantity=1
option, such as:
# subscription-manager subscribe --
subscribe failed:
Subscription 'Red Hat Enterprise Linux
Server, Premium (Physical or Virtual
Nodes)' must be attached using a quantity
pool=8a99f9814f99ff5e014faa9a7f5e56d2
--quantity=1
evenly divisible by 2
7. remove above subscribed pool:
# subscription-manager remove --all
8. subscribe instance base pool
(RH00003) to host with --quantity=2 option
again, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
--quantity=2
9. subscribe instance base pool
(RH00003) to host with --quantity=6
option, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
--quantity=6
subscribe normally:
The --co status should be:
Status Details:      Only supports 2 of 8
sockets.
The --in status should be:
Status:         Partially Subscribed
Status Details: Only supports 2 of 8
sockets.
subscribe normally:
The --co status should be:
Status Details:      Subscription is current
The --in status should be:
Status:         Subscribed
RHEL7-53897 - 3023-[Instance] Set cpu.cpu_socket to 8 on host, subscribe instance base
pool to host with auto for KVM / VDSM
Step
Expected Result
***only for Local Libvirt, VDSM
1. register host to /Sam/Satellite/Stage
2. make sure the cpu.cpu_socket(s) is 8
on host:
# cat /etc/rhsm/facts/custom.facts
{"cpu.cpu_socket(s)":"8"}
# subscription-manager facts --update
3. subscribe instance base pool
(RH00003) to host, don't use --quantity
option, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
4. check  status by --co / --in
# subscription-manager list --co
# subscription-manager list --in
subscribe normally:
The --co status should be:
Status Details:      Subscription is current
The --in status should be:
Status:         Subscribed 
5. remove above subscribed pool:
# subscription-manager remove --all
6. subscribe instance base pool
subscribe failed:
(RH00003) to host with --quantity=1
option, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
--quantity=1
7. remove above subscribed pool:
# subscription-manager remove --all
8. subscribe instance base pool
(RH00003) to host with --quantity=2 option
again, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
--quantity=2
9. subscribe instance base pool
(RH00003) to host with --auto option, such
as:
# subscription-manager subscribe --auto
Subscription 'Red Hat Enterprise Linux
Server, Premium (Physical or Virtual
Nodes)' must be attached using a quantity
evenly divisible by 2
subscribe normally:
The --co status should be:
Status Details:      Only supports 2 of 8
sockets.
The --in status should be:
Status:         Partially Subscribed
Status Details: Only supports 2 of 8
sockets.
subscribe normally:
The --co status should be:
Status Details:      Subscription is current
The --in status should be:
Status:         Subscribed
RHEL7-53898 - 3024-[Instance] Set cpu.cpu_socket to 1 on guest, subscribe instance base
pool to guest
Expected Result
Step
***for all hypervisor
1. register guest to /Sam/Satellite/Stage
2. make sure the cpu.cpu_socket(s) is 1
on guest:
# cat /etc/rhsm/facts/custom.facts
{"cpu.cpu_socket(s)":"1"}
# subscription-manager facts --update
3. subscribe instance base pool
(RH00003) to guest without --quantity
option, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
4. check  status by --co / --in
# subscription-manager list --co
# subscription-manager list --in
subscribe normally:
The --co status should be:
Status Details:      Subscription is current
5. remove above subscribed pool:
The --in status should be:
Status:         Subscribed
# subscription-manager remove --all
6. subscribe instance base pool
(RH00003) to guest with --quantity=1
option again, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
--quantity=1
7. remove above subscribed pool:
# subscription-manager remove --all
8. subscribe instance base pool
(RH00003) to guest with --quantity=2
option again, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
--quantity=2
subscribe normally:
The --co status should be:
Status Details:      Subscription is current
The --in status should be:
Status:         Subscribed 
subscribe normally:
The --co status should be:
Status Details:      Subscription is current
The --in status should be:
Status:         Subscribed
RHEL7-53899 - 3025-[Instance] Set cpu.cpu_socket to 8 on guest, subscribe instance base
pool to guest
Expected Result
Step
***for all hypervisor
1. register guest to /Sam/Satellite/Stage
2. make sure the cpu.cpu_socket(s) is 8
on guest
# cat /etc/rhsm/facts/custom.facts
{"cpu.cpu_socket(s)":"8"}
# subscription-manager facts --update
3. subscribe instance base pool
(RH00003) to guest without --quantity
option, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
4. check  status by --co / --in
# subscription-manager list --co
# subscription-manager list --in
subscribe normally:
The --co status should be:
Status Details:      Subscription is current
The --in status should be:
Status:         Subscribed 
5. remove above subscribed pool:
# subscription-manager remove --all
6. subscribe instance base pool
(RH00003) to guest with --quantity=1
option, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
subscribe normally:
The --co status should be:
Status Details:      Subscription is current
The --in status should be:
--quantity=1
Status:         Subscribed  
7. remove above subscribed pool:
# subscription-manager remove --all
8. subscribe instance base pool
(RH00003) to guest with --quantity=2
option again, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
--quantity=2
9. subscribe instance base pool
(RH00003) to guest with --quantity=6
option, such as:
# subscription-manager subscribe --
pool=8a99f9814f99ff5e014faa9a7f5e56d2
--quantity=6
subscribe normally:
The --co status should be:
Status Details:      Subscription is current
The --in status should be:
Status:         Subscribed  
subscribe normally:
The --co status should be:
Status Details:      Subscription is current
The --in status should be:
Status:         Subscribed
RHEL7-53900 - 3026-[Instance] GUI - Check instance base quantity on guest
Step
***for all hypervisor
1. prepare a guest and register to
Sam/Satellite/Stage
2. check the available instance quantity by:
# subscription-manager list --av
Expected Result
such as:
the instance quantity is 20 before
subscribed.
In the guest1
the available quantity should be -1
My Subscriptions should include 1
attached Instance-Based subscription that
is compliant (no warning icon is present
and the Status
Details should be empty).
My Installed Product tab should show the
provided RHEL product is green
3. check the available instance quantity by:
#subscription-manager-gui
such as:
the instance quantity is 20 before
subscribed. 
4. Go to "All Available Subscription" tab,
click "update" button.
5. Choose the Instance base subscription ,
click "attach" button.
6. Go to "My subscriptions" tab, check the
consumed subscription.
My Subscriptions should include 1
attached Instance-Based subscription that
is compliant (no warning icon is present
and the Status
Details should be empty).
7. Go to "My Installed Software" tab, check
the installed software.
My Installed Product tab should show the
provided RHEL product is green
8. check the available instance quantity
again by:
# subscription-manager list --av
the available quantity should be -1  (19)
RHEL7-53901 - 3027-[Instance] GUI- Set cpu.cpu_socket to 1 on guest, subscribe instance
base pool to guest
Step
***for all hypervisor
1.Check the available subscription in the
guest1.
#subscription-manager-gui
2. Go to "All Available Subscription" tab,
click "update" button.
Expected Result
It will show the Instancebase subscription
3. Choose the Instancebase subscription ,
click "attach" button.
Subscribe success.
4. Go to "My subscriptions" tab, check the
consumed subscription.
My Subscriptions should include 1
attached Instance-Based subscription that
is compliant (no warning icon is present
and the Status Details should be empty).
5. Go to "My Installed Software" tab, check
the installed software.
My Installed Product tab should show the
provided RHEL product is green
RHEL7-53902 - 3028-[Instance] GUI - Set cpu.cpu_socket to 8 on guest, subscribe instance
base pool to guest
Step
***for all hypervisor
1. Make the guest1's socket to 8
# cat /etc/rhsm/facts/custom.facts
{"cpu.cpu_socket(s)":"8"}
# subscription-manager facts --update
2.check the available subscription in the
guest1.
#subscription-manager-gui
3. go to "All Available Subscription" tab,
click "update" button.
Expected Result
guest1's socket has been modified to 8
cpu_socket(s) :8
subscription-manager can be bring up.
It will show the Instancebase subscription
4. choose the Instancebase subscription ,
subscribe success.
and change the quantity to 1, then click
"attach" button.
5. go to "My subscriptions" tab, check the
consumed subscription.
My Subscriptions should include 1
attached Instance-Based subscription that
is compliant (no warning icon is present
and the Status Details should be empty).
6. go to "My Installed Software" tab, check
the installed software.
My Installed Product tab should show the
provided RHEL product is green
RHEL7-53903 - 3029-[Instance] GUI - Set cpu.cpu_socket to 1 on host, subscribe instance
base pool to host by gui for KVM / VDSM
Step
Expected Result
***only for Local Libvirt, VDSM
1. register host to /Sam/Satellite/Stage
2. make sure the cpu.cpu_socket(s) is 1
on host:
# cat /etc/rhsm/facts/custom.facts
{"cpu.cpu_socket(s)":"1"}
# subscription-manager facts --update
3. subscription-manager-gui
#subscription-manager-gui
go to "All Available Subscription" tab, click
"update" button.
4. Choose the Instancebase subscription ,
modify the quantity spinner to 1, click
"attach" button.
5. Choose the Instancebase subscription ,
modify the quantity spinner to 2, click
"attach" button.
Can't mofified it to 1
Modify successful
6. Click "attach" button.
Subscribe success.
7. Go to "My subscriptions" tab, check the
consumed subscription.
My Subscriptions should include 1
attached Instance-Based subscription that
is compliant (no warning icon is present
and the Status Details should be empty).
7. Go to "My Installed Software" tab, check
the installed software.
My Installed Product tab should show the
provided RHEL product is green
RHEL7-53904 - 3030-[Instance] GUI - Set cpu.cpu_socket to 8 on host, subscribe instance
base pool to host by quantity for KVM / VDSM
Step
Expected Result
***only for Local Libvirt, VDSM
1. register host to /Sam/Satellite/Stage
2. make sure the cpu.cpu_socket(s) is 8
on host:
# cat /etc/rhsm/facts/custom.facts
{"cpu.cpu_socket(s)":"8"}
# subscription-manager facts --update
3. subscription-manager-gui
#subscription-manager-gui
go to "All Available Subscription" tab, click
"update" button.
4. Choose the Instancebase subscription ,
modify the quantity spinner to 1, click
"attach" button.
5. Choose the Instancebase subscription ,
modify the quantity spinner to 2, click
"attach" button.
6. Go to "My subscriptions" tab, check the
consumed subscription.
7. Go to "My Installed Software" tab, check
the installed software.
8. Choose the Instancebase subscription ,
modify the quantity spinner to 6, click
"attach" button.
9. Go to "My subscriptions" tab, check the
consumed subscription.
10. Go to "My Installed Software" tab,
check the installed software.
Can't mofified it to 1
Modify successful
My Subscriptions tab for the attached
subscription is yellow with a Status Details
explanation that says "Only covers 2 of 8
sockets 
My Installed Product tab should show the
provided RHEL product Status is
"PartiallSubscribed".
My Subscriptions tab for the attached
subscription is green with a Status Details
is empty.
My Installed Product tab should show the
provided RHEL product is product Status
is "Subscribed".
RHEL7-53905 - 3031-[EXPT] Validate guest compliance when guest registered to diff
server
Expected Result
Refer to:  BZ1347184
Step
***for all hypervisor
NOTE: Make sure there is a host and two
guests.
host and guest1 registered to the same
server.
Guest2 registered to different server. 
1. Register system to server1.
2. Configure virt-who run at any mode.
3. Restart virt-who and check virt-who's
log
Virt-who can send host/guest mapping info
to server1.
4. Register guest1 to server1.
5. Register guest2 to server2.
6. Host1. subscribe pool which can
generate bonus pool.(eg: datacenter pool)
7. Guest1. Check available pool on the
guest1
# subscription-manager list --available
8. Guest2. Check available pool on
the guest1
# subscription-manager list --
available
It will show datacenter bonus pool on
guest1.
It won't show datacenter bonus pool
on guest2.
RHEL7-99882 - 3032-[Datacenter] The datacenter bonus pool can be subscribed by auto
on guest
Step
***For all hypervisor
1. Register the host(hypervisor) and guest
to
SAM/Satellite/Stage Candlepin
2. Subscribe the host/hypervisor to
datacenter physical pool (RH00002) which
can create a bonus pool (RH00050),
# subscription-manager subscribe --
pool=pool_id
3. Check the datacenter bonus pool on
guest
# subscription-manager refresh
# subscription-manager list --av
4. Subscribe guest to the datacenter
bonus pool by auto, such as?
# subscription-manager subscribe --auto
Expected Result
Host/Hypervisor register successfully .
*On server WebUI, hosts/hypervisors
that do NOT have a subscription
attached should be RED under content
hosts.
***Bug 1336924 existing with satellite
servier.
Host/Hypervisor subscribe successfully.
The Datacenter bonus pool shoud be
created.
should be subscribed successfully.
*On server WebUI, hosts/hypervisors
that have subscription attached should
be GREEN under content hosts.
5. Check the consumed info on guest
should show the datacenter bonus pool
should show the unlimited bonus pool
# subscription-manager list --co
# subscription-manager list --in
and the status should be as:
Status Details:
Subscription is current quantity
xxxxxxxxxxx
***Bug 1524528 existing
RHEL7-110509 - 3033 - Temporary bonus pool can be subscribed on guest
Step
***for all hypervisors
1. Stop virt-who service
# systemctl stop virt-who
Expected Result
2. Register guest to SAM/Satellite/Stage
Candlepin.
register successfully.
3. Check the available pool on guest
# subscription-manager list --av
should list all available physical and vitual
pool, and the vitual bonus pool type should
be temporary, such as:
Subscription Name:   Red Hat Enterprise
Linux for Virtual Datacenters, Standard
(DERIVED SKU)
Provides:            dotNET on RHEL (for
RHEL Server)
                     Oracle Java (for RHEL
Server)
                     Red Hat Developer Toolset
(for RHEL Server)
                     Red Hat Enterprise Linux
Atomic Host Beta
                     Red Hat Software Collections
Beta (for RHEL Server)
                     Red Hat Software Collections
(for RHEL Server)
                     Red Hat Enterprise Linux
Server
                     Red Hat Enterprise Linux
Atomic Host
                     Red Hat Beta
SKU:                 RH00050
Contract:            11261867
Pool ID:            
8ac983275f148d96015f14a1f3e2039a
Provides Management: Yes
Available:           Unlimited
Suggested:           1
Service Level:       Standard
Service Type:        L1-L3
Subscription Type:   Stackable
(Temporary) 
Ends:                02/26/2018
System Type:         Virtual
subscribe successfully
"Status Details" will give warning/note
about the temporary subscription, such as:
+-------------------------------------------+
   Consumed Subscriptions
+-------------------------------------------+
Subscription Name:   Red Hat Enterprise
Linux for Virtual Datacenters, Standard
(DERIVED SKU)
Provides:            dotNET on RHEL (for
RHEL Server)
                     Red Hat Beta
                     Red Hat Enterprise Linux
Atomic Host
                     Red Hat Enterprise Linux
Atomic Host Beta
                     Oracle Java (for RHEL
Server)
                     Red Hat Developer Toolset
(for RHEL Server)
                     Red Hat Software Collections
(for RHEL Server)
                     Red Hat Enterprise Linux
Server
                     Red Hat Software Collections
Beta (for RHEL Server)
SKU:                 RH00050
Contract:            11261867
Account:             5758125
Serial:              4788461776092549700
Pool ID:            
8ac983275f148d96015f14a1f3e2039a
Provides Management: Yes
Active:              True
Quantity Used:       1
Service Level:       Standard
Service Type:        L1-L3
Status Details:      Guest has not been
reported on any host and is using a
temporary unmapped guest subscription.
Subscription Type:   Stackable
(Temporary)
Starts:              02/26/2017
Ends:                10/24/2017
System Type:         Virtual
4. Subscribe the temporary Datacenter
virtual pool on guest by pool_id
# subscription-manager attach --pool
8ac983275f148d96015f14a1f3e2039a
5. Check the consumed status on guest
# subscription-manager list --co
6. Start virt-who service to send host-guest
mapping to server.
7. Check the available pool on guest again
# subscription-manager list --av
8. Run "# subscription-manager refresh"
on guest, then check the consumed status
# subscription-manager list --co
9. Attach Datacenter physical pool for
host/hypervisor
all the temporary virtual pool disappear
the subscribed temporary Datacenter
virtual pool disappear
10. Check the available pool on guest
# subscription-manager list --av
should show the non-temporary
Datacenter bonus pool.
11. Subscribe the Datacenter virtual pool
on guest by pool_id
# subscription-manager attach --pool
[POOL_ID]
subscribe successfully
***Bug 1524528 existing
4 . Virt-who Performance cases
RHEL7-53907 - 4001-[Perf] Run virt-who with multi hosts/guests
Step
1. prepare  8+ hosts
2. make sure virt-who is configured for all
these hosts/hypervisors
Expected Result
2.
add 20 guests for each hosts
run virt-who with interval time 0
run virt-who with interval time 5
3.
add 50 guest for each hosts
run virt-who with interval time 0
run virt-who with interval time 5
4.
add 100 guest for each hosts
run virt-who with interval time 0
run virt-who with interval time 5
check the cpu and mem usage for different
interval time
check one shot time
check the cpu and mem usage for different
interval time
check one shot time
check the cpu and mem usage for different
interval time
check one shot time
RHEL7-53908 - 4002-[[Perf] Run virt-who with 100+ config files
Step
Expected Result
1. create 100+ config files in /etc/virt-
who.d
2.
run virt-who with interval time 0
check the cpu and mem usage for different
interval time
run virt-who with interval time 5
run virt-who with oneshot
check the host/guests mapping info
normally
check one shot time
RHEL7-53909 - 4003-[[Perf] Run virt-who with 24+ hours
Step
Expected Result
1. config virt-who with
VIRTWHO_INTERVAL 24 hours, such as:
VIRTWHO_INTERVAL=86400
2. restart virt-who and check the rhsm.log
virt-who can be started normally
within 24h, should be no any new
host/guests mapping info found from
rhsm.log
RHEL7-53910 - 4004-[[Perf] Check memory leak after long-term running
Step
Expected Result
1.configure virt-who, enable debugging
# vi /etc/sysconfig/virt-who
VIRTWHO_BACKGROUND=1
VIRTWHO_DEBUG=1
after step2: virt-who can be started
normally
after step3: there isn't memory leak during
one day
after step4: there isn't memory leak during
three days
after step5: there isn't memory leak during
one week
2. restart virt-who service
# service virt-who restart
3. Monitor the memory usage for one day
4. Monitor the memory usage for three day
5. Monitor the memory usage for one week
RHEL7-53911 - 4005-[[Perf] Check /var/log/rhsm/rhsm.log file size
Step
Expected Result
1. check /var/log/rhsm/rhsm.log file size
 the log file should be split
5 . Other cases
RHEL7-53913 - 5001-[kvm] Check virt-who support libvirt remote mode
Step
***only for remote_libvirt
Expected Result
1. prepare two rhel hosts and register to Sam/Satellite/Stage
(host1 and host2)
2. In host1, copy the ssh-key to the host2 hosts
# ssh-keygen
# ssh-copy-id -i ~/.ssh/id_rsa.pub  HOST2_IP
3. Configure virt-who run at remote libvirtd mode
VIRTWHO_LIBVIRT=1
VIRTWHO_LIBVIRT_OWNER=ACME_Corporation
VIRTWHO_LIBVIRT_ENV=Library
VIRTWHO_LIBVIRT_SERVER=qemu+ssh://HOST2_IP/system
VIRTWHO_LIBVIRT_USERNAME=root
VIRTWHO_LIBVIRT_PASSWORD=redhat
Check message "Protocol is not specified in libvirt url, using
qemu+ssh://"
Set
VIRTWHO_LIBVIRT_SERVER=qemu+ssh://HOST2_IP/system,
message does not exit
Set VIRTWHO_LIBVIRT_SERVER=HOST2_IP
messsage exist.
4. restart virt-who service
# systemctl restart virt-who
# systemctl status virt-who
5. Check the virt-who in the /var/log/rhsm/rhsm.log
it should display host/guest associations info in this log.
6. Open SAM web UI,Check the host/guest association
the hypervisor has been added to SAM server,
RHEL7-53914 - 5002-[kvm] Check virt-who threads after configure libvirt option
Step
***Only for libvirt mode
1. configure libvirt as the following:
# cat /etc/libvirt/libvirtd.conf
listen_tls = 0
listen_tcp = 1
auth_tcp = "sasl"
tcp_port = "16509"
2. restart libvirtd service
# service libvirtd restart
3. check the number of virt-who thread,
such as
# ps -ef | grep virt-who
root 1510 1 1 10:44 ? 00:02:14
/usr/bin/python /usr/share/virt-
who/virtwho.py
Expected Result
virt-who's thread number should be no
changes
# ls /proc/1510/task/ | wc -l
2
# ls /proc/1510/task/ | wc -l
2
# ls /proc/1510/task/ | wc -l
2
RHEL7-53915 - 5003 - Check virt-who config file exist after reboot virt-who host
Step
***For all hypervisor
1.Register virt-who system to
SAM/Satellite/Stage Candlepin
2. Configure virt-who by /etc/sysconfig/virt-who,
such as:
# vi /etc/sysconfig/virt-who
VIRTWHO_DEBUG=1
VIRTWHO_XEN=1
VIRTWHO_XEN_OWNER=Default_Organization
VIRTWHO_XEN_ENV=Library
VIRTWHO_XEN_SERVER=10.73.5.212
VIRTWHO_XEN_USERNAME=root
VIRTWHO_XEN_PASSWORD=Welcome1
3. Create config file by /etc/virt-who.d/xxx.conf,
such as:
# vi /etc/virt-who.d/xen.conf
[sat-xen]
type=xen
owner=Default_Organization
env=Library
server=10.73.5.212
username=root
password=Welcome
4.  Configure /etc/vit-who.conf, such as:
# vi /etc/virt-who.conf
[global]
interval=60
debug=True
5. Restart virt-who service, then reboot virt-who
host.
Expected Result
Both before and after reboot system,
virt-who report host/guest mappings
normally.
All the configure in step2-3 should
be no change.
RHEL7-53916 - 5004-[vdsm] Check guest consumed status when pause/poweron/off by
auto assigned for vdsm mode
Step
Expected Result
***Only for VDSM mode
1. prepare two vdsm hosts (host1, host2)
=> add these hosts to rhevm
=> add  a guest to host1
2. make sure host1 and guest1 register to
Sam/Satellite/Stage
3. configure virt-who on host1 for vdsm
mode
# vi /etc/sysconfig/virt-who
VIRTWHO_VDSM=1
4. restart virt-who service and check
rhsm.log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
5.
subscirbe a physical pool to host1,
subscribe the bonus pool to host1' s
guest1
6. make the guest1
pasue/poweoff/poweron by auto assigned
should show the host1/guest1 mapping
info
host1 and guest1 should be subscribed
normally.
if the guest1 is still assign to host1 by auto,
the mapping info should be no changed,
the consumed bonus should be not
revoked.
if the guest1 is assign to host2 by auto, the
mapping info should be changed, the
consumed bonus should be revoked and
maybe it will subscribe a new bonus pool
again
RHEL7-53917 - 5005-[rhevm] Check guest consumed status when pause/poweron/off by
auto assigned for rhevm mode
Expected Result
Step
***Only for RHEVM mode
1. prepare two vdsm hosts (host1, host2)
=> add these hosts to rhevm
=> add  a guest to host1
2. make sure host1 and guest1 register to
Sam/Satellite/Stage
3. configure virt-who on host1 for rhevm mode
# vi /etc/sysconfig/virt-who
VIRTWHO_RHEVM=1
VIRTWHO_RHEVM_OWNER=ACME_Corporation
VIRTWHO_RHEVM_ENV=env1
VIRTWHO_RHEVM_SERVER=10.66.79.91
VIRTWHO_RHEVM_USERNAME=admin
VIRTWHO_RHEVM_PASSWORD=redhat
4. restart virt-who service and check rhsm.log
# systemctl restart virt-who
# tail -f /var/log/rhsm/rhsm.log
5.
subscirbe a physical pool to host1,
subscribe the bonus pool to host1' s guest1
6. make the guest1 pasue/poweoff/poweron by
auto assigned
should show the host1/guest1
mapping info
host1 and guest1 should be
subscribed normally.
if the guest1 is still assign to host1
by auto, the mapping info should
be no changed, the consumed
bonus should be not revoked.
if the guest1 is assign to host2 by
auto, the mapping info should be
changed, the consumed bonus
should be revoked and maybe it
will subscribe a new bonus pool
again
RHEL7-53918 - 5006-[Hyper-v] Check Hyper-v AllowUnencrypted option for virt-who
connection
Expected Result
How to manage GPO on Windows 2012:
https://mojo.redhat.com/docs/DOC-1065029
 
or run gpedit.msc in cmd
if the ent.com GPO is invalid, please run
"local group policy editor"
Step
***Only for Hyper-V
1. Install Group Policy Management in hyper-v server
=> on the Start screen, click the Server Manager
=> In the Quick Start display, click Add roles and
features . Follow the Add roles and features wizard to
add the Group Policy Management feature. and Click
Install .
2. Open Group Policy Management
Expand:
-> "Domains "
-> "ent.com "
-> "Group Policy Objects"
-> "Default Domain Policy"
Right Click "Default Domain Policy" and select "Edit...",
this will open the "Group Policy Management Editor",
Expand:
-> "Computer Configuration"
-> "Administrative Template"
-> "Windows Components"
-> "Windows Remote Management"
-> "WinRM Service"
3. Right Click "Allow unencrypted traffic" option,
set it to "Enabled", and the run "gpupdate" on cmd to
update the policy, and then run "winrm get winrm/config"
on cmd to check the config
4. config virt-who for hyper-v and restart virt-who
# vi /etc/sysconfig/virt-who
VIRTWHO_HYPERV=1
VIRTWHO_HYPERV_OWNER=7661967
VIRTWHO_HYPERV_ENV=7661967
VIRTWHO_HYPERV_SERVER=10.66.129.68
VIRTWHO_HYPERV_USERNAME="ENT\administrator"
VIRTWHO_HYPERV_PASSWORD=Welcome1
5. Right Click "Allow unencrypted traffic" option,
set it to "Disabled", and the run "gpupdate" on cmd to
update the policy, and then run "winrm get winrm/config"
on cmd to check the config
AllowUnencrypted should be:
AllowUnencrypted = true [Source="GPO"]
can connect to hyper-v normally, virt-who
can fetch the host/guests info from hyper-v
and send it to Sam/Satellite/Stage server
AllowUnencrypted should be:
AllowUnencrypted = false [Source="GPO"]
6. config virt-who for hyper-v and restart virt-who again
can't  connect to hyper-v normally
7. Right Click "Allow unencrypted traffic" option,
set it to "Not Configured", and the run "gpupdate" on
cmd to update the policy, and then run "winrm get
winrm/config" on cmd to check the config
8. config virt-who for hyper-v and restart virt-who again
AllowUnencrypted should be:
AllowUnencrypted = true
can  connect to hyper-v normally, virt-who
can fetch the host/guests info from hyper-v
and send it to Sam/Satellite/Stage server
RHEL7-53919 - 5007-[ESX] Check the virt-who log out of vcenter after stop virt-who
service
Step
***Only for ESX
1. Register system to server
Expected Result
Refer to BZ 1249928
2. Open
https://[vcenterip]/mob/?moid=SessionManager
Show all usersession
3. Configure virt-who run at esx mode and
restart virt-who service
4. Open
https://[vcenterip]/mob/?moid=SessionManager
5. Stop virt-who service, then open
https://[vcenterip]/mob/?moid=SessionManager
It will increase one usersession 
The new usersession which generated
on step4 is not exist. the number of
usersession is the same as step 2
RHEL7-53920 - 5008-[Satellite] Check unlimited bonus-pool generation when register
system with an active key
Step
Expected Result
***For all hypervisor
***Only for Satellite server
1. Create activation key on satellite webui.
Path: WebUI -> Content -> Activation Keys
-> New Activation Key
Specify the name, such as 'virt-who';
Environment, check the 'Library';
Content View, select 'Default Organization
View'
2. Register host and guest to satellite
server with active key(virt-who), such as:
# subscription-manager register  --
org="Default_Organization"--
activationkey="virt-who"
activation key should be created
successfully.
host and guest can be registered to
satellite successfully.
3. List available pool on the guest.
# subscription-manager list --available
there are only available physical pools
listed. 
4. Subscribe host/hypervisor to one
physical pool whose bonus pool
available
quantity is unlimited.(eg. "Resilient Storage
for Unlimited
Guests")
# subscription-manager subscribe --
pool=$Poolid
5. List available pools on the guest.
# subscription-manager list --available
subscribe host/hypervisor to the pool
successfully
there are both physical and virtual pools
listed, and the
available quantity of virtual pools is
unlimited.
RHEL7-61430 - 5009-[Satellite5.X] Check virt-who send hyperviosr to server when server
hasn't syn any related channel
Step
***for all hypervisor
NOTE: Make sure satellite hasn't syn any redhat channel
1 Register system to satellite5.X
Expected Result
Refer to BZ
1245035 
2 Configure virt-who run at any mode
# cat /etc/virt-who.d/virt 
[test-esx1]
type=esx
server=10.73.2.95
username=Administrator@vsphere.local
#encrypted_password=07928b0a0b0caa7c6e3b5915466210bd
password=Welcome1!
owner=ACME_Corporation
env=Library
sat_server=10.66.128.78
sat_username=admin
sat_password=redhat
3. Restart virt-who service and check virt-who's log
# tail -f /var/log/rhsm/rhsm.log
4. In satellite webUI, go to "system" tab, click on the hyperviosr which
registered by virt-who, check the "Subscribed channels"
The
host/guests
json info
should be
found for
rhsm.log;
The "Hypervisor
base" channel
has been
attached
RHEL7-53922 - 5010-[Satellite5.X] Check virt-who send multi-hypervisors to different
server
Step
***for all hypervisor
1. Register system to satellite5.X
Expected Result
Refer to  BZ 1196576
2. Configure virt-who run at two different modes and send
host/gust mapping to different satellite server.
# cat /etc/virt-who.d/virt 
[test-esx1]
type=esx
server=10.73.2.95
username=Administrator@vsphere.local
#encrypted_password=07928b0a0b0caa7c6e3b5915466210bd
password=Welcome1!
owner=ACME_Corporation
env=Library
sat_server=10.66.128.78
sat_username=admin
sat_password=redhat
[test-rhevm1]
type=rhevm
server=https://dell-pe1955-01.rhts.eng.bos.redhat.com:443
username=admin@internal
password=redhat
owner=ACME_Corporation
env=Library
sat_server=10.66.128.19
sat_username=admin
sat_password=redhat
3. Restart virt-who service and check virt-who's log
# tail -f /var/log/rhsm/rhsm.log
4. Open two satellite's webUI, check host/guest mapping info
The two
hypervisors'
host/guests json
info should be
found for rhsm.log;
The two
hypervisors' json
info should be
showed at the
same time, don't
need to wait for so
long time, no 60s
delay.
Hypervisors can show
on two satellites
individually.
RHEL7-58982 - 5011-[Satellite5.X] Check virt-who send mapping info through satellite
proxy with /etc/virt-who.d/xx configure
Step
Expected Result
***not for local_libvirt, vdsm
1. Register system to satellite5.X proxy
2. Configure virt-who run any mode and "sat_server" to satellite
proxy server.
# cat /etc/virt-who.d/virt 
[test-esx1]
type=esx
server=10.73.2.95
username=Administrator@vsphere.local
#encrypted_password=07928b0a0b0caa7c6e3b5915466210bd
password=Welcome1!
owner=ACME_Corporation
env=Library
sat_server=10.66.128.78[satellite proxy server]
sat_username=admin
sat_password=redhat
3. Restart virt-who service and check virt-who's log
# tail -f /var/log/rhsm/rhsm.log
4. Open satellite's webUI, check host/guest mapping info
Virt-who send
host/guest mapping
info successfully.
Hypervisors can show
on satellites .
RHEL7-58983 - 5012-[Satellite5.X] Check virt-who send mapping info through satellite
proxy with /etc/sysconfig/virt-who configure
Step
Expected Result
***not for local_libvirt, vdsm
1. Register system to satellite5.X proxy
2. Configure virt-who run any mode and
"VIRTWHO_SATELLITE_SERVER" to satellite
proxy server.
[root@hp-z220-03 ~]# cat /etc/sysconfig/virt-who  | grep -v
^# | grep -v ^$
VIRTWHO_DEBUG=1
VIRTWHO_SATELLITE5=1
VIRTWHO_HYPERV=1
VIRTWHO_HYPERV_OWNER=ACME_Corporation
VIRTWHO_HYPERV_ENV=Library
VIRTWHO_HYPERV_SERVER=10.73.5.233
VIRTWHO_HYPERV_USERNAME=virtwho\\administrator
VIRTWHO_HYPERV_PASSWORD=Welcome1
VIRTWHO_SATELLITE_SERVER=rhel67-
sat57.redhat.com[satellite proxy server]
VIRTWHO_SATELLITE_USERNAME=admin
VIRTWHO_SATELLITE_PASSWORD=admin
3. Restart virt-who service and check virt-who's log
# tail -f /var/log/rhsm/rhsm.log
Virt-who send host/guest
mapping info successfully.
4. Open satellite's webUI, check host/guest mapping info
Hypervisors can show on
satellites .
RHEL7-58984 - 5013-[Satellite5.X] Check virt-who send mapping info through satellite
proxy with CLI
Step
Expected Result
***not for local_libvirt, vdsm
1. Register system to satellite5.X proxy
2. Configure virt-who run any mode with
CLI and "--satellite-serve" is satellite
proxy server.
# virt-who -d -o --satellite --satellite-
server=[satellite proxy server] --satellite-
username=admin --satellite-
password=admin --esx --esx-
owner=Default_Organization --esx-
env=Library --esx-server=10.66.78.75 --
esx-
username=Administrator@vsphere.local --
esx-password=qwer1234P!
3. check virt-who's log
# tail -f /var/log/rhsm/rhsm.log
4. Open satellite's webUI, check
host/guest mapping info
Virt-who send host/guest mapping info
successfully.
Hypervisors can show on satellites .
RHEL7-79892 - 5014-[Satellite5.X] Check hypervisor consumed "Hypervisor Base" channel
Step
Expected Result
***not for local libvirt and vdsm
BZ 1141832  
1. Register system to satellite5.X.
2. Run virt-who run at esx/rhevm/hyperv
mode with CLI
# virt-who -d -o --satellite --satellite-
server=[satellite server] --satellite-
username=admin --satellite-
password=admin --esx --esx-
owner=Default_Organization --esx-
env=Library --esx-server=10.66.78.75 --
esx-
username=Administrator@vsphere.local --
esx-password=qwer1234P!
3. Open satellite's webUI, Go to
system-->Hypervisor, check the
hypervisor's consumed channel 
Hypervisor consumed ""Hypervisor Base"
channel" 
RHEL7-86149 - 5015-[Satellite5.X] Check virt-who can register hypervisor to multi-org
Step
Expected Result
***not for local libvirt and vdsm
1. Register hypervisor to satellite5.7 by
CLI:
# virt-who --satellite --satellite-
server=10.73.3.225 --satellite-
username=admin --satellite-
password=redhat --hyperv --hyperv-
owner=xxx --hyperv-env=xxx --hyperv-
server=10.73.5.216 --hyperv-
username=administrator --hyperv-
password=Welcome1 -d -o
2. Check rhsm log and Satellite5.7 WebUI
Bug 1410000
- in rhsm log, Host/Guest mapping info can
be showed and sent successfully.
- on satellite5.7 WebUI, the hypervisor is
registered to default org 'Red Hat Czech,
s.r.o'.
3. In Satellite5.7 WebUI, create a new org
'test_org' under "Admin -> Create
Organization"
-Organization Name: test_org
-Organization Login*: testadmin
-Desired Password*: redhat
4. Add management entitlement to the
new created org - 'test_org'.
under Satellite WebUI -> "Admin", click
into the 'test_org' -> 'Subscriptions' ->
'System Entitlements', set the Proposed
Total values for each Entitlement.
the new org should be created normally.
the largest Possible Values can be set to
the entitlement.
5. Delete the hypervisor registerted on
step1 from Satellite5.7 WebUI.
hypervisor is deleted from satellite5.7
WebUI successfully.
6. Regiter hypervisor to satellite5.7 with
new username=admin and
password=redhat, which is belong to
'test_org'.
# virt-who --satellite --satellite-
server=10.73.3.216 --satellite-
username=testadmin --satellite-
password=redhat --esx --esx-owner=xxx --
esx-env=xxx --esx-server=10.73.5.216 --
esx-
username=Administrator@vsphere.local --
esx-password=Welcome1! -o -d
7. Check rhsm log and Satellite5.7 WebUI
- rhsm log also shows normally.
- on satellite5.7 WebUI, the hypervisor is
registered to the new 'test_org'.
RHEL7-53923 - 5016-[Candlepin2.0] Check virt-who can handle 429 response from server
Step
Expected Result
***for all hypervisor
       NOTE: Make sure virt-who can receive 429 response from
server.
       If no 429 code, you need to use the third-party tool to create a
fake 429 code for testing. refer to: https://github.com/virt-who/virt-
who/pull/103  
       Take virt-who host
(bootp-73-131-133.rhts.eng.pek2.redhat.com) as an example
Refer to 
BZ1300863    
BZ1311884  
BZ1286945  
BZ1368365  
BZ1322201  
BZ1448267  
BZ1506263 
1. download mitmproxy from 
https://github.com/mitmproxy/mitmproxy/releases   to virt-who host
2. run mitmproxy in virt-who host
# ./mitmproxy -b bootp-73-131-133.rhts.eng.pek2.redhat.com --
insecure -p 12345
3. Configure mitmproxy's intercept filter:
a) press 'i'
it will make  bootp-73-131-133.rhts.eng.pek2.redhat.com as
a proxy server, and the port is 12345
it will highlight the GET request contains "job" or "Job" string
b) enter the following (without quotes) as the filter expression: ~bs
[jJ]ob ~m GET
4. register virt-who host to candlepin 2.0
5. create a config file in /etc/virt-who.d/
[esx.conf]
type=esx
server=10.73.131.198
username=administrator@vsphere.local
password=Welcome1!
owner=Default_Organization
env=Library
rhsm_hostname=bootp-73-131-133.rhts.eng.pek2.redhat.com
rhsm_port=443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=admin
hypervisor_id=hostname
rhsm_proxy_hostname=bootp-73-131-133.rhts.eng.pek2.redhat.com
rhsm_proxy_port=12345
6. run virt-who
# virt-who -d -i 60
7. Change the code to 429
1). watch mitmproxy as requests come in. It should highlight and
intercept any job status calls.
2). Move down to the intercepted call using the arrow keys and
press enter
3). Press tab to go to the response
4). Press 'e' and then 'o' to edit the response code, delete the value
already there and replace with 429 and press enter
5). Press 'q' a few times to get back to the main screen of
mitmproxy, then press 'a' to allow the modified response to be
delivered to virt-who
Now stage candlepin was updated to 2.0, you also can use
satellite6.3 which includes candlepin2.0 already.
make sure:
rhsm_proxy_hostname is mitmproxy host:
bootp-73-131-133.rhts.eng.pek2.redhat.com
rhsm_proxy_port is mitmproxy port: 12345
after virt-who start, it will wait for 15 seconds to check the
job state:
2017-10-27 14:45:20,761 [rhsm.connection INFO]
.................
2017-10-27 14:45:35,895 [virtwho.destination_-
after 429 code is created, watch the rhsm.log file, it will
show the 429 info and waiting for 30 seconds to check the
job state again:
2017-10-27 14:38:12,096
[virtwho.destination_4482547385105569854 DEBUG]
MainProcess(21379):Thread-3 @virt.py:_send_data:652 -
429 encountered while checking job state, checking again in
"30"
.................
2017-10-27 14:38:42,423
[virtwho.destination_4482547385105569854 DEBUG]
MainProcess(21379):Thread-3
@subscriptionmanager.py:check_report_state:233 -
Checking status of job
hypervisor_update_0f3c3225-4873-47b6-9d6f-22f25f958c9a
8. Change the code to 429 and set the Retry-After header
1). watch mitmproxy as requests come in. It should highlight and
intercept any job status calls.
after 429 code is created and including the header "Retry-
After" to 10, it will show 429 info and waiting for 10 seconds
to check the job state:
2). Move down to the intercepted call using the arrow keys and
press enter
3). Press tab to go to the response
2017-10-27 14:49:06,473
[virtwho.destination_4482547385105569854 DEBUG]
MainProcess(22400):Thread-3 @virt.py:_send_data:652 -
429 encountered while checking job state, checking again in
"10"
..........
2017-10-27 14:49:16,768
[virtwho.destination_4482547385105569854 DEBUG]
MainProcess(22400):Thread-3
@subscriptionmanager.py:check_report_state:233 -
Checking status of job
hypervisor_update_183676be-091b-41e2-
bcc8-350a0610b6b0
after 404 or 500 code is created, virt-who will show the error
message:
ManagerError: Communication with subscription manager
failed with code 500:
4). Press 'e' and then 'o' to edit the response code, delete the value
already there and replace with 429 and press enter
5). Press 'e' and then 'h' to edit the headers
6). Move down to the last header by using the arrow keys and press
'a' to add a new one
7). Add the header 'Retry-After', press tab, type your desired wait
time and press enter, such as 10
8). Press 'q' a few times to get back to the main screen of
mitmproxy, then press 'a' to allow the modified response to be
delivered to virt-who
8, change the code to 404 or 500
1). watch mitmproxy as requests come in. It should highlight and
intercept any job status calls.
2). Move down to the intercepted call using the arrow keys and
press enter
3). Press tab to go to the response
4). Press 'e' and then 'o' to edit the response code, delete the value
already there and replace with 404 and press enter
5). Press 'q' a few times to get back to the main screen of
mitmproxy, then press 'a' to allow the modified response to be
delivered to virt-who
RHEL7-53924 - 5017-[EXPT] Check guest attribute after add/delete/pause/resume a non-
rhel guest.
Expected Result
Refer to BZ 1353074
Virt-who send correct host/guest(1 guest) mapping
info to server.
Step
 ***for all hypervisor
NOTE: Make sure there is one
guest on host.
1. Register system to server.
2. Configure virt-who run at
any mode and refresh
interval is 60s
3. Restart virt-who service
and check virt-who's log.
# service virt-who restart &&
tail -f /var/log/rhsm/rhsm.log
4. Add a windows guest.
5. Restart virt-who service
and check virt-who's log.
Add a new guest on host. virt-who send
correct host/guest(2 guests) mapping info to
# service virt-who restart &&
tail -f /var/log/rhsm/rhsm.log
server.
6. Pause windows guest.
   Restart virt-who service
and check virt-who's log.
# service virt-who restart &&
tail -f /var/log/rhsm/rhsm.log
7. Resume windows guest.
   Restart virt-who service
and check virt-who's log.
# service virt-who restart &&
tail -f /var/log/rhsm/rhsm.log
8. Stop windows guest.
   Restart virt-who service
and check virt-who's log.
# service virt-who restart &&
tail -f /var/log/rhsm/rhsm.log
Virt-who send correct host/guest(2 guests)
mapping info to server.
The windows guest's "status" has updated
to "3":
        {
            "guestId":
"42098426-0d49-7dc6-0cb7-2331f149b8aa",
 
            "state": 3, 
            "attributes": {
                "active": 1, 
                "virtWhoType": "esx", 
                "hypervisorType": "vmware"
            }
        }
[NOTE]: In RHEVM/VDSM mode, windows
guest should not exist after pause it.
Virt-who send correct host/guest(2 guests)
mapping info to server.
The windows guest's "status" has updated
to "1":
        {
            "guestId":
"42098426-0d49-7dc6-0cb7-2331f149b8aa",
 
            "state": 1, 
            "attributes": {
                "active": 1, 
                "virtWhoType": "esx", 
                "hypervisorType": "vmware"
            }
        }
Virt-who send correct host/guest(2 guests)
mapping info to server.
The windows guest's "status" has updated
to "3":
        {
            "guestId":
"42098426-0d49-7dc6-0cb7-2331f149b8aa",
 
            "state": 5, 
            "attributes": {
                "active": 0, 
                "virtWhoType": "esx", 
                "hypervisorType": "vmware"
            }
        }
[NOTE]: In RHEVM/VDSM mode, windows
guest should not exist after stop it.
Virt-who send correct host/guest(1 guests)
mapping info to server.
The windows guest shouldn't exist on
mapping info.
9. Delete windows guest.
   Restart virt-who service
and check virt-who's log.
# service virt-who restart &&
tail -f /var/log/rhsm/rhsm.log
RHEL7-79899 - 5018-[EXPT] Check virt-who run normally after enable FIPS
Step
Expected Result
***not for hyper-v mode
Refer to BZ 1349640  Bug 1405897
- hyper-v mode is not supported???
- Succeed to enable FIPS mode.
 1. Prepare one rhel host with virt-who
installed.
2. Enable FIPS on the virt-who host
following below instruction:
 1). 
# vi /etc/sysconfig/prelink
PRELINKING=no
note: if no the prelink file, need to "#yum
install prelink" by manual
# prelink -u -a
2).
# yum install dracut-fips -y
# dracut -f
3). edit grub file
- for rhel6:
edit /boot/grub/grub.conf, add:
fips=1 boot=/dev/sda1
- for rhel7:
(1). edit /etc/default/grub, add 'fips=1
boot=/dev/sda1' to line -
'GRUB_CMDLINE_LINUX'
(2). # grub2-mkconfig -o
/boot/grub2/grub.cfg
4) reboot and check
# cat /proc/sys/crypto/fips_enabled
1
2. Restart virt-who service and check virt-
who's log
Virt-who restart successfully.
It can send host/guest mapping info to
server successfully.
***Bug 1526330 for hyperv, "ValueError:
unsupported hash type"
RHEL7-95007 - 5019 - [rhevm] Check virt-who can work no matter rhevm API endpoints
with /ovirt-engine/ appended or not
Step
***Only for rhevm mode
Expected Result
Refer to: BZ 1415497
1. register virt-who host to stage candlepin/satellite/sam
2. configure virt-who run in rhevm mode without /ovirt-engine/
appended.
# vi /etc/virt-who.d/rhevm.conf
[stage-rhevm]
type=rhevm
owner=Default_Organization
env=Library
server=https://bootp-73-3-252.eng.pek2.redhat.com:443
username=admin@internal
password=admin
rhsm_port=443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=admin
3. restart virt-who and check rhsm log
4. configure virt-who run in rhevm mode with /ovirt-engine/
appended.
# vi /etc/virt-who.d/rhevm.conf
[stage-rhevm]
type=rhevm
owner=Default_Organization
env=Library
server=https://bootp-73-3-252.eng.pek2.redhat.com:443/ovirt-
engine/
username=admin@internal
password=admin
 no the 404 error found as
following, virt-who can get
and send rhevm mapping
info to server successfully.
[virtwho.rhev-farm ERROR]
RhevM-2(11346):MainThread
@virt.py:run:375 - Virt
backend 'rhev-farm' fails with
error: Unable to connect to
RHEV-M server: 404 Client
Error: Not Found
rhsm_port=443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=admin
5. restart virt-who and check rhsm log
RHEL7-99718 - 5020 - Subscribe guest with activation key
virt-who can get and send
rhevm mapping info to server
successfully
Step
***For all hypervisor
1. Create activation key - "virt-who" on
Satellite/SAM/Stage Candlepin webui
without any sku attach and keep Auto-
Attach enabled.
Path:
- Satellite: WebUI -> Content -> Activation
Keys -> New Activation Key
- SAM: WebUI -> Subscriptions ->
Activation Keys -> New Key
- Stage Candlepin -> WebUI -> Activation
Keys
2. Configure virt-who run in any
hypervisor, register virt-who host with
activation key, such
as:
# subscription-manager register --
org="Default_Organization"--
activationkey="virt-who"
The system has been registered with ID:
25b92afa-
da45-4b7c-b6a3-a069c02ccaa2
Installed Product Current Status:
Product Name: Red Hat Enterprise Linux
Server
Status:
Subscribed
3. Remove all subscriptions auto attached
above for virt-who host.
# subscription-manager remove --all
4. Subscribe host/hypervisr to a physical
Datacenter pool (SKU ID: RH00002) by
manual.
Expected Result
activation key should be created
successfully.
NOTE: for SAM, no Auto-Attach option,
which defualt is disabled.
-for Satellite/Stage Candlepin:
virt-who host will auto attach the best-
matched
subscription for the installed product from
all skus, because the Auto-Attach is
enabled.
- for SAM: skip the step2 - 10
physical datacenter pool can be attached
to host/hypervisor successfully.
NOTE: physical VDC dosen't support any
product, so can not attach it by auto-
attach, we need to attach it by manual to
derive bonus pool for guest using.
5. Subscribe host/hypervisor to the Limited
pool (SKU: RH00204) by manual.
phycal limited pool can attached to
host/hypervisor successfully.
6. Register guest with activation key.
# subscription-manager register --
org="Default_Organization" --
activationkey="virt-who"
The system has been registered with ID:
eb26d950-0d17-43cd-8f78-bf7470c56afb
Installed Product Current Status:
Product Name: Red Hat Enterprise Linux
Server
Status:       Subscribed
- for Satellite/Stage Candlepin:
guest register normally and auto-attach the
best-matched virtual pool (RH00204 or
RH00050).
NOTE: If activation key with no
subscriptions specified and auto-attach
is enabled, hosts/guests using the
activation key search for the best fitting
subscription from all provided by the
Satellite Server
# subscription-manager list --co
7. Add an unmatched virtual pool for guest
to activation key.
8. Re-register guest with activation key.
# subscription-manager unregister
# subscription-manager register --
org="Default_Organization" --
activationkey="virt-who"
The system has been registered with ID:
eb26d950-0d17-43cd-8f78-bf7470c56afb
Installed Product Current Status:
Product Name: Red Hat Enterprise Linux
Server
Status:       Not Subscribed
# subscription-manager list --co
9. Add both RH00050 and RH00204 virtual
bonus pool to activation key.
10. Register guest with activation key.
# subscription-manager register --
org="Default_Organization" --
activationkey="virt-who"
The system has been registered with ID:
eb26d950-0d17-43cd-8f78-bf7470c56afb
Installed Product Current Status:
Product Name: Red Hat Enterprise Linux
Server
Status:       Subscribed
# subscription-manager list --co
11. Disable auto-attach for the activation
- for Satellite/Stage Candlepin:
add the RH00204 or RH00050, which has
not been auto attached to guest in step 6.
- for Satellite/Stage Candlepin:
guest register normally and will not auto-
attach subscription.
NOTE: If activation key with
subscriptions specified and auto-attach
is enabled, hosts/guests using the
activation key select the best fitting
subscription from the list specified in
the activation key
- for Satellite/Stage Candlepin:
guest register normally and will auto-attach
RH00050 or RH00204.
NOTE: If activation key with
subscriptions specified and auto-attach
is enabled, hosts/guests using the
activation key select the best fitting
subscription from the list specified in
the activation key
key.
12. Keep the pool RH00204 and RH00050
virtual bonus pool added to the activation
key.
13. Re-register guest again with activation
key.
# subscription-manager unregister
# subscription-manager register --
org="Default_Organization" --
activationkey="virt-who"
The system has been registered with ID:
1302127e-b306-43aa-968a-
c3968656bbb2
Installed Product Current Status:
Product Name: Red Hat Enterprise Linux
Server
Status:       Subscribed
# subscription-manager list --co
14. Remove all the pool subscriptions from
the activation key.
15. Re-register guest again with activation
key.
# subscription-manager unregister
# subscription-manager register
The system has been registered with ID:
54ef6410-ff21-4a39-9398-49aaf3a1c503
Installed Product Current Status:
Product Name: Red Hat Enterprise Linux
Server
Status:       Not Subscribed
Unable to find available subscriptions for
all your installed products.
# subscription-manager list --co
guest should have been attached to the
two vitual bonus pool RH00204 and
RH00050
NOTE: If activation key with
subscriptions specified and auto-attach
is disabled, hosts/guests using the
activation key will be auto-attached all
subscriptions specified in the activation
key.
No consumed subscription pools to list
NOTE: If activation key with no
subscriptions specified and auto-attach
is disabled, hosts/guests using the
activation key will not be auto-attached
subscription, need to attach by manual.
RHEL7-100484 - 5021 - [Satellite6.3] Filter the "hypervisor list" on Satellite WebUI ->
Content Hosts
Step
Expected Result
***Not for Local_Libvirt and VDSM mode.
1. Register the virt-who host and guest to
Satellite6.3 server.
virt-who host and guest can be registered
successfully.
2. Check Satellite WebUI -> Conten Hosts the host and guest show normally.
3. Configure virt-who conf file in /etc/virt-
who.d/, such as:
# vi /etc/virt-wd/esx.conf
[test-esx]
type=esx
owner=Default_Organization
env=Library
server=10.73.3.234
username=Administrator@vsphere.local
password=Welcome1!
4.  Restart virt-who service
# systemctl restart virt-who
mapping is ok.
5. Check Satellite WebUI -> Conten Hosts all the host, guest host and hypervisor are
listed well.
all hypervisors registered by virt-who show
begining with virt-who, like: virt-who-
bootp-73-5-249.rhts.eng.pek2.redhat.com-1
will just list all hypervisors
6. Filter to only list hypervisor in Satellite
WebUI -> Content Hosts.
clike the drop-down arrow to the right of
the search buttion -> seltect 'list
hypervisors' to search.
7. Select another type to filter in the drop-
down menu, such as "ok hosts".
should succeed to list all "ok hosts"
***Bug 1502523 existing.
RHEL7-110637 - 5022 - Multi activation key
Expected Result
for SAM, skip step2 - 7
Step
***For all hypervisor
1. Create two activationkeys - "virt-who1"
and "virt-who2".
PATH:
- Satellite: WebUI -> Content -> Activation
Keys -> New Activation Key
- SAM: WebUI -> Subscriptions ->
Activation Keys -> New Key
- Stage Candlepin -> WebUI -> Activation
Keys -> New
2. Enable the auto-attach for two
activationkeys
3. Subscribe host/hypervisor with physical
pools, such as Datacenter poor
(RH00002), Limited (RH00204), Unlimited
pool (RH00060). 
4. Add virtual bonus pool RH00050 and
RH00060 to activation key - virt-who1
guest should register successfully and
auto attach the best matched pool
(RH00050 or RH00060) in the activation
eky - "virt-who1"
guest should register successfully and
auto attach the best matched pool
(RH00204 or RH00050) in the activation
key - "virt-who2"
for SAM, the default is disabled
guest should register successfully and
auto attach all the pool (RH00204 and
RH00060) in the activation key - "virt-
who1"
5. Add virtual bonus pool RH00204 and
RH00060 to activation key - virt-who2
6. Start virt-who service and register guest
with activation key - "virt-who1"
# subscription-manager register --org
"Default_Organization" --activationkey "virt-
who1"
The system has been registered with ID:
cbb48b49-22c4-4c00-955e-09be7a55932c
Installed Product Current Status:
Product Name: Red Hat Enterprise Linux
Server
Status:       Subscribed
# subscription-manager list --co
7. Re-register guest with activation key -
"virt-who2"
# subscription-manager unregister
# subscription-manager register --org
"Default_Organization" --activationkey "virt-
who1"
Couldn't find activation key 'virt-who1'
[root@RHEVM-G1 ~]# subscription-
manager register --org
"Default_Organization" --activationkey "virt-
who2"
The system has been registered with ID:
76cdf273-f45a-4ff1-b53a-8768b01aa2e9
# subscription-manager list --co
8. Disable the auto-attach for two
activationkeys
9. Re-register guest with activation key -
"virt-who1"
# subscription-manager unregister
# subscription-manager register --org
"Default_Organization" --activationkey "virt-
who1"
The system has been registered with ID:
cbb48b49-22c4-4c00-955e-09be7a55932c
Installed Product Current Status:
Product Name: Red Hat Enterprise Linux
Server
Status:       Subscribed
# subscription-manager list --co
Re-register guest with activation key - "virt-
who2"
# subscription-manager unregister
guest should register successfully and
auto attach all the pool (RH00204 and
RH00050) in the activation key - "virt-
who2"
# subscription-manager register --org
"Default_Organization" --activationkey "virt-
who1"
Couldn't find activation key 'virt-who1'
[root@RHEVM-G1 ~]# subscription-
manager register --org
"Default_Organization" --activationkey "virt-
who2"
The system has been registered with ID:
76cdf273-f45a-4ff1-b53a-8768b01aa2e9
# subscription-manager list --co
RHEL7-110677 - 5023 - [Satellite WebUI] Check "Registered By" item in content hosts
Step
***for all hypervisors
1. Register virt-who host to Satellite
# subscription-manager register --
username admin --password admin
2. Register guest to Satellite
# subscription-manager register --
username admin --password admin
3. Restart virt-who to register hypervisor to
Satellite
# systemctl restart virt-who
4. Check Satellite WebUI -> Content Hosts
-> click into system/hypervisor -> Details -
> Content Host Status -> Registered By
Expected Result
Refer to
host register successfully
guest register successfully
for local_libivirt and vdsm, skip the step
- for virt-who host and guest: admin
- for Hypervisor: BZ 1502555 existing
RHEL7-110688 - 5024 - Run virt-who in a non-root user account
Expected Result
useradd succsessfully
Step
***for all hypervisors
1.  Prepare virt-who RHEL host with virt-who package
installed
2. Add a new user - "virt-who" to run virt-who
# useradd virt-who
# passwd virt-who
3. Log into the virt-who host by root to check the default rights
about virt-who
# ll /etc/ |grep virt-who.d
drwx------.  2 root root     4096 Oct 18 14:07 virt-who.d
# ll /etc/virt-who.d/
-rw-r--r--. 1 root root 2 Oct 19 18:44 template.conf
# ll /etc/virt-who.conf
-rw-------. 1 root root 2359 Feb 27 04:36 /etc/virt-who.conf
ll /etc/sysconfig/ |grep virt-who
-rw-------. 1 root root 2357 Oct 18 14:16 virt-who
ll /etc/rhsm/ |grep rhsm.conf
-rw-r--r--. 1 root root 2022 Oct 18 12:58 rhsm.conf
ll /var/log/rhsm/ |grep rhsm.log
-rw-r--r--. 1 root root 3458720 Oct 19 18:10 rhsm.log
4. Add "virt-who" user the same rights as root
# chmod 777 /etc/virt-who.d
# chmod 777 /etc/virt-who.d/*
# chmod 666 /etc/sysconfig/virt-who
# chmod 666 /etc/virt-who.conf
# chmod 666 /etc/rhsm/rhsm.conf
# chmod 666 /var/log/rhsm/rhsm.log
add rights successfully
5. Check the rights again
# ll /etc/ |grep virt-who.d
drwxrwxrwx.  2 root root       71 Oct 18 22:52 virt-who.d
the user rights have
been changed to the
same with root
# ll /etc/virt-who.d/
-rw-rw-rw-. 1 root root 1213 May 17 17:08 template.conf
# ll /etc/sysconfig/virt-who
-rw-rw-rw-. 1 root root 2352 Oct 19 06:10 /etc/sysconfig/virt-
who
# ll /etc/rhsm/rhsm.conf
-rw-rw-rw-. 1 root root 2058 Oct 17 02:59 /etc/rhsm/rhsm.conf
# ll /var/log/rhsm/rhsm.log
-rw-rw-rw-. 1 root root 543514 Oct 19 06:22
/var/log/rhsm/rhsm.log
6. Regsiter virt-who host to SAM/Satellite/Stage Candlepin
# subscription-manager register --username admin --
password admin
login no problem
7. Log into the virt-who host by "virt-who" user.
register successfully
mapping info is OK
8. Configure virt-who by /etc/virt-who.d/ to send
mapping?such as:
[sat-rhevm]
type=rhevm
owner=Default_Organization
env=Library
server=https://bootp-73-3-163.eng.pek2.redhat.com:443/ovirt-
engine/
username=admin@internal
password=redhat
rhsm_hostname=bootp-73-3-167.eng.pek2.redhat.com
rhsm_port=443
rhsm_prefix=/rhsm
rhsm_username=admin
rhsm_password=admin
RHEL-111612 - 5025 - Register virt-who host/guest by Stage Candlepin WebUI
Expected Result
Step
***for all hypervisor
1. Prepare one virt-who host and one guest, which
have not been registered
# subscription-manager identity
This system is not yet registered. Try 'subscription-
manager register --help' for more information.
2. Check the CPU socket for both host and guest
# lscpu
get the CPU socket for the host and guest, such as:
Socket(s):             2
3.  Create new system profile for virt-who host on
Stage Candlepin WebUI -> Systems -> New
New system profile should be created with "black ?"
in front of the "Name"
Sytem Type: according to system
Name: system hostname or define by yourself
Architecture: according to system, like x86_64
Number of Sockets or LPARs: get from step 1
Red Hat Enterprise Linux Version: according to
system
4. Click into the new created host -> Details -> 
Identity Cerficate -> Download
download identity certificate successfully, such as:
4421cae2-b67b-4af2-bd39-9cb3817b099f.pem
it should be looks like:
-----BEGIN CERTIFICATE-----
MIIFvDCCPW/PuxvE8xUeONeslNM6jbUmpZ2xaS
......
A6SgAwIBAgIITACsQvAFGyGoCowhIwhmOEP7pK
-----END CERTIFICATE-----
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQABAoIBACb9o2FR
......
E/b0iyzJjwkT64gLNA+eOK2FFQIDAQABAo
-----END RSA PRIVATE KEY-----
Create normally
5. Check the Identity Certificate info
# cat 4421cae2-b67b-4af2-bd39-9cb3817b099f.pem
6. Create cert.pem for host with the CERTIFICATE
info got from above step4.
# vi /etc/pki/consumer/cert.pem
-----BEGIN CERTIFICATE-----
MIIFvDCCPW/PuxvE8xUeONeslNM6jbUmpZ2xaS
......
A6SgAwIBAgIITACsQvAFGyGoCowhIwhmOEP7pK
-----END CERTIFICATE-----
7. Create key.pem for host with the RSA PRIVATE
Create normally
KEY info got from above step4.
# vi /etc/pki/consumer/key.pem
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQABAoIBACb9o2FR
......
E/b0iyzJjwkT64gLNA+eOK2FFQIDAQABAo
-----END RSA PRIVATE KEY-----
8. Edit /etc/rhsm/rhsm.conf to support Stage
Candlepin
hostname = subscription.rhsm.stage.redhat.com
baseurl= https://cdn.stage.redhat.com
9. Check host register status.
# subscription-manager identity
system identity: 4421cae2-b67b-4af2-
bd39-9cb3817b099f
name: dhcp-128-184.nay.redhat.com
org name: 11343171
org ID: 11343171
# subscription-manager list --av
the host system has been registered to Stage
Candlepin and can list all available subscriptions.
10. Check Stage Candlepin WebUI
the host "Name" has become Green
11. Register guest as step3-8
guest can be register successfully.
12. Configure virt-who run in the hypervisor mode
# vi /etc/virt-who.d/
[stage-esx]
type=esx
owner=11343171
env=11343171
server=10.73.3.166
username=Administrator@vsphere.local
password=Welcome1!
13. Start virt-who to send mapping
# systemctl start virt-who
14. Attach Datacenter SKU (RH00002) for
host/hypervisor
15. Check bonus pool is producted on guest
# subscription-manager refresh
# subscription-manager list --av
mapping is OK
virtual bonus pool (RH00050) should be producted
16. Attach the bonus pool (RH00050) to guest
# subscription-manager attach --pool [POOL_ID]
subscribe successfully
RHEL-112413 - 5026 - [Satellite WebUI] check the host link and associations by Content =>
Red Hat Subscriptions
Step
Expected Result
1. register virt-who host to satellite, make
BZ1506636 
sure your satellite has imported the
manifest already
2. create a config file for a hypervisor
mode
3.  register hypervisor's guest to satellite
as well
4. start virt-who service to send the h/g
info to satellite
5. Attach physical vdc subscription to
hypervisor
6. Attach virtual vdc subscription to guest
7. go to "Content" => "Red Hat
Subscription" to check vdc consumed
status
1). it should show how many physical vdc
sku consumed and how many virtual vdc
sku consumed,
2). it should show the association info for
h/g
RHEL-113053 - 5027 - Together to run command "subscription-manager unregister" and
"subscription-manager clean"
Step
***for all hypervisor
1. Register virt-who host to
SAM/Satellite/Stage Candlepin
Expected Result
Refer to Bug 1506167 
register successfully
2. Run # subscription-manager unregister
unregister no problem
3. Run # subscription-manager clean
clean no problem
4. Check virt-who status and process
# systemctl status virt-who
# ps -ef | grep virt-who
5. Register the host again.
# subscription-manager register
6. Unregister and clean together by ";"
# subscription-manager unregister ;
subscription-manager clean
7. Check virt-who status
# systemctl status virt-who
8. Check virt-who process
# ps -ef | grep virt-who
virt-who service should be runing normally
virt-who service should be runing normally
***Bug 1506167, virt-who is killed.
virt-who process should exists.
***Bug 1506167, virt-who is killed.